
[TOC]

# kettle转换脚本列表



## zdryhgzdxysk__zdryjc_rylb_2_focus_person_type



### 转换图：

![4af7867d920143b1a243526de741187a.jpg](http://localhost/lyt-lytdoc/file/preview/4af7867d920143b1a243526de741187a.jpg)



### 源表：

d_ssqbyth_zdryhgzdxysk（爱科一体化平台重点人信息）



| field              | type      | length | lengthvar | notnull | comment |
| ------------------ | --------- | ------ | --------- | ------- | ------- |
| objectid           | bpchar    | -1     | 40        | true    |         |
| parentindex        | int4      | 4      | -1        | false   |         |
| parentobjectid     | varchar   | -1     | 204       | false   |         |
| parentpropertyname | varchar   | -1     | 68        | false   |         |
| name               | varchar   | -1     | 204       | false   |         |
| state              | int4      | 4      | -1        | false   |         |
| sequenceno         | varchar   | -1     | 204       | false   |         |
| treelistparentid   | varchar   | -1     | 204       | false   |         |
| createdname        | varchar   | -1     | 204       | false   |         |
| idfullpath         | varchar   | -1     | 204       | false   |         |
| namefullpath       | varchar   | -1     | 204       | false   |         |
| createdparentname  | varchar   | -1     | 204       | false   |         |
| sheetcode          | varchar   | -1     | 204       | false   |         |
| workflowversion    | int4      | 4      | -1        | false   |         |
| createdby          | varchar   | -1     | 40        | false   |         |
| createdbyparentid  | varchar   | -1     | 40        | false   |         |
| ownerid            | varchar   | -1     | 40        | false   |         |
| ownerparentid      | varchar   | -1     | 40        | false   |         |
| createdtime        | timestamp | 8      | 6         | false   |         |
| modifiedby         | varchar   | -1     | 204       | false   |         |
| modifiedtime       | timestamp | 8      | 6         | false   |         |
| runninginstanceid  | varchar   | -1     | 40        | false   |         |
| bizsheetversion    | varchar   | -1     | 204       | false   |         |
| flowstatus         | int4      | 4      | -1        | false   |         |
| flowitemid         | varchar   | -1     | 204       | false   |         |
| applytime          | timestamp | 8      | 6         | false   |         |
| zerjz              | varchar   | -1     | 204       | false   |         |
| liegqx             | varchar   | -1     | 204       | false   |         |
| shengqb            | text      | -1     | -1        | false   |         |
| shengjz            | text      | -1     | -1        | false   |         |
| disqb              | text      | -1     | -1        | false   |         |
| disjz              | text      | -1     | -1        | false   |         |
| quxqb              | text      | -1     | -1        | false   |         |
| quxjz              | text      | -1     | -1        | false   |         |
| paicsqb            | text      | -1     | -1        | false   |         |
| zermjxm            | varchar   | -1     | 204       | false   |         |
| zermjsfz           | varchar   | -1     | 204       | false   |         |
| zermjsjh           | varchar   | -1     | 204       | false   |         |
| zermj              | varchar   | -1     | 204       | false   |         |
| liegqx_id          | text      | -1     | -1        | false   |         |
| zermj_id           | text      | -1     | -1        | false   |         |
| renylb1j           | varchar   | -1     | 204       | false   |         |
| renylb2j           | varchar   | -1     | 204       | false   |         |
| renylb3j           | varchar   | -1     | 204       | false   |         |
| zhengjlx           | varchar   | -1     | 204       | false   |         |
| zhengjhm           | varchar   | -1     | 204       | false   |         |
| xingm              | varchar   | -1     | 204       | false   |         |
| lianxfs            | varchar   | -1     | 204       | false   |         |
| zhaop              | varchar   | -1     | 204       | false   |         |
| zhaopbase64        | text      | -1     | -1        | false   |         |
| chelpzh            | varchar   | -1     | 204       | false   |         |
| renylb2j_id        | text      | -1     | -1        | false   |         |
| zhengjlx_id        | text      | -1     | -1        | false   |         |
| shoujmac           | varchar   | -1     | 204       | false   |         |
| hujzz              | varchar   | -1     | 204       | false   |         |
| xianzz             | varchar   | -1     | 204       | false   |         |
| hujzrq             | varchar   | -1     | 204       | false   |         |
| hujzrqbm           | varchar   | -1     | 204       | false   |         |
| hujzrpcs           | varchar   | -1     | 204       | false   |         |
| hujzrpcsbm         | varchar   | -1     | 204       | false   |         |
| zhaop_file         | text      | -1     | -1        | false   |         |
| zuixmjfk           | varchar   | -1     | 204       | false   |         |
| zuixmjfk_id        | text      | -1     | -1        | false   |         |
| zerjz_id           | text      | -1     | -1        | false   |         |
| shengzrjz          | varchar   | -1     | 204       | false   |         |
| diszrjz            | varchar   | -1     | 204       | false   |         |
| quxzrjz            | varchar   | -1     | 204       | false   |         |
| shengzrjz_id       | text      | -1     | -1        | false   |         |
| diszrjz_id         | text      | -1     | -1        | false   |         |
| quxzrjz_id         | text      | -1     | -1        | false   |         |
| xinzlrr            | varchar   | -1     | 204       | false   |         |
| xinzlrrssbm        | varchar   | -1     | 204       | false   |         |
| renylb1j_id        | text      | -1     | -1        | false   |         |
| shujid             | varchar   | -1     | 204       | false   |         |
| liegyj             | varchar   | -1     | 204       | false   |         |
| liegyy             | text      | -1     | -1        | false   |         |
| liegyj_id          | text      | -1     | -1        | false   |         |
| daorpc             | varchar   | -1     | 204       | false   |         |
| jingzryda          | varchar   | -1     | 204       | false   |         |
| xinzlrr_id         | text      | -1     | -1        | false   |         |
| xinzlrrjz          | varchar   | -1     | 204       | false   |         |
| xinzlrrqb          | varchar   | -1     | 204       | false   |         |
| bucsq              | varchar   | -1     | 204       | false   |         |
| jinysq             | varchar   | -1     | 204       | false   |         |
| renylb3j_id        | text      | -1     | -1        | false   |         |
| genghzrpcs         | varchar   | -1     | 204       | false   |         |
| shifghzrpcs        | varchar   | -1     | 204       | false   |         |
| genghzrpcs_id      | text      | -1     | -1        | false   |         |
| shifghzrpcs_id     | text      | -1     | -1        | false   |         |
| shoujcm            | varchar   | -1     | 204       | false   |         |
| shifghgkzrpcs      | varchar   | -1     | 204       | false   |         |
| genghgkzrpcs       | varchar   | -1     | 204       | false   |         |
| shifghgkzrpcs_id   | text      | -1     | -1        | false   |         |
| genghgkzrpcs_id    | text      | -1     | -1        | false   |         |
| guankzrpcsbm       | varchar   | -1     | 204       | false   |         |
| guankpcsqb         | text      | -1     | -1        | false   |         |
| imsi               | varchar   | -1     | 204       | false   |         |
| beiz               | text      | -1     | -1        | false   |         |
| lurrbm             | varchar   | -1     | 204       | false   |         |
| disjz2             | varchar   | -1     | 204       | false   |         |
| guispcsbm          | varchar   | -1     | 204       | false   |         |
| shengjz2           | varchar   | -1     | 204       | false   |         |
| quxjz2             | varchar   | -1     | 204       | false   |         |
| linspx             | varchar   | -1     | 204       | false   |         |
| renylb             | text      | -1     | -1        | false   |         |
| zermjszdw          | varchar   | -1     | 204       | false   |         |
| suosds             | varchar   | -1     | 204       | false   |         |
| suosqx             | varchar   | -1     | 204       | false   |         |
| suospcs            | varchar   | -1     | 204       | false   |         |
| mobile             | varchar   | -1     | 204       | false   |         |
| chuangjrzfl        | varchar   | -1     | 204       | false   |         |
| chuangjrdw         | varchar   | -1     | 204       | false   |         |
| employeenumber     | varchar   | -1     | 204       | false   |         |
| zhengjhmsfqdxx     | varchar   | -1     | 204       | false   |         |
| xuanzzrpcs         | varchar   | -1     | 204       | false   |         |
| denglrkzzd4        | varchar   | -1     | 204       | false   |         |
| xuanzzrpcs_id      | text      | -1     | -1        | false   |         |
| zermjjh            | varchar   | -1     | 204       | false   |         |
| xinzlrrsscj        | varchar   | -1     | 204       | false   |         |
| xinzlrrssbm2       | varchar   | -1     | 204       | false   |         |
| shifbsry           | varchar   | -1     | 204       | false   |         |
| zengym             | varchar   | -1     | 204       | false   |         |
| xingb              | varchar   | -1     | 204       | false   |         |
| mingz              | varchar   | -1     | 204       | false   |         |
| xingb_id           | text      | -1     | -1        | false   |         |
| hunyzk             | varchar   | -1     | 204       | false   |         |
| hunyzk_id          | text      | -1     | -1        | false   |         |
| zhengzmm           | varchar   | -1     | 204       | false   |         |
| zongjxy            | varchar   | -1     | 204       | false   |         |
| shenflb            | varchar   | -1     | 204       | false   |         |
| fuwcs              | varchar   | -1     | 204       | false   |         |
| wanglzh            | varchar   | -1     | 204       | false   |         |
| yujdj              | varchar   | -1     | 204       | false   |         |
| zhuysq             | varchar   | -1     | 204       | false   |         |
| hujzzs             | varchar   | -1     | 204       | false   |         |
| hujzzshi           | varchar   | -1     | 204       | false   |         |
| hujzzq             | varchar   | -1     | 204       | false   |         |
| xianzzs            | varchar   | -1     | 204       | false   |         |
| xianzzshi          | varchar   | -1     | 204       | false   |         |
| xianzzq            | varchar   | -1     | 204       | false   |         |
| hujzzs_id          | text      | -1     | -1        | false   |         |
| hujzzshi_id        | text      | -1     | -1        | false   |         |
| hujzzq_id          | text      | -1     | -1        | false   |         |
| xianzzs_id         | text      | -1     | -1        | false   |         |
| xianzzshi_id       | text      | -1     | -1        | false   |         |
| xianzzq_id         | text      | -1     | -1        | false   |         |
| renydj             | varchar   | -1     | 204       | false   |         |
| suossq             | varchar   | -1     | 204       | false   |         |
| sheqgkfzr          | varchar   | -1     | 204       | false   |         |
| sheqgkzrrdh        | varchar   | -1     | 204       | false   |         |
| xiugsj             | varchar   | -1     | 259       | false   |         |
| daorupici          | varchar   | -1     | 259       | false   |         |




### 目标表：

focus_person_type（领导驾驶舱重点人类型）



| field        | type      | length | lengthvar | notnull | comment      |
| ------------ | --------- | ------ | --------- | ------- | ------------ |
| id           | varchar   | -1     | 54        | true    | 主键ID       |
| data_time    | date      | 4      | -1        | true    | 统计时间     |
| year_month   | varchar   | -1     | 104       | false   | 年月         |
| city_code    | varchar   | -1     | 104       | true    | 地市编码     |
| level        | varchar   | -1     | 34        | false   | 行政区划级别 |
| type_code    | varchar   | -1     | 104       | false   | 类型编码     |
| type_desc    | varchar   | -1     | 104       | true    | 类型名称     |
| person_count | int4      | 4      | -1        | false   | 人员总数     |
| create_time  | timestamp | 8      | -1        | false   | 创建时间     |
| remark       | varchar   | -1     | 504       | false   | 备注         |





```
select
    md5(random()::text || clock_timestamp()::text) as  id,
    to_date(to_char(dsz.createdtime,'yyyy-MM-DD'),'yyyy-MM-DD')  as data_time,
    split_part(to_char(dsz.createdtime,'yyyy-MM-DD'),'-',1) || '-' || split_part(to_char(dsz.createdtime,'yyyy-MM-DD'),'-',2) as year_month,
    dsz.hujzzshi_id city_code,
    dsz.renylb1j type_desc,
    count(1) person_count,
    now() create_time
from d_ssqbyth_zdryhgzdxysk dsz
where dsz.hujzzshi_id is not null
group by dsz.hujzzshi_id ,to_char(dsz.createdtime,'yyyy-MM-DD'),dsz.renylb1j;
```





## tb_uc_duty_cmd_record_2_t_overall_clue_report

### 转换图：

![6b39e802252d4164b4cc5eee3c874a81.jpg](http://localhost/lyt-lytdoc/file/preview/6b39e802252d4164b4cc5eee3c874a81.jpg)



### 源表：

tb_uc_clue（指令中台线索）



| field                | type      | length | lengthvar | notnull | comment                                                      |
| -------------------- | --------- | ------ | --------- | ------- | ------------------------------------------------------------ |
| id                   | varchar   | -1     | 259       | true    | 主键                                                         |
| clue_sn              | varchar   | -1     | 259       | false   | 线索编号                                                     |
| create_user_name     | varchar   | -1     | 259       | false   | 线索提供人                                                   |
| clue_from            | varchar   | -1     | 259       | false   | 线索来源                                                     |
| clue_to_array        | varchar   | -1     | 259       | false   | 接收单位                                                     |
| clue_title           | varchar   | -1     | 259       | false   | 线索标题                                                     |
| clue_msg             | text      | -1     | -1        | false   | 线索详细(内容)                                               |
| clue_class           | varchar   | -1     | 259       | false   | 涉事类别                                                     |
| clue_department_name | varchar   | -1     | 259       | false   | 线索采集单位                                                 |
| clue_state           | varchar   | -1     | 259       | false   | 线索状态(0:未处理;1:未采纳;2:采纳)                           |
| clue_state_msg       | varchar   | -1     | 259       | false   | 线索状态详细                                                 |
| clue_start_time      | timestamp | 8      | 6         | false   | 线索开始时间                                                 |
| clue_stop_time       | timestamp | 8      | 6         | false   | 线索结束时间                                                 |
| clue_reliability     | varchar   | -1     | 259       | false   | 线索可靠性                                                   |
| clue_urgent          | varchar   | -1     | 259       | false   | 线索紧急程度                                                 |
| clue_important       | varchar   | -1     | 259       | false   | 线索重要性                                                   |
| copy_item            | varchar   | -1     | 259       | false   | 副本类型(1:抄送;)                                            |
| point_start_time     | timestamp | 8      | 6         | false   | 指向开始时间                                                 |
| point_end_time       | timestamp | 8      | 6         | false   | 指向结束时间                                                 |
| point_address        | varchar   | -1     | 259       | false   | 指向地点                                                     |
| study                | varchar   | -1     | 259       | false   | 是否研判(0:否;1:是)                                          |
| study_msg            | varchar   | -1     | 259       | false   | 研判详细                                                     |
| update_user_id       | varchar   | -1     | 259       | false   | 处理人                                                       |
| update_time          | timestamp | 8      | 6         | false   | 处理时间                                                     |
| create_time          | timestamp | 8      | 6         | false   | 创建时间                                                     |
| file                 | text      | -1     | -1        | false   | 文件数组                                                     |
| status               | varchar   | -1     | 259       | false   | 状态，0草稿，1正常，2软删除，CSZT1-002禁用及草稿，001正常，003已软删除 |
| r1                   | varchar   | -1     | 259       | false   |                                                              |
| r2                   | varchar   | -1     | 259       | false   |                                                              |
| r3                   | varchar   | -1     | 259       | false   |                                                              |
| r4                   | varchar   | -1     | 259       | false   |                                                              |
| r5                   | numeric   | -1     | -1        | false   |                                                              |
| r6                   | numeric   | -1     | -1        | false   |                                                              |
| r7                   | int4      | 4      | -1        | false   |                                                              |
| r8                   | int4      | 4      | -1        | false   |                                                              |
| r9                   | timestamp | 8      | 6         | false   |                                                              |
| r10                  | timestamp | 8      | 6         | false   |                                                              |
| user_id              | varchar   | -1     | 259       | false   | 线索提供人id                                                 |
| associated_group     | varchar   | -1     | 259       | false   | 关联群体                                                     |
| link_person          | varchar   | -1     | 259       | false   | 关联人员id                                                   |
| create_user_id       | varchar   | -1     | 36        | false   | 线索创建人id                                                 |
| to_user_id           | varchar   | -1     | -1        | false   | 接受人id                                                     |
| is_time_point        | bool      | 1      | -1        | false   | 是否指向时间,true,false                                      |
| jiesdanwid           | varchar   | -1     | -1        | false   | 接收单位id                                                   |
| chaosdanwid          | varchar   | -1     | -1        | false   | 抄送单位id                                                   |
| link_person_id       | varchar   | -1     | -1        | false   | 关联人员id                                                   |
| link_person_count    | int4      | 4      | -1        | false   | 关联人员数据                                                 |
| to_roles             | varchar   | -1     | 259       | false   | 接收角色id                                                   |
| chaos_roles          | varchar   | -1     | 259       | false   | 抄送角色id                                                   |
| clue_batch           | varchar   | -1     | 259       | false   | 线索批次好，针对上报的                                       |
| create_role_id       | varchar   | -1     | 259       | false   | 发起人所属班组、角色id                                       |
| to_role_id           | varchar   | -1     | 259       | false   | 接收人所属班组、角色id                                       |
| create_role_name     | varchar   | -1     | 259       | false   | 发起人所属班组                                               |
| to_role_name         | varchar   | -1     | 259       | false   | 接收人所属班组                                               |
| operate_role_name    | varchar   | -1     | 259       | false   | 操作人角色名称                                               |
| operate_name         | varchar   | -1     | 259       | false   | 操作人名称                                                   |



### 目标表：

t_overall_clue_report（领导驾驶舱）

| field                   | type      | length | lengthvar | notnull | comment          |
| ----------------------- | --------- | ------ | --------- | ------- | ---------------- |
| sender_area_name        | varchar   | -1     | 34        | false   | 指令发送地区名称 |
| sender_area_code        | varchar   | -1     | 34        | false   | 指令发送地区编码 |
| sender_area_longitude   | varchar   | -1     | 34        | false   | 指令发送地区经度 |
| sender_area_latitude    | varchar   | -1     | 34        | false   | 指令发送地区纬度 |
| receiver_area_name      | varchar   | -1     | 34        | false   | 指令接收地区名称 |
| receiver_area_code      | varchar   | -1     | 34        | false   | 指令接收地区编码 |
| receiver_area_longitude | varchar   | -1     | 34        | false   | 指令接收地区经度 |
| receiver_area_latitude  | varchar   | -1     | 34        | false   | 指令接收地区纬度 |
| clue_send_num           | int4      | 4      | -1        | false   | 线索上报数       |
| biz_original_time       | timestamp | 8      | -1        | false   | 业务原始时间     |
| create_time             | timestamp | 8      | -1        | false   | 创建时间         |





```

select
    t1.sender_area_code sender_area_code,
    (
        select t_administration.name
        from t_administration
        where t_administration.adcode = t1.sender_area_code
    )                                     sender_area_name,
    (
        select t_administration.center_longitude
        from t_administration
        where t_administration.adcode = t1.sender_area_code
    )                                     sender_area_longitude,
    (
        select t_administration.center_latitude
        from t_administration
        where t_administration.adcode = t1.sender_area_code
    )                                     sender_area_latitude,
    t1.receiver_area_code receiver_area_code,
    (
        select t_administration.name
        from t_administration
        where t_administration.adcode = t1.receiver_area_code
    )                                     receiver_area_name,
    (
        select t_administration.center_longitude
        from t_administration
        where t_administration.adcode = t1.receiver_area_code
    )                                     receiver_area_longitude,
    (
        select t_administration.center_latitude
        from t_administration
        where t_administration.adcode = t1.receiver_area_code
    )                                     receiver_area_latitude,
    count(1)                              clue_send_num,
    to_date(to_char(t1.create_time, 'yyyy-mm-dd'), 'yyyy-mm-dd') date_time,
    now()                                                        create_time,
    '备注'                                                         remark
from (
         select
             tuc.*,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tuc.create_role_id limit 1) sender_area_code,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tuc.to_role_id limit 1) receiver_area_code
         from tb_uc_clue tuc
     ) t1
where t1.sender_area_code is not null and t1.create_role_id is not null and t1.to_role_id is not null and t1.status = 'CSZT1-001'
group by t1.sender_area_code,t1.receiver_area_code, to_char(t1.create_time, 'yyyy-mm-dd');

```



##   tb_uc_duty_cmd_record_2_n_command_sum_group_administration_send

转换图：





![220c6429822948459f2a37a221f34e8b.jpg](http://localhost/lyt-lytdoc/file/preview/220c6429822948459f2a37a221f34e8b.jpg)





### 源表：

tb_uc_duty_cmd_record（指令中台）

| field                 | type      | length | lengthvar | notnull | comment                                                  |
| --------------------- | --------- | ------ | --------- | ------- | -------------------------------------------------------- |
| id                    | varchar   | -1     | 259       | true    | 主键                                                     |
| cmd_type              | varchar   | -1     | 259       | false   | 指令类型                                                 |
| cmd_from_user_name    | varchar   | -1     | 259       | false   | 指令发送者，创建人                                       |
| cmd_to_user_name      | varchar   | -1     | 259       | false   | 指令接收者                                               |
| cmd_from_user_id      | varchar   | -1     | 259       | false   | 指令发送用户ID                                           |
| cmd_to_user_id        | varchar   | -1     | 259       | false   | 指令接受用户ID                                           |
| launch_type           | varchar   | -1     | 20        | false   | 发起源类型(0:无;1:线索;2:警情)                           |
| launch_id             | varchar   | -1     | 259       | false   | 发起源ID                                                 |
| from_company          | varchar   | -1     | 259       | false   | 发起单位，创建单位                                       |
| from_company_id       | varchar   | -1     | 259       | false   | 创建单位id                                               |
| to_company            | varchar   | -1     | 259       | false   | 接收单位                                                 |
| to_company_id         | varchar   | -1     | 259       | false   | 接收单位id                                               |
| from_police_type      | varchar   | -1     | 259       | false   | 发起警种                                                 |
| to_police_type        | varchar   | -1     | 259       | false   | 接收警种                                                 |
| administrative_area   | varchar   | -1     | 259       | false   | 行政区划                                                 |
| police_area           | varchar   | -1     | 259       | false   | 警务区划                                                 |
| cmd_batch             | varchar   | -1     | 259       | false   | 指令批次号                                               |
| cmd_param             | text      | -1     | -1        | false   | 指令参数                                                 |
| cmd_title             | varchar   | -1     | 259       | false   | 指令标题                                                 |
| cmd_content           | text      | -1     | -1        | false   | 指令内容                                                 |
| cmd_level_id          | varchar   | -1     | 259       | false   | 指令等级ID                                               |
| sign                  | bool      | 1      | -1        | false   | 是否需要签收                                             |
| sign_timeout          | timestamp | 8      | 6         | false   | 签收超时时间                                             |
| feedback              | bool      | 1      | -1        | false   | 是否需要反馈                                             |
| feedback_timeout      | timestamp | 8      | 6         | false   | 反馈超时时间                                             |
| supervise             | bool      | 1      | -1        | false   | 是否需要督办                                             |
| cmd_status            | varchar   | -1     | 20        | false   | 指令状态(0:待处理;1:已签收;2:已反馈;                     |
| finished              | varchar   | -1     | 20        | false   | 是否完成(0:未完成;1:已完成)（归档状态）                  |
| copy_item             | varchar   | -1     | 20        | false   | 副本类型(1:抄送;2:协作;)                                 |
| create_time           | timestamp | 8      | 6         | false   | 创建时间                                                 |
| source_sys            | varchar   | -1     | 36        | false   | （指令来源）来源系统(1:警辅通;2:警综;3:情报二期;99:其他) |
| remark                | varchar   | -1     | 259       | false   | 备注                                                     |
| file                  | text      | -1     | -1        | false   | 文件                                                     |
| status                | varchar   | -1     | 20        | false   | 0草稿，1正常，2已删除                                    |
| cmd_operate_last_time | timestamp | 8      | 6         | false   |                                                          |
| cmd_operate_last_type | timestamp | 8      | 6         | false   |                                                          |
| cmd_operate_last_id   | timestamp | 8      | 6         | false   |                                                          |
| xzxqbm                | varchar   | -1     | 259       | false   | 行政辖区编码                                             |
| sjxzxqbm              | varchar   | -1     | 259       | false   | 上级行政辖区编码                                         |
| jwxqbm                | varchar   | -1     | 259       | false   | 警务辖区编码                                             |
| sjjwxqbm              | varchar   | -1     | 259       | false   | 上级警务辖区编码                                         |
| r1                    | varchar   | -1     | 259       | false   |                                                          |
| r2                    | varchar   | -1     | 259       | false   |                                                          |
| r3                    | varchar   | -1     | 259       | false   |                                                          |
| r4                    | varchar   | -1     | 259       | false   |                                                          |
| r5                    | numeric   | -1     | -1        | false   |                                                          |
| r6                    | numeric   | -1     | -1        | false   |                                                          |
| r7                    | int4      | 4      | -1        | false   |                                                          |
| r8                    | int4      | 4      | -1        | false   |                                                          |
| r9                    | timestamp | 8      | 6         | false   |                                                          |
| r10                   | timestamp | 8      | 6         | false   |                                                          |
| huifshix              | varchar   | -1     | 259       | false   | 回复时限                                                 |
| zhiljiezhisj          | timestamp | 8      | 6         | false   | 指令截至时间                                             |
| xianslaiy             | varchar   | -1     | 259       | false   | 线索来源                                                 |
| yueduzt               | varchar   | -1     | 259       | false   | 阅读状态，0未阅读，1已阅读                               |
| to_roles              | varchar   | -1     | 259       | false   | 接收角色id                                               |
| chaos_roles           | varchar   | -1     | 259       | false   | 抄送角色id                                               |
| requires              | varchar   | -1     | 259       | false   | 指令要求                                                 |
| lianx_fangs           | varchar   | -1     | 259       | false   | 联系方式                                                 |
| link_person_count     | varchar   | -1     | 259       | false   | 关联人员数量                                             |
| link_person_id        | varchar   | -1     | 259       | false   | 关联人员id                                               |
| link_person           | varchar   | -1     | 259       | false   | 关联人员                                                 |
| cmd_sn                | varchar   | -1     | 259       | false   | 指令编码                                                 |
| to_user_id            | varchar   | -1     | -1        | false   | 接收人id                                                 |
| create_user_id        | varchar   | -1     | -1        | false   | 创建人id                                                 |
| to_user_name          | varchar   | -1     | 259       | false   | 接收人姓名                                               |
| create_user_name      | varchar   | -1     | 259       | false   | 创建人姓名                                               |
| qianszhuangt          | varchar   | -1     | 259       | false   | 签收状态，父节点根据子节点状态汇聚，初始0/n,n是接收人    |
| fankzhuangt           | varchar   | -1     | 259       | false   | 反馈状态，父节点根据子节点状态汇聚，初始0/n              |
| guangkzhuangt         | varchar   | -1     | 259       | false   | 管控状态                                                 |
| zhilleibie            | varchar   | -1     | 259       | false   | 指令类别，核查、核处等                                   |
| color                 | varchar   | -1     | 259       | false   | 指令颜色（字典，唯一）                                   |
| clue_batch            | varchar   | -1     | 259       | false   | 线索批次号                                               |
| cmd_parent_batch      | varchar   | -1     | 259       | false   | 指令父批次号，空则指根指令                               |
| cmd_id                | varchar   | -1     | 259       | false   | 指令id                                                   |
| pid                   | varchar   | -1     | 259       | false   | 父指令id                                                 |
| rid                   | varchar   | -1     | 259       | false   | 根指令id                                                 |
| create_role_id        | varchar   | -1     | 259       | false   | 发起指令班组、角色id                                     |
| to_role_id            | varchar   | -1     | 259       | false   | 接收指令人所属班组、角色id                               |
| create_role_name      | varchar   | -1     | 259       | false   | 发起人所属班组                                           |
| to_role_name          | varchar   | -1     | 259       | false   | 接收人所属班组                                           |
| operate_role_name     | varchar   | -1     | 259       | false   | 操作人角色名称                                           |
| operate_name          | varchar   | -1     | 259       | false   | 操作人名称                                               |
| is_auto_feedback      | varchar   | -1     | 259       | false   | 是否自动反馈，0否，1是，对应对接字段isAutoFeedback       |

### 目标表：

n_command_sum_group_administration_send(领导驾驶舱)

| field              | type      | length | lengthvar | notnull | comment    |
| ------------------ | --------- | ------ | --------- | ------- | ---------- |
| command_sum        | int8      | 8      | -1        | false   | 指令统计   |
| group_code         | varchar   | -1     | 259       | false   | 专班编号   |
| group_name         | varchar   | -1     | 259       | false   | 专班名     |
| administrator_code | varchar   | -1     | 259       | false   | 行政区划号 |
| administrator_name | varchar   | -1     | 259       | false   | 行政区划名 |
| date_time          | date      | 4      | -1        | false   | 日期       |
| create_time        | timestamp | 8      | -1        | false   | 创建时间   |
| remark             | varchar   | -1     | 259       | false   | 备注       |



```
select
    count(distinct t1.rid)       command_sum,
    t1.create_role_id group_code,
    (
        select ssr."ROLE_NAME"
        from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar) = t1.create_role_id limit 1
    ) group_name,
    t1.sender_area_code                                                administrator_code,
    (
        select t_administration.name
        from t_administration
        where t_administration.adcode = t1.sender_area_code limit 1
    )                                                            administrator_name,
    to_date(to_char(t1.create_time, 'yyyy-mm-dd'), 'yyyy-mm-dd') date_time,
    now()                                                        create_time,
    '备注'                                                         remark
from (
         select
             tudcr.*,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tudcr.create_role_id limit 1) sender_area_code,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tudcr.to_role_id limit 1) receiver_area_code
         from tb_uc_duty_cmd_record tudcr
     ) t1
where t1.sender_area_code is not null and t1.create_role_id is not null and t1.to_role_id is not null and t1.status = 'CSZT1-001'
group by t1.sender_area_code, to_char(t1.create_time, 'yyyy-mm-dd'),t1.create_role_id;
```









## tb_uc_duty_cmd_record_n_command_leval_finish_receive

### 转换图：



![5a1cf41493d4430c9474852383c6e63d.jpg](5a1cf41493d4430c9474852383c6e63d.jpg)





### 源表：

tb_uc_duty_cmd_record(指令台)





| field                 | type      | length | lengthvar | notnull | comment                                                  |
| --------------------- | --------- | ------ | --------- | ------- | -------------------------------------------------------- |
| id                    | varchar   | -1     | 259       | true    | 主键                                                     |
| cmd_type              | varchar   | -1     | 259       | false   | 指令类型                                                 |
| cmd_from_user_name    | varchar   | -1     | 259       | false   | 指令发送者，创建人                                       |
| cmd_to_user_name      | varchar   | -1     | 259       | false   | 指令接收者                                               |
| cmd_from_user_id      | varchar   | -1     | 259       | false   | 指令发送用户ID                                           |
| cmd_to_user_id        | varchar   | -1     | 259       | false   | 指令接受用户ID                                           |
| launch_type           | varchar   | -1     | 20        | false   | 发起源类型(0:无;1:线索;2:警情)                           |
| launch_id             | varchar   | -1     | 259       | false   | 发起源ID                                                 |
| from_company          | varchar   | -1     | 259       | false   | 发起单位，创建单位                                       |
| from_company_id       | varchar   | -1     | 259       | false   | 创建单位id                                               |
| to_company            | varchar   | -1     | 259       | false   | 接收单位                                                 |
| to_company_id         | varchar   | -1     | 259       | false   | 接收单位id                                               |
| from_police_type      | varchar   | -1     | 259       | false   | 发起警种                                                 |
| to_police_type        | varchar   | -1     | 259       | false   | 接收警种                                                 |
| administrative_area   | varchar   | -1     | 259       | false   | 行政区划                                                 |
| police_area           | varchar   | -1     | 259       | false   | 警务区划                                                 |
| cmd_batch             | varchar   | -1     | 259       | false   | 指令批次号                                               |
| cmd_param             | text      | -1     | -1        | false   | 指令参数                                                 |
| cmd_title             | varchar   | -1     | 259       | false   | 指令标题                                                 |
| cmd_content           | text      | -1     | -1        | false   | 指令内容                                                 |
| cmd_level_id          | varchar   | -1     | 259       | false   | 指令等级ID                                               |
| sign                  | bool      | 1      | -1        | false   | 是否需要签收                                             |
| sign_timeout          | timestamp | 8      | 6         | false   | 签收超时时间                                             |
| feedback              | bool      | 1      | -1        | false   | 是否需要反馈                                             |
| feedback_timeout      | timestamp | 8      | 6         | false   | 反馈超时时间                                             |
| supervise             | bool      | 1      | -1        | false   | 是否需要督办                                             |
| cmd_status            | varchar   | -1     | 20        | false   | 指令状态(0:待处理;1:已签收;2:已反馈;                     |
| finished              | varchar   | -1     | 20        | false   | 是否完成(0:未完成;1:已完成)（归档状态）                  |
| copy_item             | varchar   | -1     | 20        | false   | 副本类型(1:抄送;2:协作;)                                 |
| create_time           | timestamp | 8      | 6         | false   | 创建时间                                                 |
| source_sys            | varchar   | -1     | 36        | false   | （指令来源）来源系统(1:警辅通;2:警综;3:情报二期;99:其他) |
| remark                | varchar   | -1     | 259       | false   | 备注                                                     |
| file                  | text      | -1     | -1        | false   | 文件                                                     |
| status                | varchar   | -1     | 20        | false   | 0草稿，1正常，2已删除                                    |
| cmd_operate_last_time | timestamp | 8      | 6         | false   |                                                          |
| cmd_operate_last_type | timestamp | 8      | 6         | false   |                                                          |
| cmd_operate_last_id   | timestamp | 8      | 6         | false   |                                                          |
| xzxqbm                | varchar   | -1     | 259       | false   | 行政辖区编码                                             |
| sjxzxqbm              | varchar   | -1     | 259       | false   | 上级行政辖区编码                                         |
| jwxqbm                | varchar   | -1     | 259       | false   | 警务辖区编码                                             |
| sjjwxqbm              | varchar   | -1     | 259       | false   | 上级警务辖区编码                                         |
| r1                    | varchar   | -1     | 259       | false   |                                                          |
| r2                    | varchar   | -1     | 259       | false   |                                                          |
| r3                    | varchar   | -1     | 259       | false   |                                                          |
| r4                    | varchar   | -1     | 259       | false   |                                                          |
| r5                    | numeric   | -1     | -1        | false   |                                                          |
| r6                    | numeric   | -1     | -1        | false   |                                                          |
| r7                    | int4      | 4      | -1        | false   |                                                          |
| r8                    | int4      | 4      | -1        | false   |                                                          |
| r9                    | timestamp | 8      | 6         | false   |                                                          |
| r10                   | timestamp | 8      | 6         | false   |                                                          |
| huifshix              | varchar   | -1     | 259       | false   | 回复时限                                                 |
| zhiljiezhisj          | timestamp | 8      | 6         | false   | 指令截至时间                                             |
| xianslaiy             | varchar   | -1     | 259       | false   | 线索来源                                                 |
| yueduzt               | varchar   | -1     | 259       | false   | 阅读状态，0未阅读，1已阅读                               |
| to_roles              | varchar   | -1     | 259       | false   | 接收角色id                                               |
| chaos_roles           | varchar   | -1     | 259       | false   | 抄送角色id                                               |
| requires              | varchar   | -1     | 259       | false   | 指令要求                                                 |
| lianx_fangs           | varchar   | -1     | 259       | false   | 联系方式                                                 |
| link_person_count     | varchar   | -1     | 259       | false   | 关联人员数量                                             |
| link_person_id        | varchar   | -1     | 259       | false   | 关联人员id                                               |
| link_person           | varchar   | -1     | 259       | false   | 关联人员                                                 |
| cmd_sn                | varchar   | -1     | 259       | false   | 指令编码                                                 |
| to_user_id            | varchar   | -1     | -1        | false   | 接收人id                                                 |
| create_user_id        | varchar   | -1     | -1        | false   | 创建人id                                                 |
| to_user_name          | varchar   | -1     | 259       | false   | 接收人姓名                                               |
| create_user_name      | varchar   | -1     | 259       | false   | 创建人姓名                                               |
| qianszhuangt          | varchar   | -1     | 259       | false   | 签收状态，父节点根据子节点状态汇聚，初始0/n,n是接收人    |
| fankzhuangt           | varchar   | -1     | 259       | false   | 反馈状态，父节点根据子节点状态汇聚，初始0/n              |
| guangkzhuangt         | varchar   | -1     | 259       | false   | 管控状态                                                 |
| zhilleibie            | varchar   | -1     | 259       | false   | 指令类别，核查、核处等                                   |
| color                 | varchar   | -1     | 259       | false   | 指令颜色（字典，唯一）                                   |
| clue_batch            | varchar   | -1     | 259       | false   | 线索批次号                                               |
| cmd_parent_batch      | varchar   | -1     | 259       | false   | 指令父批次号，空则指根指令                               |
| cmd_id                | varchar   | -1     | 259       | false   | 指令id                                                   |
| pid                   | varchar   | -1     | 259       | false   | 父指令id                                                 |
| rid                   | varchar   | -1     | 259       | false   | 根指令id                                                 |
| create_role_id        | varchar   | -1     | 259       | false   | 发起指令班组、角色id                                     |
| to_role_id            | varchar   | -1     | 259       | false   | 接收指令人所属班组、角色id                               |
| create_role_name      | varchar   | -1     | 259       | false   | 发起人所属班组                                           |
| to_role_name          | varchar   | -1     | 259       | false   | 接收人所属班组                                           |
| operate_role_name     | varchar   | -1     | 259       | false   | 操作人角色名称                                           |
| operate_name          | varchar   | -1     | 259       | false   | 操作人名称                                               |
| is_auto_feedback      | varchar   | -1     | 259       | false   | 是否自动反馈，0否，1是，对应对接字段isAutoFeedback       |



### 目标表：

n_command_leval_finish_receive（领导驾驶舱）



| field              | type      | length | lengthvar | notnull | comment          |
| ------------------ | --------- | ------ | --------- | ------- | ---------------- |
| level_id           | varchar   | -1     | 259       | false   | 等级ID           |
| cmd_finished       | varchar   | -1     | 259       | false   | 指令归档状态     |
| cmd_sum            | int8      | 8      | -1        | false   | 指令归档状态统计 |
| administrator_code | varchar   | -1     | 259       | false   | 行政区划号       |
| administrator_name | varchar   | -1     | 259       | false   | 行政区划名       |
| date_time          | date      | 4      | -1        | false   | 日期             |
| create_time        | timestamp | 8      | -1        | false   | 创建时间         |
| remark             | varchar   | -1     | 259       | false   | 备注             |





```
select t1.cmd_level_id                                                  level_id,
       count(1)                                                         cmd_sum,
       t1.finished                                                      cmd_finished,
       t1.receiver_area_code                                            administrator_code,
       (
           select t_administration.name
           from t_administration
           where t_administration.adcode = t1.receiver_area_code
       )                                                            administrator_name,
       to_date(to_char(t1.create_time, 'yyyy-mm-dd'), 'yyyy-mm-dd') date_time,
       now()                                                        create_time,
       '备注'                                                         remark
from (
         select
             tudcr.*,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tudcr.create_role_id limit 1) sender_area_code,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tudcr.to_role_id limit 1) receiver_area_code
         from tb_uc_duty_cmd_record tudcr
     ) t1
where t1.receiver_area_code is not null and t1.create_role_id is not null and t1.to_role_id is not null and t1.status = 'CSZT1-001'
group by t1.receiver_area_code, to_char(t1.create_time, 'yyyy-mm-dd'),  t1.cmd_level_id,t1.finished;
```











## tb_uc_duty_cmd_record_2_n_command_sum_group_administration_send

### 转换图：



![fbf9f0ce48ed4428a48f6061413d964a.jpg](http://localhost/lyt-lytdoc/file/preview/fbf9f0ce48ed4428a48f6061413d964a.jpg)



### 源表：

tb_uc_duty_cmd_record（指令中台）

| field                 | type      | length | lengthvar | notnull | comment                                                  |
| --------------------- | --------- | ------ | --------- | ------- | -------------------------------------------------------- |
| id                    | varchar   | -1     | 259       | true    | 主键                                                     |
| cmd_type              | varchar   | -1     | 259       | false   | 指令类型                                                 |
| cmd_from_user_name    | varchar   | -1     | 259       | false   | 指令发送者，创建人                                       |
| cmd_to_user_name      | varchar   | -1     | 259       | false   | 指令接收者                                               |
| cmd_from_user_id      | varchar   | -1     | 259       | false   | 指令发送用户ID                                           |
| cmd_to_user_id        | varchar   | -1     | 259       | false   | 指令接受用户ID                                           |
| launch_type           | varchar   | -1     | 20        | false   | 发起源类型(0:无;1:线索;2:警情)                           |
| launch_id             | varchar   | -1     | 259       | false   | 发起源ID                                                 |
| from_company          | varchar   | -1     | 259       | false   | 发起单位，创建单位                                       |
| from_company_id       | varchar   | -1     | 259       | false   | 创建单位id                                               |
| to_company            | varchar   | -1     | 259       | false   | 接收单位                                                 |
| to_company_id         | varchar   | -1     | 259       | false   | 接收单位id                                               |
| from_police_type      | varchar   | -1     | 259       | false   | 发起警种                                                 |
| to_police_type        | varchar   | -1     | 259       | false   | 接收警种                                                 |
| administrative_area   | varchar   | -1     | 259       | false   | 行政区划                                                 |
| police_area           | varchar   | -1     | 259       | false   | 警务区划                                                 |
| cmd_batch             | varchar   | -1     | 259       | false   | 指令批次号                                               |
| cmd_param             | text      | -1     | -1        | false   | 指令参数                                                 |
| cmd_title             | varchar   | -1     | 259       | false   | 指令标题                                                 |
| cmd_content           | text      | -1     | -1        | false   | 指令内容                                                 |
| cmd_level_id          | varchar   | -1     | 259       | false   | 指令等级ID                                               |
| sign                  | bool      | 1      | -1        | false   | 是否需要签收                                             |
| sign_timeout          | timestamp | 8      | 6         | false   | 签收超时时间                                             |
| feedback              | bool      | 1      | -1        | false   | 是否需要反馈                                             |
| feedback_timeout      | timestamp | 8      | 6         | false   | 反馈超时时间                                             |
| supervise             | bool      | 1      | -1        | false   | 是否需要督办                                             |
| cmd_status            | varchar   | -1     | 20        | false   | 指令状态(0:待处理;1:已签收;2:已反馈;                     |
| finished              | varchar   | -1     | 20        | false   | 是否完成(0:未完成;1:已完成)（归档状态）                  |
| copy_item             | varchar   | -1     | 20        | false   | 副本类型(1:抄送;2:协作;)                                 |
| create_time           | timestamp | 8      | 6         | false   | 创建时间                                                 |
| source_sys            | varchar   | -1     | 36        | false   | （指令来源）来源系统(1:警辅通;2:警综;3:情报二期;99:其他) |
| remark                | varchar   | -1     | 259       | false   | 备注                                                     |
| file                  | text      | -1     | -1        | false   | 文件                                                     |
| status                | varchar   | -1     | 20        | false   | 0草稿，1正常，2已删除                                    |
| cmd_operate_last_time | timestamp | 8      | 6         | false   |                                                          |
| cmd_operate_last_type | timestamp | 8      | 6         | false   |                                                          |
| cmd_operate_last_id   | timestamp | 8      | 6         | false   |                                                          |
| xzxqbm                | varchar   | -1     | 259       | false   | 行政辖区编码                                             |
| sjxzxqbm              | varchar   | -1     | 259       | false   | 上级行政辖区编码                                         |
| jwxqbm                | varchar   | -1     | 259       | false   | 警务辖区编码                                             |
| sjjwxqbm              | varchar   | -1     | 259       | false   | 上级警务辖区编码                                         |
| r1                    | varchar   | -1     | 259       | false   |                                                          |
| r2                    | varchar   | -1     | 259       | false   |                                                          |
| r3                    | varchar   | -1     | 259       | false   |                                                          |
| r4                    | varchar   | -1     | 259       | false   |                                                          |
| r5                    | numeric   | -1     | -1        | false   |                                                          |
| r6                    | numeric   | -1     | -1        | false   |                                                          |
| r7                    | int4      | 4      | -1        | false   |                                                          |
| r8                    | int4      | 4      | -1        | false   |                                                          |
| r9                    | timestamp | 8      | 6         | false   |                                                          |
| r10                   | timestamp | 8      | 6         | false   |                                                          |
| huifshix              | varchar   | -1     | 259       | false   | 回复时限                                                 |
| zhiljiezhisj          | timestamp | 8      | 6         | false   | 指令截至时间                                             |
| xianslaiy             | varchar   | -1     | 259       | false   | 线索来源                                                 |
| yueduzt               | varchar   | -1     | 259       | false   | 阅读状态，0未阅读，1已阅读                               |
| to_roles              | varchar   | -1     | 259       | false   | 接收角色id                                               |
| chaos_roles           | varchar   | -1     | 259       | false   | 抄送角色id                                               |
| requires              | varchar   | -1     | 259       | false   | 指令要求                                                 |
| lianx_fangs           | varchar   | -1     | 259       | false   | 联系方式                                                 |
| link_person_count     | varchar   | -1     | 259       | false   | 关联人员数量                                             |
| link_person_id        | varchar   | -1     | 259       | false   | 关联人员id                                               |
| link_person           | varchar   | -1     | 259       | false   | 关联人员                                                 |
| cmd_sn                | varchar   | -1     | 259       | false   | 指令编码                                                 |
| to_user_id            | varchar   | -1     | -1        | false   | 接收人id                                                 |
| create_user_id        | varchar   | -1     | -1        | false   | 创建人id                                                 |
| to_user_name          | varchar   | -1     | 259       | false   | 接收人姓名                                               |
| create_user_name      | varchar   | -1     | 259       | false   | 创建人姓名                                               |
| qianszhuangt          | varchar   | -1     | 259       | false   | 签收状态，父节点根据子节点状态汇聚，初始0/n,n是接收人    |
| fankzhuangt           | varchar   | -1     | 259       | false   | 反馈状态，父节点根据子节点状态汇聚，初始0/n              |
| guangkzhuangt         | varchar   | -1     | 259       | false   | 管控状态                                                 |
| zhilleibie            | varchar   | -1     | 259       | false   | 指令类别，核查、核处等                                   |
| color                 | varchar   | -1     | 259       | false   | 指令颜色（字典，唯一）                                   |
| clue_batch            | varchar   | -1     | 259       | false   | 线索批次号                                               |
| cmd_parent_batch      | varchar   | -1     | 259       | false   | 指令父批次号，空则指根指令                               |
| cmd_id                | varchar   | -1     | 259       | false   | 指令id                                                   |
| pid                   | varchar   | -1     | 259       | false   | 父指令id                                                 |
| rid                   | varchar   | -1     | 259       | false   | 根指令id                                                 |
| create_role_id        | varchar   | -1     | 259       | false   | 发起指令班组、角色id                                     |
| to_role_id            | varchar   | -1     | 259       | false   | 接收指令人所属班组、角色id                               |
| create_role_name      | varchar   | -1     | 259       | false   | 发起人所属班组                                           |
| to_role_name          | varchar   | -1     | 259       | false   | 接收人所属班组                                           |
| operate_role_name     | varchar   | -1     | 259       | false   | 操作人角色名称                                           |
| operate_name          | varchar   | -1     | 259       | false   | 操作人名称                                               |
| is_auto_feedback      | varchar   | -1     | 259       | false   | 是否自动反馈，0否，1是，对应对接字段isAutoFeedback       |

### 目标表：

n_command_sum_group_administration_send(领导驾驶舱)



| field              | type      | length | lengthvar | notnull | comment    |
| ------------------ | --------- | ------ | --------- | ------- | ---------- |
| command_sum        | int8      | 8      | -1        | false   | 指令统计   |
| group_code         | varchar   | -1     | 259       | false   | 专班编号   |
| group_name         | varchar   | -1     | 259       | false   | 专班名     |
| administrator_code | varchar   | -1     | 259       | false   | 行政区划号 |
| administrator_name | varchar   | -1     | 259       | false   | 行政区划名 |
| date_time          | date      | 4      | -1        | false   | 日期       |
| create_time        | timestamp | 8      | -1        | false   | 创建时间   |
| remark             | varchar   | -1     | 259       | false   | 备注       |





```
select
    count(distinct t1.rid)       command_sum,
    t1.create_role_id group_code,
    (
        select ssr."ROLE_NAME"
        from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar) = t1.create_role_id limit 1
    ) group_name,
    t1.sender_area_code                                                administrator_code,
    (
        select t_administration.name
        from t_administration
        where t_administration.adcode = t1.sender_area_code limit 1
    )                                                            administrator_name,
    to_date(to_char(t1.create_time, 'yyyy-mm-dd'), 'yyyy-mm-dd') date_time,
    now()                                                        create_time,
    '备注'                                                         remark
from (
         select
             tudcr.*,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tudcr.create_role_id limit 1) sender_area_code,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tudcr.to_role_id limit 1) receiver_area_code
         from tb_uc_duty_cmd_record tudcr
     ) t1
where t1.sender_area_code is not null and t1.create_role_id is not null and t1.to_role_id is not null and t1.status = 'CSZT1-001'
group by t1.sender_area_code, to_char(t1.create_time, 'yyyy-mm-dd'),t1.create_role_id;
```







## tb_uc_duty_cmd_record_2_n_command_sum_group_administration_receive

### 转换图：



![84e1c61c2f094cfa9efa1393435266f9.jpg](http://localhost/lyt-lytdoc/file/preview/84e1c61c2f094cfa9efa1393435266f9.jpg)







### 源表：

tb_uc_duty_cmd_record(指令中台)



| field                 | type      | length | lengthvar | notnull | comment                                                  |
| --------------------- | --------- | ------ | --------- | ------- | -------------------------------------------------------- |
| id                    | varchar   | -1     | 259       | true    | 主键                                                     |
| cmd_type              | varchar   | -1     | 259       | false   | 指令类型                                                 |
| cmd_from_user_name    | varchar   | -1     | 259       | false   | 指令发送者，创建人                                       |
| cmd_to_user_name      | varchar   | -1     | 259       | false   | 指令接收者                                               |
| cmd_from_user_id      | varchar   | -1     | 259       | false   | 指令发送用户ID                                           |
| cmd_to_user_id        | varchar   | -1     | 259       | false   | 指令接受用户ID                                           |
| launch_type           | varchar   | -1     | 20        | false   | 发起源类型(0:无;1:线索;2:警情)                           |
| launch_id             | varchar   | -1     | 259       | false   | 发起源ID                                                 |
| from_company          | varchar   | -1     | 259       | false   | 发起单位，创建单位                                       |
| from_company_id       | varchar   | -1     | 259       | false   | 创建单位id                                               |
| to_company            | varchar   | -1     | 259       | false   | 接收单位                                                 |
| to_company_id         | varchar   | -1     | 259       | false   | 接收单位id                                               |
| from_police_type      | varchar   | -1     | 259       | false   | 发起警种                                                 |
| to_police_type        | varchar   | -1     | 259       | false   | 接收警种                                                 |
| administrative_area   | varchar   | -1     | 259       | false   | 行政区划                                                 |
| police_area           | varchar   | -1     | 259       | false   | 警务区划                                                 |
| cmd_batch             | varchar   | -1     | 259       | false   | 指令批次号                                               |
| cmd_param             | text      | -1     | -1        | false   | 指令参数                                                 |
| cmd_title             | varchar   | -1     | 259       | false   | 指令标题                                                 |
| cmd_content           | text      | -1     | -1        | false   | 指令内容                                                 |
| cmd_level_id          | varchar   | -1     | 259       | false   | 指令等级ID                                               |
| sign                  | bool      | 1      | -1        | false   | 是否需要签收                                             |
| sign_timeout          | timestamp | 8      | 6         | false   | 签收超时时间                                             |
| feedback              | bool      | 1      | -1        | false   | 是否需要反馈                                             |
| feedback_timeout      | timestamp | 8      | 6         | false   | 反馈超时时间                                             |
| supervise             | bool      | 1      | -1        | false   | 是否需要督办                                             |
| cmd_status            | varchar   | -1     | 20        | false   | 指令状态(0:待处理;1:已签收;2:已反馈;                     |
| finished              | varchar   | -1     | 20        | false   | 是否完成(0:未完成;1:已完成)（归档状态）                  |
| copy_item             | varchar   | -1     | 20        | false   | 副本类型(1:抄送;2:协作;)                                 |
| create_time           | timestamp | 8      | 6         | false   | 创建时间                                                 |
| source_sys            | varchar   | -1     | 36        | false   | （指令来源）来源系统(1:警辅通;2:警综;3:情报二期;99:其他) |
| remark                | varchar   | -1     | 259       | false   | 备注                                                     |
| file                  | text      | -1     | -1        | false   | 文件                                                     |
| status                | varchar   | -1     | 20        | false   | 0草稿，1正常，2已删除                                    |
| cmd_operate_last_time | timestamp | 8      | 6         | false   |                                                          |
| cmd_operate_last_type | timestamp | 8      | 6         | false   |                                                          |
| cmd_operate_last_id   | timestamp | 8      | 6         | false   |                                                          |
| xzxqbm                | varchar   | -1     | 259       | false   | 行政辖区编码                                             |
| sjxzxqbm              | varchar   | -1     | 259       | false   | 上级行政辖区编码                                         |
| jwxqbm                | varchar   | -1     | 259       | false   | 警务辖区编码                                             |
| sjjwxqbm              | varchar   | -1     | 259       | false   | 上级警务辖区编码                                         |
| r1                    | varchar   | -1     | 259       | false   |                                                          |
| r2                    | varchar   | -1     | 259       | false   |                                                          |
| r3                    | varchar   | -1     | 259       | false   |                                                          |
| r4                    | varchar   | -1     | 259       | false   |                                                          |
| r5                    | numeric   | -1     | -1        | false   |                                                          |
| r6                    | numeric   | -1     | -1        | false   |                                                          |
| r7                    | int4      | 4      | -1        | false   |                                                          |
| r8                    | int4      | 4      | -1        | false   |                                                          |
| r9                    | timestamp | 8      | 6         | false   |                                                          |
| r10                   | timestamp | 8      | 6         | false   |                                                          |
| huifshix              | varchar   | -1     | 259       | false   | 回复时限                                                 |
| zhiljiezhisj          | timestamp | 8      | 6         | false   | 指令截至时间                                             |
| xianslaiy             | varchar   | -1     | 259       | false   | 线索来源                                                 |
| yueduzt               | varchar   | -1     | 259       | false   | 阅读状态，0未阅读，1已阅读                               |
| to_roles              | varchar   | -1     | 259       | false   | 接收角色id                                               |
| chaos_roles           | varchar   | -1     | 259       | false   | 抄送角色id                                               |
| requires              | varchar   | -1     | 259       | false   | 指令要求                                                 |
| lianx_fangs           | varchar   | -1     | 259       | false   | 联系方式                                                 |
| link_person_count     | varchar   | -1     | 259       | false   | 关联人员数量                                             |
| link_person_id        | varchar   | -1     | 259       | false   | 关联人员id                                               |
| link_person           | varchar   | -1     | 259       | false   | 关联人员                                                 |
| cmd_sn                | varchar   | -1     | 259       | false   | 指令编码                                                 |
| to_user_id            | varchar   | -1     | -1        | false   | 接收人id                                                 |
| create_user_id        | varchar   | -1     | -1        | false   | 创建人id                                                 |
| to_user_name          | varchar   | -1     | 259       | false   | 接收人姓名                                               |
| create_user_name      | varchar   | -1     | 259       | false   | 创建人姓名                                               |
| qianszhuangt          | varchar   | -1     | 259       | false   | 签收状态，父节点根据子节点状态汇聚，初始0/n,n是接收人    |
| fankzhuangt           | varchar   | -1     | 259       | false   | 反馈状态，父节点根据子节点状态汇聚，初始0/n              |
| guangkzhuangt         | varchar   | -1     | 259       | false   | 管控状态                                                 |
| zhilleibie            | varchar   | -1     | 259       | false   | 指令类别，核查、核处等                                   |
| color                 | varchar   | -1     | 259       | false   | 指令颜色（字典，唯一）                                   |
| clue_batch            | varchar   | -1     | 259       | false   | 线索批次号                                               |
| cmd_parent_batch      | varchar   | -1     | 259       | false   | 指令父批次号，空则指根指令                               |
| cmd_id                | varchar   | -1     | 259       | false   | 指令id                                                   |
| pid                   | varchar   | -1     | 259       | false   | 父指令id                                                 |
| rid                   | varchar   | -1     | 259       | false   | 根指令id                                                 |
| create_role_id        | varchar   | -1     | 259       | false   | 发起指令班组、角色id                                     |
| to_role_id            | varchar   | -1     | 259       | false   | 接收指令人所属班组、角色id                               |
| create_role_name      | varchar   | -1     | 259       | false   | 发起人所属班组                                           |
| to_role_name          | varchar   | -1     | 259       | false   | 接收人所属班组                                           |
| operate_role_name     | varchar   | -1     | 259       | false   | 操作人角色名称                                           |
| operate_name          | varchar   | -1     | 259       | false   | 操作人名称                                               |
| is_auto_feedback      | varchar   | -1     | 259       | false   | 是否自动反馈，0否，1是，对应对接字段isAutoFeedback       |



### 目标表：

n_command_sum_group_administration_receive （领导驾驶舱）



| field              | type      | length | lengthvar | notnull | comment    |
| ------------------ | --------- | ------ | --------- | ------- | ---------- |
| command_sum        | int8      | 8      | -1        | false   | 指令统计   |
| group_code         | varchar   | -1     | 259       | false   | 专班编号   |
| group_name         | varchar   | -1     | 259       | false   | 专班名     |
| administrator_code | varchar   | -1     | 259       | false   | 行政区划号 |
| administrator_name | varchar   | -1     | 259       | false   | 行政区划名 |
| date_time          | date      | 4      | -1        | false   | 日期       |
| create_time        | timestamp | 8      | -1        | false   | 创建时间   |
| remark             | varchar   | -1     | 259       | false   | 备注       |



```
select
    count(1) command_sum,
    t1.to_role_id group_code,
    (
        select ssr."ROLE_NAME"
        from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar) = t1.to_role_id limit 1
    ) group_name,
    t1.receiver_area_code                                                administrator_code,
    (
        select t_administration.name
        from t_administration
        where t_administration.adcode = t1.receiver_area_code limit 1
    )                                                            administrator_name,
    to_date(to_char(t1.create_time, 'yyyy-mm-dd'), 'yyyy-mm-dd') date_time,
    now()                                                        create_time,
    '备注'                                                         remark
from (
         select
             tudcr.*,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tudcr.create_role_id limit 1) sender_area_code,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tudcr.to_role_id limit 1) receiver_area_code
         from tb_uc_duty_cmd_record tudcr
     ) t1
where t1.receiver_area_code is not null and t1.create_role_id is not null and t1.to_role_id is not null and t1.status = 'CSZT1-001'
group by t1.receiver_area_code, to_char(t1.create_time, 'yyyy-mm-dd'),t1.to_role_id;
```







## tb_uc_duty_cmd_record_2_n_command_finish_clue_class_send





### kettle转换图：

![40faa09368544a8b8d7a787750020316.jpg](http://localhost/lyt-lytdoc/file/preview/40faa09368544a8b8d7a787750020316.jpg)



### 源表：

tb_uc_duty_cmd_record（指令中台）





| field                 | type      | length | lengthvar | notnull | comment                                                  |
| --------------------- | --------- | ------ | --------- | ------- | -------------------------------------------------------- |
| id                    | varchar   | -1     | 259       | true    | 主键                                                     |
| cmd_type              | varchar   | -1     | 259       | false   | 指令类型                                                 |
| cmd_from_user_name    | varchar   | -1     | 259       | false   | 指令发送者，创建人                                       |
| cmd_to_user_name      | varchar   | -1     | 259       | false   | 指令接收者                                               |
| cmd_from_user_id      | varchar   | -1     | 259       | false   | 指令发送用户ID                                           |
| cmd_to_user_id        | varchar   | -1     | 259       | false   | 指令接受用户ID                                           |
| launch_type           | varchar   | -1     | 20        | false   | 发起源类型(0:无;1:线索;2:警情)                           |
| launch_id             | varchar   | -1     | 259       | false   | 发起源ID                                                 |
| from_company          | varchar   | -1     | 259       | false   | 发起单位，创建单位                                       |
| from_company_id       | varchar   | -1     | 259       | false   | 创建单位id                                               |
| to_company            | varchar   | -1     | 259       | false   | 接收单位                                                 |
| to_company_id         | varchar   | -1     | 259       | false   | 接收单位id                                               |
| from_police_type      | varchar   | -1     | 259       | false   | 发起警种                                                 |
| to_police_type        | varchar   | -1     | 259       | false   | 接收警种                                                 |
| administrative_area   | varchar   | -1     | 259       | false   | 行政区划                                                 |
| police_area           | varchar   | -1     | 259       | false   | 警务区划                                                 |
| cmd_batch             | varchar   | -1     | 259       | false   | 指令批次号                                               |
| cmd_param             | text      | -1     | -1        | false   | 指令参数                                                 |
| cmd_title             | varchar   | -1     | 259       | false   | 指令标题                                                 |
| cmd_content           | text      | -1     | -1        | false   | 指令内容                                                 |
| cmd_level_id          | varchar   | -1     | 259       | false   | 指令等级ID                                               |
| sign                  | bool      | 1      | -1        | false   | 是否需要签收                                             |
| sign_timeout          | timestamp | 8      | 6         | false   | 签收超时时间                                             |
| feedback              | bool      | 1      | -1        | false   | 是否需要反馈                                             |
| feedback_timeout      | timestamp | 8      | 6         | false   | 反馈超时时间                                             |
| supervise             | bool      | 1      | -1        | false   | 是否需要督办                                             |
| cmd_status            | varchar   | -1     | 20        | false   | 指令状态(0:待处理;1:已签收;2:已反馈;                     |
| finished              | varchar   | -1     | 20        | false   | 是否完成(0:未完成;1:已完成)（归档状态）                  |
| copy_item             | varchar   | -1     | 20        | false   | 副本类型(1:抄送;2:协作;)                                 |
| create_time           | timestamp | 8      | 6         | false   | 创建时间                                                 |
| source_sys            | varchar   | -1     | 36        | false   | （指令来源）来源系统(1:警辅通;2:警综;3:情报二期;99:其他) |
| remark                | varchar   | -1     | 259       | false   | 备注                                                     |
| file                  | text      | -1     | -1        | false   | 文件                                                     |
| status                | varchar   | -1     | 20        | false   | 0草稿，1正常，2已删除                                    |
| cmd_operate_last_time | timestamp | 8      | 6         | false   |                                                          |
| cmd_operate_last_type | timestamp | 8      | 6         | false   |                                                          |
| cmd_operate_last_id   | timestamp | 8      | 6         | false   |                                                          |
| xzxqbm                | varchar   | -1     | 259       | false   | 行政辖区编码                                             |
| sjxzxqbm              | varchar   | -1     | 259       | false   | 上级行政辖区编码                                         |
| jwxqbm                | varchar   | -1     | 259       | false   | 警务辖区编码                                             |
| sjjwxqbm              | varchar   | -1     | 259       | false   | 上级警务辖区编码                                         |
| r1                    | varchar   | -1     | 259       | false   |                                                          |
| r2                    | varchar   | -1     | 259       | false   |                                                          |
| r3                    | varchar   | -1     | 259       | false   |                                                          |
| r4                    | varchar   | -1     | 259       | false   |                                                          |
| r5                    | numeric   | -1     | -1        | false   |                                                          |
| r6                    | numeric   | -1     | -1        | false   |                                                          |
| r7                    | int4      | 4      | -1        | false   |                                                          |
| r8                    | int4      | 4      | -1        | false   |                                                          |
| r9                    | timestamp | 8      | 6         | false   |                                                          |
| r10                   | timestamp | 8      | 6         | false   |                                                          |
| huifshix              | varchar   | -1     | 259       | false   | 回复时限                                                 |
| zhiljiezhisj          | timestamp | 8      | 6         | false   | 指令截至时间                                             |
| xianslaiy             | varchar   | -1     | 259       | false   | 线索来源                                                 |
| yueduzt               | varchar   | -1     | 259       | false   | 阅读状态，0未阅读，1已阅读                               |
| to_roles              | varchar   | -1     | 259       | false   | 接收角色id                                               |
| chaos_roles           | varchar   | -1     | 259       | false   | 抄送角色id                                               |
| requires              | varchar   | -1     | 259       | false   | 指令要求                                                 |
| lianx_fangs           | varchar   | -1     | 259       | false   | 联系方式                                                 |
| link_person_count     | varchar   | -1     | 259       | false   | 关联人员数量                                             |
| link_person_id        | varchar   | -1     | 259       | false   | 关联人员id                                               |
| link_person           | varchar   | -1     | 259       | false   | 关联人员                                                 |
| cmd_sn                | varchar   | -1     | 259       | false   | 指令编码                                                 |
| to_user_id            | varchar   | -1     | -1        | false   | 接收人id                                                 |
| create_user_id        | varchar   | -1     | -1        | false   | 创建人id                                                 |
| to_user_name          | varchar   | -1     | 259       | false   | 接收人姓名                                               |
| create_user_name      | varchar   | -1     | 259       | false   | 创建人姓名                                               |
| qianszhuangt          | varchar   | -1     | 259       | false   | 签收状态，父节点根据子节点状态汇聚，初始0/n,n是接收人    |
| fankzhuangt           | varchar   | -1     | 259       | false   | 反馈状态，父节点根据子节点状态汇聚，初始0/n              |
| guangkzhuangt         | varchar   | -1     | 259       | false   | 管控状态                                                 |
| zhilleibie            | varchar   | -1     | 259       | false   | 指令类别，核查、核处等                                   |
| color                 | varchar   | -1     | 259       | false   | 指令颜色（字典，唯一）                                   |
| clue_batch            | varchar   | -1     | 259       | false   | 线索批次号                                               |
| cmd_parent_batch      | varchar   | -1     | 259       | false   | 指令父批次号，空则指根指令                               |
| cmd_id                | varchar   | -1     | 259       | false   | 指令id                                                   |
| pid                   | varchar   | -1     | 259       | false   | 父指令id                                                 |
| rid                   | varchar   | -1     | 259       | false   | 根指令id                                                 |
| create_role_id        | varchar   | -1     | 259       | false   | 发起指令班组、角色id                                     |
| to_role_id            | varchar   | -1     | 259       | false   | 接收指令人所属班组、角色id                               |
| create_role_name      | varchar   | -1     | 259       | false   | 发起人所属班组                                           |
| to_role_name          | varchar   | -1     | 259       | false   | 接收人所属班组                                           |
| operate_role_name     | varchar   | -1     | 259       | false   | 操作人角色名称                                           |
| operate_name          | varchar   | -1     | 259       | false   | 操作人名称                                               |
| is_auto_feedback      | varchar   | -1     | 259       | false   | 是否自动反馈，0否，1是，对应对接字段isAutoFeedback       |



### 目标表：

n_command_finish_clue_class_send（领导驾驶舱）



| field              | type      | length | lengthvar | notnull | comment          |
| ------------------ | --------- | ------ | --------- | ------- | ---------------- |
| clue_class         | varchar   | -1     | 259       | true    | 线索类型         |
| cmd_finished       | varchar   | -1     | 259       | true    | 指令归档状态     |
| cmd_finished_sum   | int8      | 8      | -1        | true    | 指令归档状态统计 |
| administrator_code | varchar   | -1     | 259       | true    | 行政区划号       |
| administrator_name | varchar   | -1     | 259       | false   | 行政区划名       |
| date_time          | date      | 4      | -1        | true    | 日期             |
| create_time        | timestamp | 8      | -1        | false   | 创建时间         |
| remark             | varchar   | -1     | 259       | false   | 备注             |





```
select
    coalesce(t1.clue_class,'SSLB-000') clue_class,
    t1.finished cmd_finished,
    count(distinct t1.rid)      cmd_finished_sum,
    t1.sender_area_code                                                administrator_code,
    (
        select t_administration.name
        from t_administration
        where t_administration.adcode = t1.sender_area_code limit 1
    )                                                            administrator_name,
    to_date(to_char(t1.create_time, 'yyyy-mm-dd'), 'yyyy-mm-dd') date_time,
    now()                                                        create_time,
    '备注'                                                         remark
from (
         select
             tudcr.*,
             (select tuc.clue_class from tb_uc_clue tuc  where tuc.clue_batch = tudcr.clue_batch limit 1) clue_class,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tudcr.create_role_id limit 1) sender_area_code,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tudcr.to_role_id limit 1) receiver_area_code
         from tb_uc_duty_cmd_record tudcr
     ) t1
where t1.sender_area_code is not null and t1.create_role_id is not null and t1.to_role_id is not null and t1.status = 'CSZT1-001'
group by t1.sender_area_code, to_char(t1.create_time, 'yyyy-mm-dd'), t1.clue_class,t1.finished;
```







## tb_uc_duty_cmd_record_2_n_command_finish_clue_class_receive



### 转换图：

![36762992422047efbb4e9316fa708a62.jpg](http://localhost/lyt-lytdoc/file/preview/36762992422047efbb4e9316fa708a62.jpg)



### 源表：

tb_uc_duty_cmd_record（指令中台）

| field                 | type      | length | lengthvar | notnull | comment                                                  |
| --------------------- | --------- | ------ | --------- | ------- | -------------------------------------------------------- |
| id                    | varchar   | -1     | 259       | true    | 主键                                                     |
| cmd_type              | varchar   | -1     | 259       | false   | 指令类型                                                 |
| cmd_from_user_name    | varchar   | -1     | 259       | false   | 指令发送者，创建人                                       |
| cmd_to_user_name      | varchar   | -1     | 259       | false   | 指令接收者                                               |
| cmd_from_user_id      | varchar   | -1     | 259       | false   | 指令发送用户ID                                           |
| cmd_to_user_id        | varchar   | -1     | 259       | false   | 指令接受用户ID                                           |
| launch_type           | varchar   | -1     | 20        | false   | 发起源类型(0:无;1:线索;2:警情)                           |
| launch_id             | varchar   | -1     | 259       | false   | 发起源ID                                                 |
| from_company          | varchar   | -1     | 259       | false   | 发起单位，创建单位                                       |
| from_company_id       | varchar   | -1     | 259       | false   | 创建单位id                                               |
| to_company            | varchar   | -1     | 259       | false   | 接收单位                                                 |
| to_company_id         | varchar   | -1     | 259       | false   | 接收单位id                                               |
| from_police_type      | varchar   | -1     | 259       | false   | 发起警种                                                 |
| to_police_type        | varchar   | -1     | 259       | false   | 接收警种                                                 |
| administrative_area   | varchar   | -1     | 259       | false   | 行政区划                                                 |
| police_area           | varchar   | -1     | 259       | false   | 警务区划                                                 |
| cmd_batch             | varchar   | -1     | 259       | false   | 指令批次号                                               |
| cmd_param             | text      | -1     | -1        | false   | 指令参数                                                 |
| cmd_title             | varchar   | -1     | 259       | false   | 指令标题                                                 |
| cmd_content           | text      | -1     | -1        | false   | 指令内容                                                 |
| cmd_level_id          | varchar   | -1     | 259       | false   | 指令等级ID                                               |
| sign                  | bool      | 1      | -1        | false   | 是否需要签收                                             |
| sign_timeout          | timestamp | 8      | 6         | false   | 签收超时时间                                             |
| feedback              | bool      | 1      | -1        | false   | 是否需要反馈                                             |
| feedback_timeout      | timestamp | 8      | 6         | false   | 反馈超时时间                                             |
| supervise             | bool      | 1      | -1        | false   | 是否需要督办                                             |
| cmd_status            | varchar   | -1     | 20        | false   | 指令状态(0:待处理;1:已签收;2:已反馈;                     |
| finished              | varchar   | -1     | 20        | false   | 是否完成(0:未完成;1:已完成)（归档状态）                  |
| copy_item             | varchar   | -1     | 20        | false   | 副本类型(1:抄送;2:协作;)                                 |
| create_time           | timestamp | 8      | 6         | false   | 创建时间                                                 |
| source_sys            | varchar   | -1     | 36        | false   | （指令来源）来源系统(1:警辅通;2:警综;3:情报二期;99:其他) |
| remark                | varchar   | -1     | 259       | false   | 备注                                                     |
| file                  | text      | -1     | -1        | false   | 文件                                                     |
| status                | varchar   | -1     | 20        | false   | 0草稿，1正常，2已删除                                    |
| cmd_operate_last_time | timestamp | 8      | 6         | false   |                                                          |
| cmd_operate_last_type | timestamp | 8      | 6         | false   |                                                          |
| cmd_operate_last_id   | timestamp | 8      | 6         | false   |                                                          |
| xzxqbm                | varchar   | -1     | 259       | false   | 行政辖区编码                                             |
| sjxzxqbm              | varchar   | -1     | 259       | false   | 上级行政辖区编码                                         |
| jwxqbm                | varchar   | -1     | 259       | false   | 警务辖区编码                                             |
| sjjwxqbm              | varchar   | -1     | 259       | false   | 上级警务辖区编码                                         |
| r1                    | varchar   | -1     | 259       | false   |                                                          |
| r2                    | varchar   | -1     | 259       | false   |                                                          |
| r3                    | varchar   | -1     | 259       | false   |                                                          |
| r4                    | varchar   | -1     | 259       | false   |                                                          |
| r5                    | numeric   | -1     | -1        | false   |                                                          |
| r6                    | numeric   | -1     | -1        | false   |                                                          |
| r7                    | int4      | 4      | -1        | false   |                                                          |
| r8                    | int4      | 4      | -1        | false   |                                                          |
| r9                    | timestamp | 8      | 6         | false   |                                                          |
| r10                   | timestamp | 8      | 6         | false   |                                                          |
| huifshix              | varchar   | -1     | 259       | false   | 回复时限                                                 |
| zhiljiezhisj          | timestamp | 8      | 6         | false   | 指令截至时间                                             |
| xianslaiy             | varchar   | -1     | 259       | false   | 线索来源                                                 |
| yueduzt               | varchar   | -1     | 259       | false   | 阅读状态，0未阅读，1已阅读                               |
| to_roles              | varchar   | -1     | 259       | false   | 接收角色id                                               |
| chaos_roles           | varchar   | -1     | 259       | false   | 抄送角色id                                               |
| requires              | varchar   | -1     | 259       | false   | 指令要求                                                 |
| lianx_fangs           | varchar   | -1     | 259       | false   | 联系方式                                                 |
| link_person_count     | varchar   | -1     | 259       | false   | 关联人员数量                                             |
| link_person_id        | varchar   | -1     | 259       | false   | 关联人员id                                               |
| link_person           | varchar   | -1     | 259       | false   | 关联人员                                                 |
| cmd_sn                | varchar   | -1     | 259       | false   | 指令编码                                                 |
| to_user_id            | varchar   | -1     | -1        | false   | 接收人id                                                 |
| create_user_id        | varchar   | -1     | -1        | false   | 创建人id                                                 |
| to_user_name          | varchar   | -1     | 259       | false   | 接收人姓名                                               |
| create_user_name      | varchar   | -1     | 259       | false   | 创建人姓名                                               |
| qianszhuangt          | varchar   | -1     | 259       | false   | 签收状态，父节点根据子节点状态汇聚，初始0/n,n是接收人    |
| fankzhuangt           | varchar   | -1     | 259       | false   | 反馈状态，父节点根据子节点状态汇聚，初始0/n              |
| guangkzhuangt         | varchar   | -1     | 259       | false   | 管控状态                                                 |
| zhilleibie            | varchar   | -1     | 259       | false   | 指令类别，核查、核处等                                   |
| color                 | varchar   | -1     | 259       | false   | 指令颜色（字典，唯一）                                   |
| clue_batch            | varchar   | -1     | 259       | false   | 线索批次号                                               |
| cmd_parent_batch      | varchar   | -1     | 259       | false   | 指令父批次号，空则指根指令                               |
| cmd_id                | varchar   | -1     | 259       | false   | 指令id                                                   |
| pid                   | varchar   | -1     | 259       | false   | 父指令id                                                 |
| rid                   | varchar   | -1     | 259       | false   | 根指令id                                                 |
| create_role_id        | varchar   | -1     | 259       | false   | 发起指令班组、角色id                                     |
| to_role_id            | varchar   | -1     | 259       | false   | 接收指令人所属班组、角色id                               |
| create_role_name      | varchar   | -1     | 259       | false   | 发起人所属班组                                           |
| to_role_name          | varchar   | -1     | 259       | false   | 接收人所属班组                                           |
| operate_role_name     | varchar   | -1     | 259       | false   | 操作人角色名称                                           |
| operate_name          | varchar   | -1     | 259       | false   | 操作人名称                                               |
| is_auto_feedback      | varchar   | -1     | 259       | false   | 是否自动反馈，0否，1是，对应对接字段isAutoFeedback       |

目标表：

n_command_finish_clue_class_receive（领导驾驶舱）



| field              | type      | length | lengthvar | notnull | comment          |
| ------------------ | --------- | ------ | --------- | ------- | ---------------- |
| clue_class         | varchar   | -1     | 259       | true    | 线索类型         |
| cmd_finished       | varchar   | -1     | 259       | true    | 指令归档状态     |
| cmd_finished_sum   | int8      | 8      | -1        | true    | 指令归档状态统计 |
| administrator_code | varchar   | -1     | 259       | true    | 行政区划号       |
| administrator_name | varchar   | -1     | 259       | false   | 行政区划名       |
| date_time          | date      | 4      | -1        | true    | 日期             |
| create_time        | timestamp | 8      | -1        | false   | 创建时间         |
| remark             | varchar   | -1     | 259       | false   | 备注             |











```

select
    coalesce(t1.clue_class,'SSLB-000') clue_class,
    t1.finished cmd_finished,
    count(1) cmd_finished_sum,
    t1.receiver_area_code                                                administrator_code,
    (
        select t_administration.name
        from t_administration
        where t_administration.adcode = t1.receiver_area_code limit 1
    )                                                            administrator_name,
    to_date(to_char(t1.create_time, 'yyyy-mm-dd'), 'yyyy-mm-dd') date_time,
    now()                                                        create_time,
    '备注'                                                         remark
from (
         select
             tudcr.*,
             (select tuc.clue_class from tb_uc_clue tuc  where tuc.clue_batch = tudcr.clue_batch limit 1) clue_class,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tudcr.create_role_id limit 1) sender_area_code,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tudcr.to_role_id limit 1) receiver_area_code
         from tb_uc_duty_cmd_record tudcr
     ) t1
where t1.receiver_area_code is not null and t1.create_role_id is not null and t1.to_role_id is not null and t1.status = 'CSZT1-001'
group by t1.receiver_area_code, to_char(t1.create_time, 'yyyy-mm-dd'), t1.clue_class,t1.finished;
```









## tb_uc_duty_cmd_record_2_n_clue_class_send



### 转换图：

![66c65a63330d4de281ee0a8d2e5a7f59.jpg](http://localhost/lyt-lytdoc/file/preview/66c65a63330d4de281ee0a8d2e5a7f59.jpg)



### 源表：

tb_uc_clue（指令中台）

| field                | type      | length | lengthvar | notnull | comment                                                      |
| -------------------- | --------- | ------ | --------- | ------- | ------------------------------------------------------------ |
| id                   | varchar   | -1     | 259       | true    | 主键                                                         |
| clue_sn              | varchar   | -1     | 259       | false   | 线索编号                                                     |
| create_user_name     | varchar   | -1     | 259       | false   | 线索提供人                                                   |
| clue_from            | varchar   | -1     | 259       | false   | 线索来源                                                     |
| clue_to_array        | varchar   | -1     | 259       | false   | 接收单位                                                     |
| clue_title           | varchar   | -1     | 259       | false   | 线索标题                                                     |
| clue_msg             | text      | -1     | -1        | false   | 线索详细(内容)                                               |
| clue_class           | varchar   | -1     | 259       | false   | 涉事类别                                                     |
| clue_department_name | varchar   | -1     | 259       | false   | 线索采集单位                                                 |
| clue_state           | varchar   | -1     | 259       | false   | 线索状态(0:未处理;1:未采纳;2:采纳)                           |
| clue_state_msg       | varchar   | -1     | 259       | false   | 线索状态详细                                                 |
| clue_start_time      | timestamp | 8      | 6         | false   | 线索开始时间                                                 |
| clue_stop_time       | timestamp | 8      | 6         | false   | 线索结束时间                                                 |
| clue_reliability     | varchar   | -1     | 259       | false   | 线索可靠性                                                   |
| clue_urgent          | varchar   | -1     | 259       | false   | 线索紧急程度                                                 |
| clue_important       | varchar   | -1     | 259       | false   | 线索重要性                                                   |
| copy_item            | varchar   | -1     | 259       | false   | 副本类型(1:抄送;)                                            |
| point_start_time     | timestamp | 8      | 6         | false   | 指向开始时间                                                 |
| point_end_time       | timestamp | 8      | 6         | false   | 指向结束时间                                                 |
| point_address        | varchar   | -1     | 259       | false   | 指向地点                                                     |
| study                | varchar   | -1     | 259       | false   | 是否研判(0:否;1:是)                                          |
| study_msg            | varchar   | -1     | 259       | false   | 研判详细                                                     |
| update_user_id       | varchar   | -1     | 259       | false   | 处理人                                                       |
| update_time          | timestamp | 8      | 6         | false   | 处理时间                                                     |
| create_time          | timestamp | 8      | 6         | false   | 创建时间                                                     |
| file                 | text      | -1     | -1        | false   | 文件数组                                                     |
| status               | varchar   | -1     | 259       | false   | 状态，0草稿，1正常，2软删除，CSZT1-002禁用及草稿，001正常，003已软删除 |
| r1                   | varchar   | -1     | 259       | false   |                                                              |
| r2                   | varchar   | -1     | 259       | false   |                                                              |
| r3                   | varchar   | -1     | 259       | false   |                                                              |
| r4                   | varchar   | -1     | 259       | false   |                                                              |
| r5                   | numeric   | -1     | -1        | false   |                                                              |
| r6                   | numeric   | -1     | -1        | false   |                                                              |
| r7                   | int4      | 4      | -1        | false   |                                                              |
| r8                   | int4      | 4      | -1        | false   |                                                              |
| r9                   | timestamp | 8      | 6         | false   |                                                              |
| r10                  | timestamp | 8      | 6         | false   |                                                              |
| user_id              | varchar   | -1     | 259       | false   | 线索提供人id                                                 |
| associated_group     | varchar   | -1     | 259       | false   | 关联群体                                                     |
| link_person          | varchar   | -1     | 259       | false   | 关联人员id                                                   |
| create_user_id       | varchar   | -1     | 36        | false   | 线索创建人id                                                 |
| to_user_id           | varchar   | -1     | -1        | false   | 接受人id                                                     |
| is_time_point        | bool      | 1      | -1        | false   | 是否指向时间,true,false                                      |
| jiesdanwid           | varchar   | -1     | -1        | false   | 接收单位id                                                   |
| chaosdanwid          | varchar   | -1     | -1        | false   | 抄送单位id                                                   |
| link_person_id       | varchar   | -1     | -1        | false   | 关联人员id                                                   |
| link_person_count    | int4      | 4      | -1        | false   | 关联人员数据                                                 |
| to_roles             | varchar   | -1     | 259       | false   | 接收角色id                                                   |
| chaos_roles          | varchar   | -1     | 259       | false   | 抄送角色id                                                   |
| clue_batch           | varchar   | -1     | 259       | false   | 线索批次好，针对上报的                                       |
| create_role_id       | varchar   | -1     | 259       | false   | 发起人所属班组、角色id                                       |
| to_role_id           | varchar   | -1     | 259       | false   | 接收人所属班组、角色id                                       |
| create_role_name     | varchar   | -1     | 259       | false   | 发起人所属班组                                               |
| to_role_name         | varchar   | -1     | 259       | false   | 接收人所属班组                                               |
| operate_role_name    | varchar   | -1     | 259       | false   | 操作人角色名称                                               |
| operate_name         | varchar   | -1     | 259       | false   | 操作人名称                                                   |

### 目标表：

n_clue_class_send（领导驾驶舱）

| field              | type      | length | lengthvar | notnull | comment      |
| ------------------ | --------- | ------ | --------- | ------- | ------------ |
| clue_class         | varchar   | -1     | 259       | false   | 线索类型     |
| clue_class_sum     | int8      | 8      | -1        | false   | 线索类型统计 |
| administrator_code | varchar   | -1     | 259       | false   | 行政区划号   |
| administrator_name | varchar   | -1     | 259       | false   | 行政区划名   |
| date_time          | date      | 4      | -1        | false   | 日期         |
| create_time        | timestamp | 8      | -1        | false   | 创建时间     |
| remark             | varchar   | -1     | 259       | false   | 备注         |





```

select
    t1.clue_class                                                      clue_class,
    count(1) clue_class_sum,
    t1.sender_area_code                                                administrator_code,
    (
        select t_administration.name
        from t_administration
        where t_administration.adcode = t1.sender_area_code limit 1
    )                                                            administrator_name,
    to_date(to_char(t1.create_time, 'yyyy-mm-dd'), 'yyyy-mm-dd') date_time,
    now()                                                        create_time,
    '备注'                                                         remark
from (
         select
             tuc.*,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tuc.create_role_id limit 1) sender_area_code,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tuc.to_role_id limit 1) receiver_area_code
         from tb_uc_clue tuc
     ) t1
where t1.sender_area_code is not null and t1.clue_class is not null and t1.create_role_id is not null and t1.to_role_id is not null
group by t1.sender_area_code, to_char(t1.create_time, 'yyyy-mm-dd'), t1.clue_class;
```







## tb_uc_duty_cmd_record_2_n_clue_class_receive



### 转换图：

![d2d2d2a654c24d6c8469e3819b87fbd8.jpg](http://localhost/lyt-lytdoc/file/preview/d2d2d2a654c24d6c8469e3819b87fbd8.jpg)



### 源表：



tb_uc_clue（指令中台）



数据表结构：参考上述表结构



### 目标表：

n_clue_class_receive



| field              | type      | length | lengthvar | notnull | comment      |
| ------------------ | --------- | ------ | --------- | ------- | ------------ |
| clue_class         | varchar   | -1     | 259       | false   | 线索类型     |
| clue_class_sum     | int8      | 8      | -1        | false   | 线索类型统计 |
| administrator_code | varchar   | -1     | 259       | false   | 行政区划号   |
| administrator_name | varchar   | -1     | 259       | false   | 行政区划名   |
| date_time          | date      | 4      | -1        | false   | 日期         |
| create_time        | timestamp | 8      | -1        | false   | 创建时间     |
| remark             | varchar   | -1     | 259       | false   | 备注         |





```
select
    coalesce(t1.clue_class ,'')                                                     clue_class,
    count(1) clue_class_sum,
    t1.receiver_area_code                                                administrator_code,
    (
        select t_administration.name
        from t_administration
        where t_administration.adcode = t1.receiver_area_code limit 1
    )                                                            administrator_name,
    to_date(to_char(t1.create_time, 'yyyy-mm-dd'), 'yyyy-mm-dd') date_time,
    now()                                                        create_time,
    '备注'                                                         remark
from (
         select
             tuc.*,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tuc.create_role_id limit 1) sender_area_code,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tuc.to_role_id limit 1) receiver_area_code
         from tb_uc_clue tuc
     ) t1
where t1.receiver_area_code is not null and t1.clue_class is not null  and t1.create_role_id is not null and t1.to_role_id is not null 
group by t1.receiver_area_code, to_char(t1.create_time, 'yyyy-mm-dd'), t1.clue_class;


```







## tb_uc_duty_cmd_record_2_command_leval_finish_send



### 转换图

![80b2dc9218fb4d95b353b0a0d364f635.jpg](http://localhost/lyt-lytdoc/file/preview/80b2dc9218fb4d95b353b0a0d364f635.jpg)





### 源表：

tb_uc_duty_cmd_record（指令中台）

数据表结构：参考上述表结构



### 目标表：

n_command_leval_finish_send（领导驾驶舱）

| field              | type      | length | lengthvar | notnull | comment          |
| ------------------ | --------- | ------ | --------- | ------- | ---------------- |
| level_id           | varchar   | -1     | 259       | false   | 等级ID           |
| cmd_finished       | varchar   | -1     | 259       | false   | 指令归档状态     |
| cmd_sum            | int8      | 8      | -1        | false   | 指令归档状态统计 |
| administrator_code | varchar   | -1     | 259       | false   | 行政区划号       |
| administrator_name | varchar   | -1     | 259       | false   | 行政区划名       |
| date_time          | date      | 4      | -1        | false   | 日期             |
| create_time        | timestamp | 8      | -1        | false   | 创建时间         |
| remark             | varchar   | -1     | 259       | false   | 备注             |







```
select t1.cmd_level_id                                                  level_id,
       count(distinct t1.rid)                                                           cmd_sum,
       t1.finished                                                      cmd_finished,
       t1.sender_area_code                                                administrator_code,
       (
           select t_administration.name
           from t_administration
           where t_administration.adcode = t1.sender_area_code
       )                                                            administrator_name,
       to_date(to_char(t1.create_time, 'yyyy-mm-dd'), 'yyyy-mm-dd') date_time,
       now()                                                        create_time,
       '备注'                                                         remark
from (
         select
             tudcr.*,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tudcr.create_role_id limit 1) sender_area_code,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tudcr.to_role_id limit 1) receiver_area_code
         from tb_uc_duty_cmd_record tudcr
     ) t1
where t1.sender_area_code is not null and t1.create_role_id is not null and t1.to_role_id is not null and t1.status = 'CSZT1-001'
group by t1.sender_area_code, to_char(t1.create_time, 'yyyy-mm-dd'), t1.cmd_level_id,t1.finished;
```







## tb_uc_clue_2_n_clue_state_send



![4cd181b6d9e84d69a75976aaf0ef9090.jpg](http://localhost/lyt-lytdoc/file/preview/4cd181b6d9e84d69a75976aaf0ef9090.jpg)



### 源表：

tb_uc_clue（指令中台）

数据表结构：参考上述表结构



### 目标表：

n_clue_state_send



| field              | type      | length | lengthvar | notnull | comment      |
| ------------------ | --------- | ------ | --------- | ------- | ------------ |
| clue_state         | varchar   | -1     | 259       | false   | 线索状态     |
| clue_state_sum     | int8      | 8      | -1        | false   | 线索状态统计 |
| administrator_code | varchar   | -1     | 259       | false   | 行政区划号   |
| administrator_name | varchar   | -1     | 259       | false   | 行政区划名   |
| date_time          | date      | 4      | -1        | false   | 日期         |
| create_time        | timestamp | 8      | -1        | false   | 创建时间     |
| remark             | varchar   | -1     | 259       | false   | 备注         |





```
select
    t1.clue_state                                                      clue_state,
    count(1) clue_state_sum,
    t1.sender_area_code                                                administrator_code,
    (
        select t_administration.name
        from t_administration
        where t_administration.adcode = t1.sender_area_code limit 1
    )                                                            administrator_name,
    to_date(to_char(t1.create_time, 'yyyy-mm-dd'), 'yyyy-mm-dd') date_time,
    now()                                                        create_time,
    '备注'                                                         remark
from (
         select
             tuc.*,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tuc.create_role_id limit 1) sender_area_code,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tuc.to_role_id limit 1) receiver_area_code
         from tb_uc_clue tuc
     ) t1
where t1.sender_area_code is not null and t1.to_role_id is not null and t1.create_role_id is not null
group by t1.sender_area_code, to_char(t1.create_time, 'yyyy-mm-dd'), t1.clue_state;
```









## tb_uc_clue_2_n_clue_state_receive

### 转换图：



![657ddf64841247c9b7d5038d28107bac.jpg](http://localhost/lyt-lytdoc/file/preview/657ddf64841247c9b7d5038d28107bac.jpg)

### 源表：

tb_uc_clue（指令中台）

数据表结构：参考上述表结构





### 目标表：

n_clue_state_receive

| field              | type      | length | lengthvar | notnull | comment      |
| ------------------ | --------- | ------ | --------- | ------- | ------------ |
| clue_state         | varchar   | -1     | 259       | true    | 线索状态     |
| clue_state_sum     | int8      | 8      | -1        | false   | 线索状态统计 |
| administrator_code | varchar   | -1     | 259       | false   | 行政区划号   |
| administrator_name | varchar   | -1     | 259       | false   | 行政区划名   |
| date_time          | date      | 4      | -1        | false   | 日期         |
| create_time        | timestamp | 8      | -1        | false   | 创建时间     |
| remark             | varchar   | -1     | 259       | false   | 备注         |





```
select
    t1.clue_state                                                      clue_state,
    count(1) clue_state_sum,
    t1.receiver_area_code                                                administrator_code,
    (
        select t_administration.name
        from t_administration
        where t_administration.adcode = t1.receiver_area_code limit 1
    )                                                            administrator_name,
    to_date(to_char(t1.create_time, 'yyyy-mm-dd'), 'yyyy-mm-dd') date_time,
    now()                                                        create_time,
    '备注'                                                         remark
from (
         select
             tuc.*,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tuc.create_role_id limit 1) sender_area_code,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tuc.to_role_id limit 1) receiver_area_code
         from tb_uc_clue tuc
     ) t1
where t1.receiver_area_code is not null and t1.to_role_id is not null and t1.create_role_id is not null 
group by t1.receiver_area_code, to_char(t1.create_time, 'yyyy-mm-dd'), t1.clue_state;
```







## ssqbyth_qtsyzjb_2_focus_group_information

### 转换图：



![1115dbcbaa964ed2b23809fea8d8789c.jpg](http://localhost/lyt-lytdoc/file/preview/1115dbcbaa964ed2b23809fea8d8789c.jpg)

### 源表：

d_ssqbyth_qtsyzjb（爱科一体化）

| field              | type      | length | lengthvar | notnull | comment |
| ------------------ | --------- | ------ | --------- | ------- | ------- |
| objectid           | bpchar    | -1     | 40        | true    |         |
| parentindex        | int4      | 4      | -1        | false   |         |
| parentobjectid     | varchar   | -1     | 204       | false   |         |
| parentpropertyname | varchar   | -1     | 68        | false   |         |
| name               | varchar   | -1     | 204       | false   |         |
| state              | int4      | 4      | -1        | false   |         |
| sequenceno         | varchar   | -1     | 204       | false   |         |
| treelistparentid   | varchar   | -1     | 204       | false   |         |
| createdname        | varchar   | -1     | 204       | false   |         |
| idfullpath         | varchar   | -1     | 204       | false   |         |
| namefullpath       | varchar   | -1     | 204       | false   |         |
| createdparentname  | varchar   | -1     | 204       | false   |         |
| sheetcode          | varchar   | -1     | 204       | false   |         |
| workflowversion    | int4      | 4      | -1        | false   |         |
| createdby          | varchar   | -1     | 40        | false   |         |
| createdbyparentid  | varchar   | -1     | 40        | false   |         |
| ownerid            | varchar   | -1     | 40        | false   |         |
| ownerparentid      | varchar   | -1     | 40        | false   |         |
| createdtime        | timestamp | 8      | 6         | false   |         |
| modifiedby         | varchar   | -1     | 204       | false   |         |
| modifiedtime       | timestamp | 8      | 6         | false   |         |
| runninginstanceid  | varchar   | -1     | 40        | false   |         |
| bizsheetversion    | varchar   | -1     | 204       | false   |         |
| flowstatus         | int4      | 4      | -1        | false   |         |
| flowitemid         | varchar   | -1     | 204       | false   |         |
| applytime          | timestamp | 8      | 6         | false   |         |
| quntobjid          | varchar   | -1     | 204       | false   |         |
| quntmc             | varchar   | -1     | 204       | false   |         |
| quntglrs           | float8    | 8      | -1        | false   |         |
| leix               | float8    | 8      | -1        | false   |         |
| zongs              | float8    | 8      | -1        | false   |         |
| qu                 | timestamp | 8      | 6         | false   |         |
| baifb              | float8    | 8      | -1        | false   |         |





### 目标表：



focus_group_information



| field                  | type      | length | lengthvar | notnull | comment      |
| ---------------------- | --------- | ------ | --------- | ------- | ------------ |
| id                     | varchar   | -1     | 54        | true    | 主键ID       |
| data_time              | date      | 4      | -1        | false   | 统计时间     |
| year_month             | varchar   | -1     | 104       | false   | 年月         |
| focus_group_num        | int4      | 4      | -1        | false   | 重点群体总数 |
| focus_group_person_num | int4      | 4      | -1        | false   | 重点群体人数 |
| create_time            | timestamp | 8      | -1        | false   | 创建时间     |
| remark                 | varchar   | -1     | 504       | false   | 备注         |





```
select to_date(to_char(dsq.createdtime, 'yyyy-MM-DD'),'yyyy-MM-DD')                        data_time,
       split_part(to_char(dsq.createdtime, 'yyyy-MM-DD'), '-', 1) || '-' ||
       split_part(to_char(dsq.createdtime, 'yyyy-MM-DD'), '-', 2) as year_month,
       sum(1)                                                        focus_group_num,
       sum(dsq.quntglrs)                                          as focus_group_person_num,
       now()                                                         create_time,
       '备注'                                                          remark
from d_ssqbyth_qtsyzjb dsq
group by to_char(dsq.createdtime, 'yyyy-MM-DD');
```







## shiqu_2_focus_person_control



![d974d763887143fc9be1b07ddd912596.jpg](http://localhost/lyt-lytdoc/file/preview/d974d763887143fc9be1b07ddd912596.jpg)



### 源表：

v_qbyth_zdryrltj_qu （爱科一体化）

v_qbyth_zdryrltj_shi（爱科一体化）



| field              | type      | length | lengthvar | notnull | comment |
| ------------------ | --------- | ------ | --------- | ------- | ------- |
| objectid           | bpchar    | -1     | 40        | true    |         |
| parentindex        | int4      | 4      | -1        | false   |         |
| parentobjectid     | varchar   | -1     | 204       | false   |         |
| parentpropertyname | varchar   | -1     | 68        | false   |         |
| 上报总人数         | varchar   | -1     | 204       | false   |         |
| 下发总人数         | varchar   | -1     | 204       | false   |         |
| 不列管人数         | varchar   | -1     | 204       | false   |         |
| 交管               | varchar   | -1     | 204       | false   |         |
| 信访               | varchar   | -1     | 204       | false   |         |
| 内保               | varchar   | -1     | 204       | false   |         |
| 出入境             | varchar   | -1     | 204       | false   |         |
| 刑侦               | varchar   | -1     | 204       | false   |         |
| 列管人数           | varchar   | -1     | 204       | false   |         |
| 区县未认领         | varchar   | -1     | 204       | false   |         |
| 区域               | varchar   | -1     | 204       | false   |         |
| 区域编码           | varchar   | -1     | 204       | false   |         |
| 反恐               | varchar   | -1     | 204       | false   |         |
| 反邪教             | varchar   | -1     | 204       | false   |         |
| 国保               | varchar   | -1     | 204       | false   |         |
| 技侦               | varchar   | -1     | 204       | false   |         |
| 未核实人数         | varchar   | -1     | 204       | false   |         |
| 治安               | varchar   | -1     | 204       | false   |         |
| 法制               | varchar   | -1     | 204       | false   |         |
| 派出所未认领       | varchar   | -1     | 204       | false   |         |
| 特警               | varchar   | -1     | 204       | false   |         |
| 监管               | varchar   | -1     | 204       | false   |         |
| 督查               | varchar   | -1     | 204       | false   |         |
| 禁毒               | varchar   | -1     | 204       | false   |         |
| 科信               | varchar   | -1     | 204       | false   |         |
| 经侦               | varchar   | -1     | 204       | false   |         |
| 网安               | varchar   | -1     | 204       | false   |         |
| 铁路               | varchar   | -1     | 204       | false   |         |
| 高警               | varchar   | -1     | 204       | false   |         |
| 人口               | varchar   | -1     | 204       | false   |         |
| 巡特警             | varchar   | -1     | 204       | false   |         |
| 巡警               | varchar   | -1     | 204       | false   |         |
| 政工               | varchar   | -1     | 204       | false   |         |
| 特勤               | varchar   | -1     | 204       | false   |         |
| 移民               | varchar   | -1     | 204       | false   |         |
| 视侦               | varchar   | -1     | 204       | false   |         |
| 食药环             | varchar   | -1     | 204       | false   |         |
| dqsj               | timestamp | 8      | -1        | false   |         |



### 目标表：

focus_person_control





| field       | type      | length | lengthvar | notnull | comment      |
| ----------- | --------- | ------ | --------- | ------- | ------------ |
| id          | varchar   | -1     | 54        | true    | 主键ID       |
| city_code   | varchar   | -1     | 104       | false   | 城市编码     |
| level       | varchar   | -1     | 34        | false   | 行政区划级别 |
| person_num  | int4      | 4      | -1        | false   | 重点人数     |
| check_num   | int4      | 4      | -1        | false   | 重点人核查数 |
| report_num  | int4      | 4      | -1        | false   | 上报人员总数 |
| create_time | timestamp | 8      | -1        | false   | 创建时间     |
| remark      | varchar   | -1     | 504       | false   | 备注         |
| data_time   | date      | 4      | -1        | false   | 统计时间     |
| year_month  | varchar   | -1     | 104       | false   | 年月         |





```

select
    md5(random()::text || clock_timestamp()::text) id,
    t.city_code city_code,
    t.level,
    sum(t.person_num) person_num,
    sum(t.check_num) check_num,
    sum(t.report_num) report_num,
    now() create_time,
    '备注' remark
from
    (
        select
            md5(random()::text || clock_timestamp()::text) id,
            vqzs.区域编码 city_code,
            'province' as "level",
            cast(vqzs.上报总人数 as integer) + cast(vqzs.下发总人数 as integer) "person_num",
            cast(vqzs.上报总人数 as integer) + cast(vqzs.下发总人数 as integer) - cast(vqzs.未核实人数 as integer) "check_num",
            cast(vqzs.上报总人数 as integer) "report_num",
            '备注' remark
        from v_qbyth_zdryrltj_shi vqzs where vqzs.区域 is not null
        union all
        select
            md5(random()::text || clock_timestamp()::text) id,
            vqzs.区域编码 city_code,
            'city' as "level",
            cast(vqzs.上报总人数 as integer) + cast(vqzs.下发总人数 as integer) "person_num",
            cast(vqzs.上报总人数 as integer) + cast(vqzs.下发总人数 as integer) - cast(vqzs.未核实人数 as integer) "check_num",
            cast(vqzs.上报总人数 as integer) "report_num",
            '备注' remark
        from v_qbyth_zdryrltj_shi vqzs where vqzs.区域 is not null
        union all
        select
            md5(random()::text || clock_timestamp()::text) id,
            vqzq.区域编码 city_code,
            'district' as  "level",
            cast(vqzq.上报总人数 as integer) + cast(vqzq.下发总人数 as integer) "person_num",
            cast(vqzq.上报总人数 as integer) + cast(vqzq.下发总人数 as integer) - cast(vqzq.未核实人数 as integer) "check_num",
            cast(vqzq.上报总人数 as integer) "report_num",
            '备注' remark
        from v_qbyth_zdryrltj_qu vqzq where vqzq.区域 is not null) t group by t.city_code,t.level;

```





## shengshiqu_2_focus_person_information





### 转换图：

![8e422eec9fbc41cf86db2ccb4915f1fe.jpg](http://localhost/lyt-lytdoc/file/preview/8e422eec9fbc41cf86db2ccb4915f1fe.jpg)



### 源表：

v_qbyth_zdryrltj_sheng（爱科一体化）





| field              | type      | length | lengthvar | notnull | comment |
| ------------------ | --------- | ------ | --------- | ------- | ------- |
| objectid           | bpchar    | -1     | 40        | true    |         |
| parentindex        | int4      | 4      | -1        | false   |         |
| parentobjectid     | varchar   | -1     | 204       | false   |         |
| parentpropertyname | varchar   | -1     | 68        | false   |         |
| 区域编码           | varchar   | -1     | 204       | false   |         |
| 区域               | varchar   | -1     | 204       | false   |         |
| 下发总人数         | varchar   | -1     | 204       | false   |         |
| 上报总人数         | varchar   | -1     | 204       | false   |         |
| 省未认领           | varchar   | -1     | 204       | false   |         |
| 地市未认领         | varchar   | -1     | 204       | false   |         |
| 区县未认领         | varchar   | -1     | 204       | false   |         |
| 派出所未认领       | varchar   | -1     | 204       | false   |         |
| 列管人数           | varchar   | -1     | 204       | false   |         |
| 不列管人数         | varchar   | -1     | 204       | false   |         |
| 未核实人数         | varchar   | -1     | 204       | false   |         |
| 国保               | varchar   | -1     | 204       | false   |         |
| 经侦               | varchar   | -1     | 204       | false   |         |
| 治安               | varchar   | -1     | 204       | false   |         |
| 刑侦               | varchar   | -1     | 204       | false   |         |
| 出入境             | varchar   | -1     | 204       | false   |         |
| 网安               | varchar   | -1     | 204       | false   |         |
| 技侦               | varchar   | -1     | 204       | false   |         |
| 监管               | varchar   | -1     | 204       | false   |         |
| 信访               | varchar   | -1     | 204       | false   |         |
| 高警               | varchar   | -1     | 204       | false   |         |
| 交管               | varchar   | -1     | 204       | false   |         |
| 法制               | varchar   | -1     | 204       | false   |         |
| 禁毒               | varchar   | -1     | 204       | false   |         |
| 科信               | varchar   | -1     | 204       | false   |         |
| 特警               | varchar   | -1     | 204       | false   |         |
| 反邪教             | varchar   | -1     | 204       | false   |         |
| 反恐               | varchar   | -1     | 204       | false   |         |
| 督查               | varchar   | -1     | 204       | false   |         |
| 内保               | varchar   | -1     | 204       | false   |         |
| 铁路               | varchar   | -1     | 204       | false   |         |
| 总人数             | varchar   | -1     | 204       | false   |         |
| 人口               | varchar   | -1     | 204       | false   |         |
| 巡特警             | varchar   | -1     | 204       | false   |         |
| 巡警               | varchar   | -1     | 204       | false   |         |
| 政工               | varchar   | -1     | 204       | false   |         |
| 特勤               | varchar   | -1     | 204       | false   |         |
| 移民               | varchar   | -1     | 204       | false   |         |
| 视侦               | varchar   | -1     | 204       | false   |         |
| 食药环             | varchar   | -1     | 204       | false   |         |
| dqsj               | timestamp | 8      | -1        | false   |         |



### 目标表：



focus_person_information(指令中台)



| field               | type      | length | lengthvar | notnull | comment          |
| ------------------- | --------- | ------ | --------- | ------- | ---------------- |
| id                  | varchar   | -1     | 54        | true    | 主键ID           |
| data_time           | date      | 4      | -1        | false   | 统计时间         |
| year_month          | varchar   | -1     | 104       | false   | 年月             |
| focus_person_num    | int4      | 4      | -1        | false   | 重点人总数       |
| city_reported_num   | int4      | 4      | -1        | false   | 地市重点人上报数 |
| troops_issued_num   | int4      | 4      | -1        | false   | 部重点人下发数   |
| province_issued_num | int4      | 4      | -1        | false   | 省重点人下发数   |
| row_tubes_num       | int4      | 4      | -1        | false   | 列管人总数       |
| not_row_tubes_num   | int4      | 4      | -1        | false   | 不列管人总数     |
| create_time         | timestamp | 8      | -1        | false   | 创建时间         |
| remark              | varchar   | -1     | 504       | false   | 备注             |





```
select
    md5(random()::text || clock_timestamp()::text) id,
    to_date(to_char(t.create_time,'yyyy-mm-dd'),'yyyy-mm-dd') data_time,
    sum(t.focus_person_num) focus_person_num,
    sum(t.city_reported_num) city_reported_num,
    sum(t.province_issued_num) province_issued_num,
    sum(t.row_tubes_num) row_tubes_num,
    sum(t.not_row_tubes_num) not_row_tubes_num,
    now() create_time,
    '备注' remark
from (

         select
             md5(random()::text || clock_timestamp()::text) id,
             cast(vqzs.上报总人数 as integer) + cast(vqzs.下发总人数 as integer) "focus_person_num",
             cast(vqzs.上报总人数 as integer) "city_reported_num",
             cast(vqzs.下发总人数 as integer)  "province_issued_num",
             cast(vqzs.列管人数 as integer) "row_tubes_num",
             cast(vqzs.不列管人数 as integer) "not_row_tubes_num",
             now() "create_time",
             '备注' "remark"
         from v_qbyth_zdryrltj_sheng vqzs where vqzs.区域 is not null

       
     ) t group by to_char(t.create_time,'yyyy-mm-dd');
```







## r_middletables_2_vv_command_city_receive_receivenum



![875139bc090a44ca92c1bb68e326331b.jpg](http://localhost/lyt-lytdoc/file/preview/875139bc090a44ca92c1bb68e326331b.jpg)



### 源表：

n_command_sum_receive（领导驾驶舱）



| field              | type      | length | lengthvar | notnull | comment    |
| ------------------ | --------- | ------ | --------- | ------- | ---------- |
| command_sum        | int8      | 8      | -1        | false   | 指令统计   |
| administrator_code | varchar   | -1     | 259       | false   | 行政区划号 |
| administrator_name | varchar   | -1     | 259       | false   | 行政区划名 |
| date_time          | date      | 4      | -1        | false   | 日期       |
| create_time        | timestamp | 8      | -1        | false   | 创建时间   |
| remark             | varchar   | -1     | 259       | false   | 备注       |



### 目标表：

vv_command_city_receive（领导驾驶舱）

| field                | type      | length | lengthvar | notnull | comment                                |
| -------------------- | --------- | ------ | --------- | ------- | -------------------------------------- |
| command_receive_sum  | int8      | 8      | -1        | false   | 指令接受数                             |
| command_feedback_num | int8      | 8      | -1        | false   | 指令反馈数                             |
| administration_type  | varchar   | -1     | 34        | false   | 行政区划类型（1.省，2.市，3.区，4.县） |
| administration_code  | varchar   | -1     | 34        | false   | 行政区划码                             |
| administration_name  | varchar   | -1     | 34        | false   | 行政区划名                             |
| biz_original_time    | timestamp | 8      | -1        | false   | 业务原始时间                           |
| create_time          | timestamp | 8      | -1        | false   | 创建时间                               |



```
select
    ( select level from t_administration where adcode = ncsr.administrator_code limit 1 ) administration_type,
    ncsr.administrator_code administration_code,
    ncsr.administrator_name administration_name,
    sum(ncsr.command_sum)        command_receive_sum,
    to_date(to_char(ncsr.date_time, 'yyyy-mm-dd'),'yyyy-mm-dd')         biz_original_time,
    now() create_time
from n_command_sum_receive ncsr
where administrator_code is not null
group by ncsr.administrator_code,ncsr.administrator_name,to_char(ncsr.date_time, 'yyyy-mm-dd');
```





## r_middletables_2_vv_command_city_receive_feedbacknum



### 转换图：

![1753cdc35c89470d8f0cfe7badb49a47.jpg](http://localhost/lyt-lytdoc/file/preview/1753cdc35c89470d8f0cfe7badb49a47.jpg)



### 源表：

n_command_status_receive（领导驾驶舱）



| field              | type      | length | lengthvar | notnull | comment          |
| ------------------ | --------- | ------ | --------- | ------- | ---------------- |
| cmd_status         | varchar   | -1     | 259       | false   | 指令流转状态     |
| cmd_status_sum     | int8      | 8      | -1        | false   | 指令流转状态统计 |
| administrator_code | varchar   | -1     | 259       | false   | 行政区划号       |
| administrator_name | varchar   | -1     | 259       | false   | 行政区划名       |
| date_time          | date      | 4      | -1        | false   | 日期             |
| create_time        | timestamp | 8      | -1        | false   | 创建时间         |
| remark             | varchar   | -1     | 259       | false   | 备注             |



### 目标表：

vv_command_city_receive（领导驾驶舱）

| field                | type      | length | lengthvar | notnull | comment                                |
| -------------------- | --------- | ------ | --------- | ------- | -------------------------------------- |
| command_receive_sum  | int8      | 8      | -1        | false   | 指令接受数                             |
| command_feedback_num | int8      | 8      | -1        | false   | 指令反馈数                             |
| administration_type  | varchar   | -1     | 34        | false   | 行政区划类型（1.省，2.市，3.区，4.县） |
| administration_code  | varchar   | -1     | 34        | false   | 行政区划码                             |
| administration_name  | varchar   | -1     | 34        | false   | 行政区划名                             |
| biz_original_time    | timestamp | 8      | -1        | false   | 业务原始时间                           |
| create_time          | timestamp | 8      | -1        | false   | 创建时间                               |







```
select
    ( select level from t_administration where adcode = ncsr.administrator_code limit 1 ) administration_type,
    ncsr.administrator_code administration_code,
    ncsr.administrator_name administration_name,
    sum(ncsr.cmd_status_sum)        command_feedback_num,
    to_date(to_char(ncsr.date_time, 'yyyy-mm-dd'),'yyyy-mm-dd')         biz_original_time,
    now() create_time
from n_command_status_receive ncsr
where administrator_code is not null   and cmd_status = '2'
group by ncsr.administrator_code,ncsr.administrator_name,to_char(ncsr.date_time, 'yyyy-mm-dd');
```







## middletables_2_t_command_survey



### 转换图：

![b62a8f211ccd4cbe8e007118eb7d2a25.jpg](http://localhost/lyt-lytdoc/file/preview/b62a8f211ccd4cbe8e007118eb7d2a25.jpg)



### 源表：

n_command_status_send（领导驾驶舱）



| field              | type      | length | lengthvar | notnull | comment          |
| ------------------ | --------- | ------ | --------- | ------- | ---------------- |
| cmd_status         | varchar   | -1     | 259       | false   | 指令流转状态     |
| cmd_status_sum     | int8      | 8      | -1        | false   | 指令流转状态统计 |
| administrator_code | varchar   | -1     | 259       | false   | 行政区划号       |
| administrator_name | varchar   | -1     | 259       | false   | 行政区划名       |
| date_time          | date      | 4      | -1        | false   | 日期             |
| create_time        | timestamp | 8      | -1        | false   | 创建时间         |
| remark             | varchar   | -1     | 259       | false   | 备注             |



n_command_sum_send（领导驾驶舱）



| field              | type      | length | lengthvar | notnull | comment    |
| ------------------ | --------- | ------ | --------- | ------- | ---------- |
| command_sum        | int8      | 8      | -1        | false   | 指令统计   |
| administrator_code | varchar   | -1     | 259       | false   | 行政区划号 |
| administrator_name | varchar   | -1     | 259       | false   | 行政区划名 |
| date_time          | date      | 4      | -1        | false   | 日期       |
| create_time        | timestamp | 8      | -1        | false   | 创建时间   |
| remark             | varchar   | -1     | 259       | false   | 备注       |



n_command_level_send（领导驾驶舱）

| field              | type      | length | lengthvar | notnull | comment    |
| ------------------ | --------- | ------ | --------- | ------- | ---------- |
| level_id           | varchar   | -1     | 259       | false   | 等级ID     |
| level_sum          | int8      | 8      | -1        | false   | 等级统计   |
| administrator_code | varchar   | -1     | 259       | false   | 行政区划号 |
| administrator_name | varchar   | -1     | 259       | false   | 行政区划名 |
| date_time          | date      | 4      | -1        | false   | 日期       |
| create_time        | timestamp | 8      | -1        | false   | 创建时间   |
| remark             | varchar   | -1     | 259       | false   | 备注       |

n_command_finished_send（领导驾驶舱）



| field              | type      | length | lengthvar | notnull | comment          |
| ------------------ | --------- | ------ | --------- | ------- | ---------------- |
| cmd_finished       | varchar   | -1     | 259       | false   | 指令归档状态     |
| cmd_finished_sum   | int8      | 8      | -1        | false   | 指令归档状态统计 |
| administrator_code | varchar   | -1     | 259       | false   | 行政区划号       |
| administrator_name | varchar   | -1     | 259       | false   | 行政区划名       |
| date_time          | date      | 4      | -1        | false   | 日期             |
| create_time        | timestamp | 8      | -1        | false   | 创建时间         |
| remark             | varchar   | -1     | 259       | false   | 备注             |



### 目标表：

t_command_survey（领导驾驶舱）

| field                | type      | length | lengthvar | notnull | comment                                |
| -------------------- | --------- | ------ | --------- | ------- | -------------------------------------- |
| command_num          | int4      | 4      | -1        | false   | 指令总数                               |
| red_command_num      | int4      | 4      | -1        | false   | 红色指令                               |
| orange_command_num   | int4      | 4      | -1        | false   | 橙色指令                               |
| yellow_command_num   | int4      | 4      | -1        | false   | 黄色指令                               |
| blue_command_num     | int4      | 4      | -1        | false   | 蓝色指令                               |
| command_signed_num   | int4      | 4      | -1        | false   | 指令签收                               |
| command_feedback_num | int4      | 4      | -1        | false   | 指令反馈                               |
| command_notfiled_num | int4      | 4      | -1        | false   | 指令未归档                             |
| administration_type  | varchar   | -1     | 34        | false   | 行政区划类型（1.省，2.市，3.区，4.县） |
| administration_code  | varchar   | -1     | 34        | false   | 行政区划码                             |
| administration_name  | varchar   | -1     | 34        | false   | 行政区划名                             |
| biz_original_time    | timestamp | 8      | -1        | false   | 业务原始时间                           |
| create_time          | timestamp | 8      | -1        | false   | 创建时间                               |





```
         select
             ( select level from t_administration where adcode = ncss.administrator_code limit 1 ) administration_type,
             ncss.administrator_code administration_code,
             ncss.administrator_name administration_name,
             (select coalesce(sum(command_sum),0)  from n_command_sum_send t          where ncss.administrator_code = t.administrator_code   and t.date_time = ncss.date_time and t.administrator_code is not null) as command_num,
             (select coalesce(sum(level_sum),0) from n_command_level_send ncls where ncls.administrator_code = ncss.administrator_code and ncls.level_id = 'ZLDJ-001' and ncls.date_time = ncss.date_time and ncls.administrator_code is not null) as red_command_num,
             (select coalesce(sum(level_sum),0) from n_command_level_send ncls where ncls.administrator_code = ncss.administrator_code and ncls.level_id = 'ZLDJ-002' and ncls.date_time = ncss.date_time and ncls.administrator_code is not null) as orange_command_num,
             (select coalesce(sum(level_sum),0) from n_command_level_send ncls where ncls.administrator_code = ncss.administrator_code and ncls.level_id = 'ZLDJ-003' and ncls.date_time = ncss.date_time and ncls.administrator_code is not null) as yellow_command_num,
             (select coalesce(sum(level_sum),0) from n_command_level_send ncls where ncls.administrator_code = ncss.administrator_code and ncls.level_id = 'ZLDJ-004' and ncls.date_time = ncss.date_time and ncls.administrator_code is not null) as blue_command_num,
             (select coalesce(sum(t.cmd_status_sum),0)  from n_command_status_send t           where ncss.administrator_code = t.administrator_code  and t.cmd_status = '0' and t.date_time = ncss.date_time and t.administrator_code is not null) as command_wqs_num,
             (select coalesce(sum(t.cmd_status_sum),0)  from n_command_status_send t           where ncss.administrator_code = t.administrator_code  and t.cmd_status = '1' and t.date_time = ncss.date_time and t.administrator_code is not null) as command_signed_num,
             (select coalesce(sum(t.cmd_status_sum),0)  from n_command_status_send t          where ncss.administrator_code = t.administrator_code   and t.cmd_status = '2' and t.date_time = ncss.date_time and t.administrator_code is not null) as command_feedback_num,
             ( select sum(cmd_finished_sum) from n_command_finished_send ncfs where ncfs.administrator_code = ncss.administrator_code and ncfs.cmd_finished = '0' and ncfs.date_time = ncss.date_time and ncfs.administrator_code is not null) command_notfiled_num,
             ncss.date_time          biz_original_time,
             now() create_time
         from n_command_status_send ncss
         where administrator_code is not null
         group by ncss.administrator_code,ncss.administrator_name,ncss.date_time
```



## middletables_2_t_command_screenning





![28e4b24555434b50bcb64cf1ff08eab5.jpg](http://localhost/lyt-lytdoc/file/preview/28e4b24555434b50bcb64cf1ff08eab5.jpg)





### 源表：

n_command_sum_send（领导驾驶舱）

| field              | type      | length | lengthvar | notnull | comment    |
| ------------------ | --------- | ------ | --------- | ------- | ---------- |
| command_sum        | int8      | 8      | -1        | false   | 指令统计   |
| administrator_code | varchar   | -1     | 259       | false   | 行政区划号 |
| administrator_name | varchar   | -1     | 259       | false   | 行政区划名 |
| date_time          | date      | 4      | -1        | false   | 日期       |
| create_time        | timestamp | 8      | -1        | false   | 创建时间   |
| remark             | varchar   | -1     | 259       | false   | 备注       |

### 目标表：

t_command_screenning（领导驾驶舱）

| field                 | type      | length | lengthvar | notnull | comment                                |
| --------------------- | --------- | ------ | --------- | ------- | -------------------------------------- |
| administration_type   | varchar   | -1     | 34        | false   | 行政区划类型（1.省，2.市，3.区，4.县） |
| administration_code   | varchar   | -1     | 34        | false   | 行政区划码                             |
| administration_name   | varchar   | -1     | 34        | false   | 行政区划名                             |
| command_num           | int4      | 4      | -1        | false   | 指令总数                               |
| command_done_num      | int4      | 4      | -1        | false   | 已办指令数                             |
| command_undone_num    | int4      | 4      | -1        | false   | 代办指令数                             |
| command_supervise_num | int4      | 4      | -1        | false   | 督办指令数                             |
| command_timeout_num   | int4      | 4      | -1        | false   | 指令超时预警数                         |
| on_duty_num           | int4      | 4      | -1        | false   | 执勤人员总数                           |
| alert_num             | int4      | 4      | -1        | false   | 警情总数                               |
| biz_original_time     | timestamp | 8      | -1        | false   | 业务原始时间                           |
| create_time           | timestamp | 8      | -1        | false   | 创建时间                               |

```
select
    ( select level from t_administration where adcode = ncss.administrator_code limit 1 ) administration_type,
    ncss.administrator_code administration_code,
    ncss.administrator_name administration_name,
    sum(ncss.command_sum)        command_num,
    ( select coalesce(sum(cmd_finished_sum),0) from n_command_finished_send ncfs where ncfs.administrator_code = ncss.administrator_code and ncfs.cmd_finished = '1' and ncfs.administrator_code is not null and ncfs.date_time=ncss.date_time) command_done_num,
    ( select coalesce(sum(cmd_finished_sum) ,0 ) from n_command_finished_send ncfs where ncfs.administrator_code = ncss.administrator_code and ncfs.cmd_finished = '0' and ncfs.administrator_code is not null and ncfs.date_time=ncss.date_time) command_undone_num,
    ncss.date_time          biz_original_time,
    now() create_time
from n_command_sum_send ncss
where administrator_code is not null
group by ncss.administrator_code,ncss.administrator_name,ncss.date_time;
```







## 14_tb_uc_duty_cmd_record_2_t_overall_command_send



### 转换图：

![ed25325927ad4acb802a492c75e5302d.jpg](http://localhost/lyt-lytdoc/file/preview/ed25325927ad4acb802a492c75e5302d.jpg)



### 源表：

tb_uc_duty_cmd_record（指令中台）

| field                 | type      | length | lengthvar | notnull | comment                                                  |
| --------------------- | --------- | ------ | --------- | ------- | -------------------------------------------------------- |
| id                    | varchar   | -1     | 259       | true    | 主键                                                     |
| cmd_type              | varchar   | -1     | 259       | false   | 指令类型                                                 |
| cmd_from_user_name    | varchar   | -1     | 259       | false   | 指令发送者，创建人                                       |
| cmd_to_user_name      | varchar   | -1     | 259       | false   | 指令接收者                                               |
| cmd_from_user_id      | varchar   | -1     | 259       | false   | 指令发送用户ID                                           |
| cmd_to_user_id        | varchar   | -1     | 259       | false   | 指令接受用户ID                                           |
| launch_type           | varchar   | -1     | 20        | false   | 发起源类型(0:无;1:线索;2:警情)                           |
| launch_id             | varchar   | -1     | 259       | false   | 发起源ID                                                 |
| from_company          | varchar   | -1     | 259       | false   | 发起单位，创建单位                                       |
| from_company_id       | varchar   | -1     | 259       | false   | 创建单位id                                               |
| to_company            | varchar   | -1     | 259       | false   | 接收单位                                                 |
| to_company_id         | varchar   | -1     | 259       | false   | 接收单位id                                               |
| from_police_type      | varchar   | -1     | 259       | false   | 发起警种                                                 |
| to_police_type        | varchar   | -1     | 259       | false   | 接收警种                                                 |
| administrative_area   | varchar   | -1     | 259       | false   | 行政区划                                                 |
| police_area           | varchar   | -1     | 259       | false   | 警务区划                                                 |
| cmd_batch             | varchar   | -1     | 259       | false   | 指令批次号                                               |
| cmd_param             | text      | -1     | -1        | false   | 指令参数                                                 |
| cmd_title             | varchar   | -1     | 259       | false   | 指令标题                                                 |
| cmd_content           | text      | -1     | -1        | false   | 指令内容                                                 |
| cmd_level_id          | varchar   | -1     | 259       | false   | 指令等级ID                                               |
| sign                  | bool      | 1      | -1        | false   | 是否需要签收                                             |
| sign_timeout          | timestamp | 8      | 6         | false   | 签收超时时间                                             |
| feedback              | bool      | 1      | -1        | false   | 是否需要反馈                                             |
| feedback_timeout      | timestamp | 8      | 6         | false   | 反馈超时时间                                             |
| supervise             | bool      | 1      | -1        | false   | 是否需要督办                                             |
| cmd_status            | varchar   | -1     | 20        | false   | 指令状态(0:待处理;1:已签收;2:已反馈;                     |
| finished              | varchar   | -1     | 20        | false   | 是否完成(0:未完成;1:已完成)（归档状态）                  |
| copy_item             | varchar   | -1     | 20        | false   | 副本类型(1:抄送;2:协作;)                                 |
| create_time           | timestamp | 8      | 6         | false   | 创建时间                                                 |
| source_sys            | varchar   | -1     | 36        | false   | （指令来源）来源系统(1:警辅通;2:警综;3:情报二期;99:其他) |
| remark                | varchar   | -1     | 259       | false   | 备注                                                     |
| file                  | text      | -1     | -1        | false   | 文件                                                     |
| status                | varchar   | -1     | 20        | false   | 0草稿，1正常，2已删除                                    |
| cmd_operate_last_time | timestamp | 8      | 6         | false   |                                                          |
| cmd_operate_last_type | timestamp | 8      | 6         | false   |                                                          |
| cmd_operate_last_id   | timestamp | 8      | 6         | false   |                                                          |
| xzxqbm                | varchar   | -1     | 259       | false   | 行政辖区编码                                             |
| sjxzxqbm              | varchar   | -1     | 259       | false   | 上级行政辖区编码                                         |
| jwxqbm                | varchar   | -1     | 259       | false   | 警务辖区编码                                             |
| sjjwxqbm              | varchar   | -1     | 259       | false   | 上级警务辖区编码                                         |
| r1                    | varchar   | -1     | 259       | false   |                                                          |
| r2                    | varchar   | -1     | 259       | false   |                                                          |
| r3                    | varchar   | -1     | 259       | false   |                                                          |
| r4                    | varchar   | -1     | 259       | false   |                                                          |
| r5                    | numeric   | -1     | -1        | false   |                                                          |
| r6                    | numeric   | -1     | -1        | false   |                                                          |
| r7                    | int4      | 4      | -1        | false   |                                                          |
| r8                    | int4      | 4      | -1        | false   |                                                          |
| r9                    | timestamp | 8      | 6         | false   |                                                          |
| r10                   | timestamp | 8      | 6         | false   |                                                          |
| huifshix              | varchar   | -1     | 259       | false   | 回复时限                                                 |
| zhiljiezhisj          | timestamp | 8      | 6         | false   | 指令截至时间                                             |
| xianslaiy             | varchar   | -1     | 259       | false   | 线索来源                                                 |
| yueduzt               | varchar   | -1     | 259       | false   | 阅读状态，0未阅读，1已阅读                               |
| to_roles              | varchar   | -1     | 259       | false   | 接收角色id                                               |
| chaos_roles           | varchar   | -1     | 259       | false   | 抄送角色id                                               |
| requires              | varchar   | -1     | 259       | false   | 指令要求                                                 |
| lianx_fangs           | varchar   | -1     | 259       | false   | 联系方式                                                 |
| link_person_count     | varchar   | -1     | 259       | false   | 关联人员数量                                             |
| link_person_id        | varchar   | -1     | 259       | false   | 关联人员id                                               |
| link_person           | varchar   | -1     | 259       | false   | 关联人员                                                 |
| cmd_sn                | varchar   | -1     | 259       | false   | 指令编码                                                 |
| to_user_id            | varchar   | -1     | -1        | false   | 接收人id                                                 |
| create_user_id        | varchar   | -1     | -1        | false   | 创建人id                                                 |
| to_user_name          | varchar   | -1     | 259       | false   | 接收人姓名                                               |
| create_user_name      | varchar   | -1     | 259       | false   | 创建人姓名                                               |
| qianszhuangt          | varchar   | -1     | 259       | false   | 签收状态，父节点根据子节点状态汇聚，初始0/n,n是接收人    |
| fankzhuangt           | varchar   | -1     | 259       | false   | 反馈状态，父节点根据子节点状态汇聚，初始0/n              |
| guangkzhuangt         | varchar   | -1     | 259       | false   | 管控状态                                                 |
| zhilleibie            | varchar   | -1     | 259       | false   | 指令类别，核查、核处等                                   |
| color                 | varchar   | -1     | 259       | false   | 指令颜色（字典，唯一）                                   |
| clue_batch            | varchar   | -1     | 259       | false   | 线索批次号                                               |
| cmd_parent_batch      | varchar   | -1     | 259       | false   | 指令父批次号，空则指根指令                               |
| cmd_id                | varchar   | -1     | 259       | false   | 指令id                                                   |
| pid                   | varchar   | -1     | 259       | false   | 父指令id                                                 |
| rid                   | varchar   | -1     | 259       | false   | 根指令id                                                 |
| create_role_id        | varchar   | -1     | 259       | false   | 发起指令班组、角色id                                     |
| to_role_id            | varchar   | -1     | 259       | false   | 接收指令人所属班组、角色id                               |
| create_role_name      | varchar   | -1     | 259       | false   | 发起人所属班组                                           |
| to_role_name          | varchar   | -1     | 259       | false   | 接收人所属班组                                           |
| operate_role_name     | varchar   | -1     | 259       | false   | 操作人角色名称                                           |
| operate_name          | varchar   | -1     | 259       | false   | 操作人名称                                               |
| is_auto_feedback      | varchar   | -1     | 259       | false   | 是否自动反馈，0否，1是，对应对接字段isAutoFeedback       |

### 目标表：

t_overall_command_send（领导驾驶舱）

| field                   | type      | length | lengthvar | notnull | comment          |
| ----------------------- | --------- | ------ | --------- | ------- | ---------------- |
| sender_area_name        | varchar   | -1     | 34        | false   | 指令发送地区名称 |
| sender_area_code        | varchar   | -1     | 34        | false   | 指令发送地区编码 |
| sender_area_longitude   | varchar   | -1     | 34        | false   | 指令发送地区经度 |
| sender_area_latitude    | varchar   | -1     | 34        | false   | 指令发送地区纬度 |
| receiver_area_name      | varchar   | -1     | 36        | false   | 指令接收地区名称 |
| receiver_area_code      | varchar   | -1     | 34        | false   | 指令接收地区编码 |
| receiver_area_longitude | varchar   | -1     | 34        | false   | 指令接收地区经度 |
| receiver_area_latitude  | varchar   | -1     | 34        | false   | 指令接收地区纬度 |
| command_send_num        | int4      | 4      | -1        | false   | 下发指令数       |
| biz_original_time       | timestamp | 8      | -1        | false   | 业务原始时间     |
| create_time             | timestamp | 8      | -1        | false   | 创建时间         |
| clue_handle_num         | int4      | 4      | -1        | false   | 线索处理数       |



```

select
    t1.sender_area_code sender_area_code,
    (
        select t_administration.name
        from t_administration
        where t_administration.adcode = t1.sender_area_code
    )                                     sender_area_name,
    (
        select t_administration.center_longitude
        from t_administration
        where t_administration.adcode = t1.sender_area_code
    )                                     sender_area_longitude,
    (
        select t_administration.center_latitude
        from t_administration
        where t_administration.adcode = t1.sender_area_code
    )                                     sender_area_latitude,
    t1.receiver_area_code receiver_area_code,
    (
        select t_administration.name
        from t_administration
        where t_administration.adcode = t1.receiver_area_code
    )                                     receiver_area_name,
    (
        select t_administration.center_longitude
        from t_administration
        where t_administration.adcode = t1.receiver_area_code
    )                                     receiver_area_longitude,
    (
        select t_administration.center_latitude
        from t_administration
        where t_administration.adcode = t1.receiver_area_code
    )                                     receiver_area_latitude,
    count(1)                              command_send_num,
    to_date(to_char(t1.create_time, 'yyyy-mm-dd'),'yyyy-mm-dd') biz_original_time,
    now() create_time
from (
         select
             tudcr.*,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tudcr.create_role_id limit 1) sender_area_code,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tudcr.to_role_id limit 1) receiver_area_code
         from tb_uc_duty_cmd_record tudcr where tudcr.to_role_id is not null and tudcr.create_role_id is not null and tudcr.status = 'CSZT1-001'
     ) t1 group by t1.sender_area_code,t1.receiver_area_code,to_char(t1.create_time, 'yyyy-mm-dd');
```







## n_clue_class_send_2_workflow_report_clue





### 转换图：

![30b6cbf549624a6dbfc82a26a6bb0be6.jpg](http://localhost/lyt-lytdoc/file/preview/30b6cbf549624a6dbfc82a26a6bb0be6.jpg)



### 源表：

n_clue_class_send（领导驾驶舱）

| field              | type      | length | lengthvar | notnull | comment      |
| ------------------ | --------- | ------ | --------- | ------- | ------------ |
| clue_class         | varchar   | -1     | 259       | false   | 线索类型     |
| clue_class_sum     | int8      | 8      | -1        | false   | 线索类型统计 |
| administrator_code | varchar   | -1     | 259       | false   | 行政区划号   |
| administrator_name | varchar   | -1     | 259       | false   | 行政区划名   |
| date_time          | date      | 4      | -1        | false   | 日期         |
| create_time        | timestamp | 8      | -1        | false   | 创建时间     |
| remark             | varchar   | -1     | 259       | false   | 备注         |

### 目标表：

workflow_report_clue（领导驾驶舱）

| field               | type      | length | lengthvar | notnull | comment                                      |
| ------------------- | --------- | ------ | --------- | ------- | -------------------------------------------- |
| id                  | varchar   | -1     | 54        | true    | 主键ID                                       |
| data_time           | date      | 4      | -1        | true    | 统计时间                                     |
| year_month          | varchar   | -1     | 104       | true    | 年月                                         |
| source              | int2      | 2      | -1        | false   | 归属来源（1.部级，2.省级，3.地市，4.AI模型） |
| type_code           | varchar   | -1     | 104       | true    | 涉事类别编码                                 |
| type_desc           | varchar   | -1     | 104       | false   | 涉事类别释义                                 |
| create_time         | timestamp | 8      | -1        | false   | 创建时间                                     |
| remark              | varchar   | -1     | 504       | false   | 备注                                         |
| num                 | int4      | 4      | -1        | false   | 总数                                         |
| instruct_num        | int4      | 4      | -1        | false   | 转成指令数                                   |
| instruct_finish_num | int4      | 4      | -1        | false   | 转成指令归档数                               |
| administrator_code  | varchar   | -1     | 259       | true    | 行政区划号                                   |
| administrator_name  | varchar   | -1     | 259       | false   | 行政区划名                                   |







```

select
    md5(random()::text || clock_timestamp()::text) id,
    nccs.date_time data_time,
    to_char(nccs.date_time,'yyyy-MM') year_month,
    case nccs.administrator_code
           when '420000' then 2
           else 3
    end source,
    clue_class    type_code,
    now()          create_time,
    '备注' remark,
    count(1) num,
    nccs.administrator_code administrator_code,
    nccs.administrator_name administrator_name
from n_clue_class_send nccs
group by nccs.administrator_code, nccs.administrator_name,nccs.date_time,nccs.clue_class;
```







## n_clue_class_receive_2_t_zonglfx_qingbsjts



### 转换图：



![39c5dfbc9b5c4c6b89828c2164c91e59.jpg](http://localhost/lyt-lytdoc/file/preview/39c5dfbc9b5c4c6b89828c2164c91e59.jpg)





### 源表：

n_clue_class_send（领导驾驶舱）



| field              | type      | length | lengthvar | notnull | comment      |
| ------------------ | --------- | ------ | --------- | ------- | ------------ |
| clue_class         | varchar   | -1     | 259       | false   | 线索类型     |
| clue_class_sum     | int8      | 8      | -1        | false   | 线索类型统计 |
| administrator_code | varchar   | -1     | 259       | false   | 行政区划号   |
| administrator_name | varchar   | -1     | 259       | false   | 行政区划名   |
| date_time          | date      | 4      | -1        | false   | 日期         |
| create_time        | timestamp | 8      | -1        | false   | 创建时间     |
| remark             | varchar   | -1     | 259       | false   | 备注         |





### 目标表：

t_zonglfx_qingbsjts（领导驾驶舱）



| field       | type      | length | lengthvar | notnull | comment  |
| ----------- | --------- | ------ | --------- | ------- | -------- |
| 主键        | varchar   | -1     | 259       | false   | 主键     |
| shengsbm    | varchar   | -1     | 54        | false   | 城市编码 |
| displayname | varchar   | -1     | 34        | false   | 城市名称 |
| province    | varchar   | -1     | 34        | false   | 省份     |
| qingbzb     | varchar   | -1     | 54        | false   | 情报指标 |
| qingbs      | int4      | 4      | -1        | false   | 情报数量 |
| date_time   | date      | 4      | -1        | false   | 日期     |
| create_time | timestamp | 8      | 0         | false   | 创建时间 |



```
select
    md5(random()::text || clock_timestamp()::text) "主键",
    nccs.administrator_code as shengsbm,
    nccs.administrator_name as displayname,
    (select ta.province_name from t_administration ta where ta.adcode = nccs.administrator_code limit 1) as province,
    sum(nccs.clue_class_sum) as qingbs,
    nccs.date_time as date_time,
    now() as create_time
from n_clue_class_send nccs
group by nccs.administrator_code,nccs.administrator_name,nccs.date_time;

```





## 13_tb_uc_duty_cmd_record_2_n_command_yueduzt_send



### 转换图：

![32c24fbda70e4f24902c65427ac2b326.jpg](http://localhost/lyt-lytdoc/file/preview/32c24fbda70e4f24902c65427ac2b326.jpg)



### 源表：

tb_uc_duty_cmd_record（领导驾驶舱）

表结构参考上述tb_uc_duty_cmd_record说明

### 目标表：

n_command_yueduzt_send（领导驾驶舱）



| field              | type      | length | lengthvar | notnull | comment          |
| ------------------ | --------- | ------ | --------- | ------- | ---------------- |
| cmd_yueduzt        | varchar   | -1     | 259       | false   | 指令阅读状态     |
| cmd_yueduzt_sum    | int8      | 8      | -1        | false   | 指令阅读状态统计 |
| administrator_code | varchar   | -1     | 259       | false   | 行政区划号       |
| administrator_name | varchar   | -1     | 259       | false   | 行政区划名       |
| date_time          | date      | 4      | -1        | false   | 日期             |
| create_time        | timestamp | 8      | -1        | false   | 创建时间         |
| remark             | varchar   | -1     | 259       | false   | 备注             |



```
select t1.yueduzt                                                  cmd_yueduzt,
       count(distinct t1.rid)                                                    cmd_yueduzt_sum,
       t1.sender_area_code                                                 administrator_code,
       (
           select t_administration.name
           from t_administration
           where t_administration.adcode = t1.sender_area_code
       )                                                            administrator_name,
       to_date(to_char(t1.create_time, 'yyyy-mm-dd'), 'yyyy-mm-dd') date_time,
       now()                                                        create_time,
       '备注'                                                         remark
from
     (
         select
             tudcr.*,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tudcr.create_role_id limit 1) sender_area_code,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tudcr.to_role_id limit 1) receiver_area_code
         from tb_uc_duty_cmd_record tudcr
     )   t1
where t1.sender_area_code is not null and t1.create_role_id is not null and t1.to_role_id is not null and t1.status = 'CSZT1-001'
group by t1.sender_area_code, to_char(t1.create_time, 'yyyy-mm-dd'), t1.yueduzt;
```





## middle_tables_t_zonglfx_gedszlclqk

### 转换图：



![2aaf992ad0964a54aa1244c0bc6d555a.jpg](http://localhost/lyt-lytdoc/file/preview/2aaf992ad0964a54aa1244c0bc6d555a.jpg)



### 源表：

n_clue_state_send（领导驾驶舱）

| field              | type      | length | lengthvar | notnull | comment      |
| ------------------ | --------- | ------ | --------- | ------- | ------------ |
| clue_state         | varchar   | -1     | 259       | false   | 线索状态     |
| clue_state_sum     | int8      | 8      | -1        | false   | 线索状态统计 |
| administrator_code | varchar   | -1     | 259       | false   | 行政区划号   |
| administrator_name | varchar   | -1     | 259       | false   | 行政区划名   |
| date_time          | date      | 4      | -1        | false   | 日期         |
| create_time        | timestamp | 8      | -1        | false   | 创建时间     |
| remark             | varchar   | -1     | 259       | false   | 备注         |

### 目标表：

t_zonglfx_gedszlclqk（领导驾驶舱）

| field               | type      | length | lengthvar | notnull | comment                                |
| ------------------- | --------- | ------ | --------- | ------- | -------------------------------------- |
| 主键                | varchar   | -1     | 259       | true    | 主键                                   |
| shengsbm            | varchar   | -1     | 54        | false   | 城市编码                               |
| displayname         | varchar   | -1     | 34        | false   | 城市名称                               |
| xianscnl            | float8    | 8      | -1        | true    | 线索采纳率                             |
| jisqsl              | float8    | 8      | -1        | true    | 签收率                                 |
| jisfkl              | float8    | 8      | -1        | true    | 反馈率                                 |
| kaohdf              | float4    | 4      | -1        | false   | 考核得分                               |
| yuehb               | float4    | 4      | -1        | false   | 月环比                                 |
| create_time         | timestamp | 8      | 0         | false   | 创建时间                               |
| date_time           | date      | 4      | -1        | false   | 日期                                   |
| clue_sum            | int8      | 8      | -1        | true    | 线索数                                 |
| clue_accept         | int8      | 8      | -1        | true    | 线索采纳数                             |
| cmd_sum             | int8      | 8      | -1        | true    | 指令数                                 |
| cmd_sign_sum        | int8      | 8      | -1        | true    | 指令签收数                             |
| cmd_feedback_sum    | int8      | 8      | -1        | true    | 指令反馈数                             |
| administration_type | varchar   | -1     | 34        | false   | 行政区划类型（1.省，2.市，3.区，4.县） |



```
select t2.id,
       t2.shengsbm,
       t2.administration_type,
       t2.displayname,
       t2.create_time,
       t2.date_time,
       coalesce(t2.clue_sum,0) clue_sum,
       coalesce(t2.clue_accept,0) clue_accept,
       coalesce(t2.cmd_sum,0) cmd_sum,
       coalesce(t2.cmd_sign_sum,0) cmd_sign_sum,
       coalesce(t2.cmd_feedback_sum,0) cmd_feedback_sum,
       case when coalesce(t2.clue_sum,0) = 0 then 0
            else cast((coalesce(t2.clue_accept,0) / coalesce(t2.clue_sum,0)) *100 as decimal(18,2))
           end as xianscnl,
       case when coalesce(t2.cmd_sum,0) = 0 then 0
            else cast((coalesce(t2.cmd_sign_sum,0) / coalesce(t2.cmd_sum,0)) *100 as decimal(18,2))
           end as jisqsl,
       case when coalesce(t2.cmd_sum,0) = 0 then 0
            else cast((coalesce(t2.cmd_feedback_sum,0) / coalesce(t2.cmd_sum,0)) *100 as decimal(18,2))
           end as jisfkl
from (
         select
             md5(random()::text || clock_timestamp()::text) as id,
             t1.administrator_code shengsbm,
             (select t_administration.level from t_administration where t_administration.adcode=t1.administrator_code limit 1) as administration_type,
             (select t_administration.name from t_administration where t_administration.adcode=t1.administrator_code limit 1) as displayname,
             now()                                                                            create_time,
             to_date(date_part('year', now()) || '-' || lpad(date_part('month', now())::text, 2, '0'),'yyyy-MM')  date_time,
             (

                 select sum(n_clue_state_send.clue_state_sum)
                 from n_clue_state_send where n_clue_state_send.administrator_code= t1.administrator_code and
                         (date_part('year', now()) || '-' || lpad(date_part('month', now())::text, 2, '0')) = (date_part('year', n_clue_state_send.date_time) || '-' || lpad(date_part('month', n_clue_state_send.date_time)::text, 2, '0'))

             ) as clue_sum,
             (

                 select sum(n_clue_state_send.clue_state_sum)
                 from n_clue_state_send where n_clue_state_send.administrator_code=t1.administrator_code and
                         n_clue_state_send.clue_state='2'
                                             and
                         (date_part('year', now()) || '-' || lpad(date_part('month', now())::text, 2, '0')) = (date_part('year', n_clue_state_send.date_time) || '-' || lpad(date_part('month', n_clue_state_send.date_time)::text, 2, '0'))

             ) as clue_accept,

             (

                 select sum(n_command_sum_send.command_sum)
                 from n_command_sum_send where n_command_sum_send.administrator_code=t1.administrator_code and
                         (date_part('year', now()) || '-' || lpad(date_part('month', now())::text, 2, '0')) = (date_part('year', n_command_sum_send.date_time) || '-' || lpad(date_part('month', n_command_sum_send.date_time)::text, 2, '0'))

             ) as cmd_sum,

             (

                 select sum(n_command_status_send.cmd_status_sum)
                 from n_command_status_send where n_command_status_send.administrator_code=t1.administrator_code and
                         n_command_status_send.cmd_status='1'
                                                 and
                         (date_part('year', now()) || '-' || lpad(date_part('month', now())::text, 2, '0')) = (date_part('year', n_command_status_send.date_time) || '-' || lpad(date_part('month', n_command_status_send.date_time)::text, 2, '0'))

             ) as cmd_sign_sum,
             (

                 select sum(n_command_status_send.cmd_status_sum)
                 from n_command_status_send where n_command_status_send.administrator_code=t1.administrator_code and
                         n_command_status_send.cmd_status='2'
                                                 and
                         (date_part('year', now()) || '-' || lpad(date_part('month', now())::text, 2, '0')) = (date_part('year', n_command_status_send.date_time) || '-' || lpad(date_part('month', n_command_status_send.date_time)::text, 2, '0'))

             ) as cmd_feedback_sum

         from (select distinct t.administrator_code
               from (
                        select n_clue_state_send.administrator_code
                        from n_clue_state_send
                        union all
                        select n_command_sum_send.administrator_code
                        from n_command_sum_send
                        union all
                        select n_command_status_send.administrator_code
                        from n_command_status_send
                    ) t
              ) t1

     ) t2;
```





## middletables_2_workflow_report_instruct

### 转换图：

![fe7caae5e42f4ae0a5061ba568dddc76.jpg](fe7caae5e42f4ae0a5061ba568dddc76.jpg)



### 源表：

 n_command_sum_receive（领导驾驶舱）

| field              | type      | length | lengthvar | notnull | comment    |
| ------------------ | --------- | ------ | --------- | ------- | ---------- |
| command_sum        | int8      | 8      | -1        | false   | 指令统计   |
| administrator_code | varchar   | -1     | 259       | false   | 行政区划号 |
| administrator_name | varchar   | -1     | 259       | false   | 行政区划名 |
| date_time          | date      | 4      | -1        | false   | 日期       |
| create_time        | timestamp | 8      | -1        | false   | 创建时间   |
| remark             | varchar   | -1     | 259       | false   | 备注       |

### 目标表：

workflow_report_instruct（领导驾驶舱）

| field              | type      | length | lengthvar | notnull | comment        |
| ------------------ | --------- | ------ | --------- | ------- | -------------- |
| id                 | varchar   | -1     | 54        | true    | 主键ID         |
| data_time          | date      | 4      | -1        | false   | 统计时间       |
| year_month         | varchar   | -1     | 104       | false   | 年月           |
| num                | int4      | 4      | -1        | false   | 指令总数       |
| finish_num         | int4      | 4      | -1        | false   | 完成数         |
| sign_num           | int4      | 4      | -1        | false   | 签收数         |
| feedback_num       | int4      | 4      | -1        | false   | 反馈数         |
| red_num            | int4      | 4      | -1        | false   | 红色指令数     |
| red_finish_num     | int4      | 4      | -1        | false   | 红色指令完成数 |
| orange_num         | int4      | 4      | -1        | false   | 橙色指令数     |
| orange_finish_num  | int4      | 4      | -1        | false   | 橙色指令完成数 |
| yellow_num         | int4      | 4      | -1        | false   | 黄色指令数     |
| yellow_finish_num  | int4      | 4      | -1        | false   | 黄色指令完成数 |
| blue_num           | int4      | 4      | -1        | false   | 蓝色指令数     |
| blue_finish_num    | int4      | 4      | -1        | false   | 蓝色指令完成数 |
| create_time        | timestamp | 8      | -1        | false   | 创建时间       |
| remark             | varchar   | -1     | 504       | false   | 备注           |
| administrator_code | varchar   | -1     | 259       | false   | 行政区划号     |
| administrator_name | varchar   | -1     | 259       | false   | 行政区划名     |





```
select
       md5(random()::text || clock_timestamp()::text) id,
       ncsr.date_time          data_time,
       ncsr.command_sum       num,
       (select coalesce(sum( ncfr.cmd_finished_sum),0) from n_command_finished_receive ncfr where ncfr.administrator_code = ncsr.administrator_code and ncfr.cmd_finished='1' and ncfr.date_time=ncsr.date_time) finish_num,
       (select coalesce(sum( t.cmd_status_sum),0) from n_command_status_receive t where t.administrator_code = ncsr.administrator_code and t.cmd_status='1' and t.date_time=ncsr.date_time) sign_num,
       (select coalesce(sum( t.cmd_status_sum),0) from n_command_status_receive t where t.administrator_code = ncsr.administrator_code and t.cmd_status='2' and t.date_time=ncsr.date_time) feedback_num,
       (select coalesce(sum( t.level_sum),0) from n_command_level_receive t where t.administrator_code = ncsr.administrator_code and t.level_id='ZLDJ-001' and t.date_time=ncsr.date_time) red_num,
       (select coalesce(sum( t.cmd_sum),0) from n_command_leval_finish_receive t where t.administrator_code = ncsr.administrator_code and t.level_id='ZLDJ-001' and t.cmd_finished='1' and t.date_time=ncsr.date_time) red_finish_num,

       (select coalesce(sum( t.level_sum),0) from n_command_level_receive t where t.administrator_code = ncsr.administrator_code and t.level_id='ZLDJ-002' and t.date_time=ncsr.date_time) orange_num,
       (select coalesce(sum( t.cmd_sum),0) from n_command_leval_finish_receive t where t.administrator_code = ncsr.administrator_code and t.level_id='ZLDJ-002' and t.cmd_finished='1' and t.date_time=ncsr.date_time) orange_finish_num,


       (select coalesce(sum( t.level_sum),0) from n_command_level_receive t where t.administrator_code = ncsr.administrator_code and t.level_id='ZLDJ-003' and t.date_time=ncsr.date_time) yellow_num,
       (select coalesce(sum( t.cmd_sum),0) from n_command_leval_finish_receive t where t.administrator_code = ncsr.administrator_code and t.level_id='ZLDJ-003' and t.cmd_finished='1' and t.date_time=ncsr.date_time) yellow_finish_num,

       (select coalesce(sum( t.level_sum),0) from n_command_level_receive t where t.administrator_code = ncsr.administrator_code and t.level_id='ZLDJ-004' and t.date_time=ncsr.date_time) blue_num,
       (select coalesce(sum( t.cmd_sum),0) from n_command_leval_finish_receive t where t.administrator_code = ncsr.administrator_code and t.level_id='ZLDJ-004' and t.cmd_finished='1' and t.date_time=ncsr.date_time) blue_finish_num,

       to_char(ncsr.date_time,'yyyy-MM') year_month,
       now()                   create_time,
       ncsr.remark             remark,
       ncsr.administrator_code administrator_code,
       ncsr.administrator_name administrator_name
from n_command_sum_receive ncsr;
```



## 12_tb_uc_duty_cmd_record_2_n_command_yueduzt_receive



### 转换图：

![9a1f8a9d1a364036813b062ed0fd3095.jpg](9a1f8a9d1a364036813b062ed0fd3095.jpg)



### 源表：

tb_uc_duty_cmd_record （指令中台）

表结构参考上述tb_uc_duty_cmd_record 说明

### 目标表：

n_command_yueduzt_receive（领导驾驶舱）

| field              | type      | length | lengthvar | notnull | comment          |
| ------------------ | --------- | ------ | --------- | ------- | ---------------- |
| cmd_yueduzt        | varchar   | -1     | 259       | false   | 指令阅读状态     |
| cmd_yueduzt_sum    | int8      | 8      | -1        | false   | 指令阅读状态统计 |
| administrator_code | varchar   | -1     | 259       | false   | 行政区划号       |
| administrator_name | varchar   | -1     | 259       | false   | 行政区划名       |
| date_time          | date      | 4      | -1        | false   | 日期             |
| create_time        | timestamp | 8      | -1        | false   | 创建时间         |
| remark             | varchar   | -1     | 259       | false   | 备注             |



```
select t1.yueduzt                                                  cmd_yueduzt,
       count(1)                                                     cmd_yueduzt_sum,
       t1.receiver_area_code                                                administrator_code,
       (
           select t_administration.name
           from t_administration
           where t_administration.adcode = t1.receiver_area_code
       )                                                            administrator_name,
       to_date(to_char(t1.create_time, 'yyyy-mm-dd'), 'yyyy-mm-dd') date_time,
       now()                                                        create_time,
       '备注'                                                         remark
from (
         select
             tudcr.*,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tudcr.create_role_id limit 1) sender_area_code,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tudcr.to_role_id limit 1) receiver_area_code
         from tb_uc_duty_cmd_record tudcr
     ) t1
where t1.receiver_area_code is not null and t1.create_role_id is not null and t1.to_role_id is not null and t1.status = 'CSZT1-001'
group by t1.receiver_area_code, to_char(t1.create_time, 'yyyy-mm-dd'), t1.yueduzt;
```





## 11_tb_uc_duty_cmd_record_2_n_command_type_send



### 转换图：

![a7423cc3bc0641ce824a1e2bf070f3f1.jpg](a7423cc3bc0641ce824a1e2bf070f3f1.jpg)



### 源表：

tb_uc_duty_cmd_record（指令中台）

表结构说明：参考上述tb_uc_duty_cmd_record表结构说明

### 目标表：

n_commmad_type_send（领导驾驶舱）

| field              | type      | length | lengthvar | notnull | comment    |
| ------------------ | --------- | ------ | --------- | ------- | ---------- |
| cmd_type           | varchar   | -1     | 259       | false   | 指令类型   |
| cmd_type_sum       | int8      | 8      | -1        | false   | 类型统计   |
| administrator_code | varchar   | -1     | 259       | false   | 行政区划号 |
| administrator_name | varchar   | -1     | 259       | false   | 行政区划名 |
| date_time          | date      | 4      | -1        | false   | 日期       |
| create_time        | timestamp | 8      | -1        | false   | 创建时间   |
| remark             | varchar   | -1     | 259       | false   | 备注       |



```

select t1.cmd_type                                                  cmd_type,
       count(distinct t1.rid)                                       cmd_type_sum,
       t1.sender_area_code                                         administrator_code,
       (
           select t_administration.name
           from t_administration
           where t_administration.adcode = t1.sender_area_code
       )                                                            administrator_name,
       to_date(to_char(t1.create_time, 'yyyy-mm-dd'), 'yyyy-mm-dd') date_time,
       now()                                                        create_time,
       '备注'                                                         remark
from (
         select
             tudcr.*,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tudcr.create_role_id limit 1) sender_area_code,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tudcr.to_role_id limit 1) receiver_area_code
         from tb_uc_duty_cmd_record tudcr
         ) t1
where t1.sender_area_code is not null and t1.create_role_id is not null and t1.to_role_id is not null and t1.status = 'CSZT1-001'
group by t1.sender_area_code, to_char(t1.create_time, 'yyyy-mm-dd'), t1.cmd_type;
```





## 10_tb_uc_duty_cmd_record_2_n_command_type_receive



### 转换图：

![31d26fad899c4e29b041bf409f7e8b36.jpg](http://localhost/lyt-lytdoc/file/preview/31d26fad899c4e29b041bf409f7e8b36.jpg)



### 源表：

tb_uc_duty_cmd_record（指令中台）

表结构：参考上述tb_uc_duty_cmd_record说明

### 目标表：

n_commmad_type_receive（领导驾驶舱）

| field              | type      | length | lengthvar | notnull | comment    |
| ------------------ | --------- | ------ | --------- | ------- | ---------- |
| cmd_type           | varchar   | -1     | 259       | false   | 指令类型   |
| cmd_type_sum       | int8      | 8      | -1        | false   | 类型统计   |
| administrator_code | varchar   | -1     | 259       | false   | 行政区划号 |
| administrator_name | varchar   | -1     | 259       | false   | 行政区划名 |
| date_time          | date      | 4      | -1        | false   | 日期       |
| create_time        | timestamp | 8      | -1        | false   | 创建时间   |
| remark             | varchar   | -1     | 259       | false   | 备注       |







```

select t1.cmd_type                                                  cmd_type,
       count(1)                                                     cmd_type_sum,
       t1.receiver_area_code                                                 administrator_code,
       (
           select t_administration.name
           from t_administration
           where t_administration.adcode = t1.receiver_area_code
       )                                                            administrator_name,
       to_date(to_char(t1.create_time, 'yyyy-mm-dd'), 'yyyy-mm-dd') date_time,
       now()                                                        create_time,
       '备注'                                                         remark
from
     (
         select
             tudcr.*,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tudcr.create_role_id limit 1) sender_area_code,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tudcr.to_role_id limit 1) receiver_area_code
         from tb_uc_duty_cmd_record tudcr
     )   t1
where t1.receiver_area_code is not null and t1.create_role_id is not null and t1.to_role_id is not null and t1.status = 'CSZT1-001'
group by t1.receiver_area_code, to_char(t1.create_time, 'yyyy-mm-dd'), t1.cmd_type;
```







## 9_tb_uc_duty_cmd_record_2_n_command_sum_send



### 转换图：

![f94b50a864d941459b9ee8b1c5ae072b.jpg](http://localhost/lyt-lytdoc/file/preview/f94b50a864d941459b9ee8b1c5ae072b.jpg)



### 源表：

tb_uc_duty_cmd_record（领导驾驶舱）

表结构：参考上述tb_uc_duty_cmd_record说明

### 目标表：

n_command_sum_send（领导驾驶舱）



| field              | type      | length | lengthvar | notnull | comment    |
| ------------------ | --------- | ------ | --------- | ------- | ---------- |
| command_sum        | int8      | 8      | -1        | false   | 指令统计   |
| administrator_code | varchar   | -1     | 259       | false   | 行政区划号 |
| administrator_name | varchar   | -1     | 259       | false   | 行政区划名 |
| date_time          | date      | 4      | -1        | false   | 日期       |
| create_time        | timestamp | 8      | -1        | false   | 创建时间   |
| remark             | varchar   | -1     | 259       | false   | 备注       |





```


select
    count(distinct t1.rid)                                                       command_sum,
    t1.sender_area_code                                                administrator_code,
    (
        select t_administration.name
        from t_administration
        where t_administration.adcode = t1.sender_area_code
    )                                                            administrator_name,
    to_date(to_char(t1.create_time, 'yyyy-mm-dd'), 'yyyy-mm-dd') date_time,
    now()                                                        create_time,
    '备注'                                                         remark
from (
         select
             tudcr.*,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tudcr.create_role_id limit 1) sender_area_code,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tudcr.to_role_id limit 1) receiver_area_code
         from tb_uc_duty_cmd_record tudcr
         ) t1
where t1.sender_area_code is not null and t1.create_role_id is not null and t1.to_role_id is not null and t1.status = 'CSZT1-001'
group by t1.sender_area_code, to_char(t1.create_time, 'yyyy-mm-dd');
```





## 8_tb_uc_duty_cmd_record_2_n_command_sum_receive



### 转换图：



![713be9a9db8d4decaa578865efc92bb5.jpg](http://localhost/lyt-lytdoc/file/preview/713be9a9db8d4decaa578865efc92bb5.jpg)

### 源表：

tb_uc_duty_cmd_record（领导驾驶舱）

表结构：参考上述tb_uc_duty_cmd_record说明

### 目标表：

n_command_sum_receive（领导驾驶舱）



| field              | type      | length | lengthvar | notnull | comment    |
| ------------------ | --------- | ------ | --------- | ------- | ---------- |
| command_sum        | int8      | 8      | -1        | false   | 指令统计   |
| administrator_code | varchar   | -1     | 259       | false   | 行政区划号 |
| administrator_name | varchar   | -1     | 259       | false   | 行政区划名 |
| date_time          | date      | 4      | -1        | false   | 日期       |
| create_time        | timestamp | 8      | -1        | false   | 创建时间   |
| remark             | varchar   | -1     | 259       | false   | 备注       |



```
select
    count(1)                                                     command_sum,
    t1.receiver_area_code                                             administrator_code,
    (
        select t_administration.name
        from t_administration
        where t_administration.adcode = t1.receiver_area_code
    )                                                            administrator_name,
    to_date(to_char(t1.create_time, 'yyyy-mm-dd'), 'yyyy-mm-dd') date_time,
    now()                                                        create_time,
    '备注'                                                         remark
from (
         select
             tudcr.*,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tudcr.create_role_id limit 1) sender_area_code,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tudcr.to_role_id limit 1) receiver_area_code
         from tb_uc_duty_cmd_record tudcr
     ) t1
where t1.receiver_area_code is not null and t1.create_role_id is not null and t1.to_role_id is not null and t1.status = 'CSZT1-001'
group by t1.receiver_area_code, to_char(t1.create_time, 'yyyy-mm-dd');
```





## 7_tb_uc_duty_cmd_record_2_n_command_status_send



### 转换图：

![9117680b03df4875a7ed18912cc9c0c1.jpg](http://localhost/lyt-lytdoc/file/preview/9117680b03df4875a7ed18912cc9c0c1.jpg)



### 源表：

tb_uc_duty_cmd_record（领导驾驶舱）

表结构：参考上述tb_uc_duty_cmd_record说明

### 目标表：

n_command_status_send（领导驾驶舱）

| field              | type      | length | lengthvar | notnull | comment          |
| ------------------ | --------- | ------ | --------- | ------- | ---------------- |
| cmd_status         | varchar   | -1     | 259       | false   | 指令流转状态     |
| cmd_status_sum     | int8      | 8      | -1        | false   | 指令流转状态统计 |
| administrator_code | varchar   | -1     | 259       | false   | 行政区划号       |
| administrator_name | varchar   | -1     | 259       | false   | 行政区划名       |
| date_time          | date      | 4      | -1        | false   | 日期             |
| create_time        | timestamp | 8      | -1        | false   | 创建时间         |
| remark             | varchar   | -1     | 259       | false   | 备注             |





```
select
    t.cmd_status,
    t.administrator_code,
    coalesce(case when t.cmd_status='1' then coalesce(t.cmd_yiqianshou_status_sum,0) + coalesce(t.cmd_yifankui_status_sum,0)
                  when t.cmd_status='0' then coalesce(t.cmd_daichuli_status_sum,0)
                 when t.cmd_status='2' then coalesce(t.cmd_yifankui_status_sum,0)
                 end,0) as cmd_status_sum,
    t.administrator_name,
    t.date_time,
    t.create_time,
    t.remark
from (
         select t1.cmd_status                                                cmd_status,
                case t1.cmd_status
                    when '0' then  count(distinct t1.rid)   end as cmd_daichuli_status_sum,
                case t1.cmd_status
                    when '1' then  count(distinct t1.rid)   end as cmd_yiqianshou_status_sum,
                case t1.cmd_status
                    when '2' then  count(distinct t1.rid)   end as cmd_yifankui_status_sum,
                t1.sender_area_code                                      administrator_code,
                (
                    select t_administration.name
                    from t_administration
                    where t_administration.adcode = t1.sender_area_code
                )                                                            administrator_name,
                to_date(to_char(t1.create_time, 'yyyy-mm-dd'), 'yyyy-mm-dd') date_time,
                now()                                                        create_time,
                '备注'                                                         remark
         from (
                  select
                      tudcr.*,
                      (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tudcr.create_role_id limit 1) sender_area_code,
                      (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tudcr.to_role_id limit 1) receiver_area_code
                  from tb_uc_duty_cmd_record tudcr
              ) t1
         where t1.sender_area_code is not null and t1.create_role_id is not null and t1.to_role_id is not null and t1.status = 'CSZT1-001'
         group by t1.sender_area_code, to_char(t1.create_time, 'yyyy-mm-dd'), t1.cmd_status
     ) t;
```







## 6_tb_uc_duty_cmd_record_2_n_command_status_receive

### 转换图：



![e1eebe74e8a34409ae363df0070073fc.jpg](http://localhost/lyt-lytdoc/file/preview/e1eebe74e8a34409ae363df0070073fc.jpg)

### 源表：

tb_uc_duty_cmd_record（领导驾驶舱）

表结构：参考上述tb_uc_duty_cmd_record说明

### 目标表：

n_command_status_receive（领导驾驶舱）
| field              | type      | length | lengthvar | notnull | comment          |
| ------------------ | --------- | ------ | --------- | ------- | ---------------- |
| cmd_status         | varchar   | -1     | 259       | false   | 指令流转状态     |
| cmd_status_sum     | int8      | 8      | -1        | false   | 指令流转状态统计 |
| administrator_code | varchar   | -1     | 259       | false   | 行政区划号       |
| administrator_name | varchar   | -1     | 259       | false   | 行政区划名       |
| date_time          | date      | 4      | -1        | false   | 日期             |
| create_time        | timestamp | 8      | -1        | false   | 创建时间         |
| remark             | varchar   | -1     | 259       | false   | 备注             |



```
select
    t.cmd_status,
    t.administrator_code,
    coalesce(case when t.cmd_status='1' then coalesce(t.cmd_yiqianshou_status_sum,0) + coalesce(t.cmd_yifankui_status_sum,0)
                  when t.cmd_status='0' then coalesce(t.cmd_daichuli_status_sum,0)
                  when t.cmd_status='2' then coalesce(t.cmd_yifankui_status_sum,0)
                 end,0) as cmd_status_sum,
    t.administrator_name,
    t.date_time,
    t.create_time,
    t.remark
from (
         select t1.cmd_status                                                  cmd_status,
                case t1.cmd_status
                    when '0' then  count(1) end as cmd_daichuli_status_sum,
                case t1.cmd_status
                    when '1' then  count(1) end as cmd_yiqianshou_status_sum,
                case t1.cmd_status
                    when '2' then  count(1) end as cmd_yifankui_status_sum,
                t1.receiver_area_code                                            administrator_code,
                (
                    select t_administration.name
                    from t_administration
                    where t_administration.adcode = t1.receiver_area_code
                )                                                            administrator_name,
                to_date(to_char(t1.create_time, 'yyyy-mm-dd'), 'yyyy-mm-dd') date_time,
                now()                                                        create_time,
                '备注'                                                         remark
         from (
                  select
                      tudcr.*,
                      (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tudcr.create_role_id limit 1) sender_area_code,
                      (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tudcr.to_role_id limit 1) receiver_area_code
                  from tb_uc_duty_cmd_record tudcr
              ) t1
         where t1.receiver_area_code is not null and t1.create_role_id is not null and t1.to_role_id is not null and t1.status = 'CSZT1-001'
         group by t1.receiver_area_code, to_char(t1.create_time, 'yyyy-mm-dd'), t1.cmd_status
     ) t
;


```









## 5_tb_uc_duty_cmd_record_2_n_command_level_send



### 转换图：

![c78f814d1c12494fa838a925578e3757.jpg](http://localhost/lyt-lytdoc/file/preview/c78f814d1c12494fa838a925578e3757.jpg)



### 源表：

 tb_uc_duty_cmd_record（领导驾驶舱）

表结构：参考上述tb_uc_duty_cmd_record说明

### 目标表：

n_command_level_send（领导驾驶舱）
| field              | type      | length | lengthvar | notnull | comment    |
| ------------------ | --------- | ------ | --------- | ------- | ---------- |
| level_id           | varchar   | -1     | 259       | false   | 等级ID     |
| level_sum          | int8      | 8      | -1        | false   | 等级统计   |
| administrator_code | varchar   | -1     | 259       | false   | 行政区划号 |
| administrator_name | varchar   | -1     | 259       | false   | 行政区划名 |
| date_time          | date      | 4      | -1        | false   | 日期       |
| create_time        | timestamp | 8      | -1        | false   | 创建时间   |
| remark             | varchar   | -1     | 259       | false   | 备注       |



```
select t1.cmd_level_id                                                  level_id,
       count(DISTINCT t1.rid)                                                     level_sum,
       t1.sender_area_code                                                administrator_code,
       (
           select t_administration.name
           from t_administration
           where t_administration.adcode = t1.sender_area_code
       )                                                            administrator_name,
       to_date(to_char(t1.create_time, 'yyyy-mm-dd'), 'yyyy-mm-dd') date_time,
       now()                                                        create_time,
       '备注'                                                         remark
from (
         select
             tudcr.*,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tudcr.create_role_id limit 1) sender_area_code,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tudcr.to_role_id limit 1) receiver_area_code
         from tb_uc_duty_cmd_record tudcr
     ) t1
where t1.sender_area_code is not null and t1.create_role_id is not null and t1.to_role_id is not null and t1.status = 'CSZT1-001'
group by t1.sender_area_code, to_char(t1.create_time, 'yyyy-mm-dd'), t1.cmd_level_id;
```







## 4_tb_uc_duty_cmd_record_2_n_command_level_receive



### 转换图:



![c9640fa1f791431191555bc0d5a99c4f.jpg](http://localhost/lyt-lytdoc/file/preview/c9640fa1f791431191555bc0d5a99c4f.jpg)



### 源表：

tb_uc_duty_cmd_record（领导驾驶舱）

表结构：参考上述tb_uc_duty_cmd_record说明

### 目标表：

n_command_level_receive（领导驾驶舱）
| field              | type      | length | lengthvar | notnull | comment    |
| ------------------ | --------- | ------ | --------- | ------- | ---------- |
| level_id           | varchar   | -1     | 259       | false   | 等级ID     |
| level_sum          | int8      | 8      | -1        | false   | 等级统计   |
| administrator_code | varchar   | -1     | 259       | false   | 行政区划号 |
| administrator_name | varchar   | -1     | 259       | false   | 行政区划名 |
| date_time          | date      | 4      | -1        | false   | 日期       |
| create_time        | timestamp | 8      | -1        | false   | 创建时间   |
| remark             | varchar   | -1     | 259       | false   | 备注       |

```
select t1.cmd_level_id                                                  level_id,
       count(1)                                                     level_sum,
       t1.receiver_area_code                                            administrator_code,
       (
           select t_administration.name
           from t_administration
           where t_administration.adcode = t1.receiver_area_code
       )                                                            administrator_name,
       to_date(to_char(t1.create_time, 'yyyy-mm-dd'), 'yyyy-mm-dd') date_time,
       now()                                                        create_time,
       '备注'                                                         remark
from (
         select
             tudcr.*,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tudcr.create_role_id limit 1) sender_area_code,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tudcr.to_role_id limit 1) receiver_area_code
         from tb_uc_duty_cmd_record tudcr
     ) t1
where t1.receiver_area_code is not null and t1.create_role_id is not null and t1.to_role_id is not null and t1.status = 'CSZT1-001'
group by t1.receiver_area_code, to_char(t1.create_time, 'yyyy-mm-dd'), t1.cmd_level_id;
```







## d_ssqbyth_zdryhgzdxysk_2_focus_person_info

### 转换图：



![1cc93344ce014bcdb0fe21e8edc7836d.jpg](http://localhost/lyt-lytdoc/file/preview/1cc93344ce014bcdb0fe21e8edc7836d.jpg)



### 源表：

d_ssqbyth_zdryhgzdxysk(爱科一体化)

| field              | type      | length | lengthvar | notnull | comment |
| ------------------ | --------- | ------ | --------- | ------- | ------- |
| objectid           | bpchar    | -1     | 40        | true    |         |
| parentindex        | int4      | 4      | -1        | false   |         |
| parentobjectid     | varchar   | -1     | 204       | false   |         |
| parentpropertyname | varchar   | -1     | 68        | false   |         |
| name               | varchar   | -1     | 204       | false   |         |
| state              | int4      | 4      | -1        | false   |         |
| sequenceno         | varchar   | -1     | 204       | false   |         |
| treelistparentid   | varchar   | -1     | 204       | false   |         |
| createdname        | varchar   | -1     | 204       | false   |         |
| idfullpath         | varchar   | -1     | 204       | false   |         |
| namefullpath       | varchar   | -1     | 204       | false   |         |
| createdparentname  | varchar   | -1     | 204       | false   |         |
| sheetcode          | varchar   | -1     | 204       | false   |         |
| workflowversion    | int4      | 4      | -1        | false   |         |
| createdby          | varchar   | -1     | 40        | false   |         |
| createdbyparentid  | varchar   | -1     | 40        | false   |         |
| ownerid            | varchar   | -1     | 40        | false   |         |
| ownerparentid      | varchar   | -1     | 40        | false   |         |
| createdtime        | timestamp | 8      | 6         | false   |         |
| modifiedby         | varchar   | -1     | 204       | false   |         |
| modifiedtime       | timestamp | 8      | 6         | false   |         |
| runninginstanceid  | varchar   | -1     | 40        | false   |         |
| bizsheetversion    | varchar   | -1     | 204       | false   |         |
| flowstatus         | int4      | 4      | -1        | false   |         |
| flowitemid         | varchar   | -1     | 204       | false   |         |
| applytime          | timestamp | 8      | 6         | false   |         |
| zerjz              | varchar   | -1     | 204       | false   |         |
| liegqx             | varchar   | -1     | 204       | false   |         |
| shengqb            | text      | -1     | -1        | false   |         |
| shengjz            | text      | -1     | -1        | false   |         |
| disqb              | text      | -1     | -1        | false   |         |
| disjz              | text      | -1     | -1        | false   |         |
| quxqb              | text      | -1     | -1        | false   |         |
| quxjz              | text      | -1     | -1        | false   |         |
| paicsqb            | text      | -1     | -1        | false   |         |
| zermjxm            | varchar   | -1     | 204       | false   |         |
| zermjsfz           | varchar   | -1     | 204       | false   |         |
| zermjsjh           | varchar   | -1     | 204       | false   |         |
| zermj              | varchar   | -1     | 204       | false   |         |
| liegqx_id          | text      | -1     | -1        | false   |         |
| zermj_id           | text      | -1     | -1        | false   |         |
| renylb1j           | varchar   | -1     | 204       | false   |         |
| renylb2j           | varchar   | -1     | 204       | false   |         |
| renylb3j           | varchar   | -1     | 204       | false   |         |
| zhengjlx           | varchar   | -1     | 204       | false   |         |
| zhengjhm           | varchar   | -1     | 204       | false   |         |
| xingm              | varchar   | -1     | 204       | false   |         |
| lianxfs            | varchar   | -1     | 204       | false   |         |
| zhaop              | varchar   | -1     | 204       | false   |         |
| zhaopbase64        | text      | -1     | -1        | false   |         |
| chelpzh            | varchar   | -1     | 204       | false   |         |
| renylb2j_id        | text      | -1     | -1        | false   |         |
| zhengjlx_id        | text      | -1     | -1        | false   |         |
| shoujmac           | varchar   | -1     | 204       | false   |         |
| hujzz              | varchar   | -1     | 204       | false   |         |
| xianzz             | varchar   | -1     | 204       | false   |         |
| hujzrq             | varchar   | -1     | 204       | false   |         |
| hujzrqbm           | varchar   | -1     | 204       | false   |         |
| hujzrpcs           | varchar   | -1     | 204       | false   |         |
| hujzrpcsbm         | varchar   | -1     | 204       | false   |         |
| zhaop_file         | text      | -1     | -1        | false   |         |
| zuixmjfk           | varchar   | -1     | 204       | false   |         |
| zuixmjfk_id        | text      | -1     | -1        | false   |         |
| zerjz_id           | text      | -1     | -1        | false   |         |
| shengzrjz          | varchar   | -1     | 204       | false   |         |
| diszrjz            | varchar   | -1     | 204       | false   |         |
| quxzrjz            | varchar   | -1     | 204       | false   |         |
| shengzrjz_id       | text      | -1     | -1        | false   |         |
| diszrjz_id         | text      | -1     | -1        | false   |         |
| quxzrjz_id         | text      | -1     | -1        | false   |         |
| xinzlrr            | varchar   | -1     | 204       | false   |         |
| xinzlrrssbm        | varchar   | -1     | 204       | false   |         |
| renylb1j_id        | text      | -1     | -1        | false   |         |
| shujid             | varchar   | -1     | 204       | false   |         |
| liegyj             | varchar   | -1     | 204       | false   |         |
| liegyy             | text      | -1     | -1        | false   |         |
| liegyj_id          | text      | -1     | -1        | false   |         |
| daorpc             | varchar   | -1     | 204       | false   |         |
| jingzryda          | varchar   | -1     | 204       | false   |         |
| xinzlrr_id         | text      | -1     | -1        | false   |         |
| xinzlrrjz          | varchar   | -1     | 204       | false   |         |
| xinzlrrqb          | varchar   | -1     | 204       | false   |         |
| bucsq              | varchar   | -1     | 204       | false   |         |
| jinysq             | varchar   | -1     | 204       | false   |         |
| renylb3j_id        | text      | -1     | -1        | false   |         |
| genghzrpcs         | varchar   | -1     | 204       | false   |         |
| shifghzrpcs        | varchar   | -1     | 204       | false   |         |
| genghzrpcs_id      | text      | -1     | -1        | false   |         |
| shifghzrpcs_id     | text      | -1     | -1        | false   |         |
| shoujcm            | varchar   | -1     | 204       | false   |         |
| shifghgkzrpcs      | varchar   | -1     | 204       | false   |         |
| genghgkzrpcs       | varchar   | -1     | 204       | false   |         |
| shifghgkzrpcs_id   | text      | -1     | -1        | false   |         |
| genghgkzrpcs_id    | text      | -1     | -1        | false   |         |
| guankzrpcsbm       | varchar   | -1     | 204       | false   |         |
| guankpcsqb         | text      | -1     | -1        | false   |         |
| imsi               | varchar   | -1     | 204       | false   |         |
| beiz               | text      | -1     | -1        | false   |         |
| lurrbm             | varchar   | -1     | 204       | false   |         |
| disjz2             | varchar   | -1     | 204       | false   |         |
| guispcsbm          | varchar   | -1     | 204       | false   |         |
| shengjz2           | varchar   | -1     | 204       | false   |         |
| quxjz2             | varchar   | -1     | 204       | false   |         |
| linspx             | varchar   | -1     | 204       | false   |         |
| renylb             | text      | -1     | -1        | false   |         |
| zermjszdw          | varchar   | -1     | 204       | false   |         |
| suosds             | varchar   | -1     | 204       | false   |         |
| suosqx             | varchar   | -1     | 204       | false   |         |
| suospcs            | varchar   | -1     | 204       | false   |         |
| mobile             | varchar   | -1     | 204       | false   |         |
| chuangjrzfl        | varchar   | -1     | 204       | false   |         |
| chuangjrdw         | varchar   | -1     | 204       | false   |         |
| employeenumber     | varchar   | -1     | 204       | false   |         |
| zhengjhmsfqdxx     | varchar   | -1     | 204       | false   |         |
| xuanzzrpcs         | varchar   | -1     | 204       | false   |         |
| denglrkzzd4        | varchar   | -1     | 204       | false   |         |
| xuanzzrpcs_id      | text      | -1     | -1        | false   |         |
| zermjjh            | varchar   | -1     | 204       | false   |         |
| xinzlrrsscj        | varchar   | -1     | 204       | false   |         |
| xinzlrrssbm2       | varchar   | -1     | 204       | false   |         |
| shifbsry           | varchar   | -1     | 204       | false   |         |
| zengym             | varchar   | -1     | 204       | false   |         |
| xingb              | varchar   | -1     | 204       | false   |         |
| mingz              | varchar   | -1     | 204       | false   |         |
| xingb_id           | text      | -1     | -1        | false   |         |
| hunyzk             | varchar   | -1     | 204       | false   |         |
| hunyzk_id          | text      | -1     | -1        | false   |         |
| zhengzmm           | varchar   | -1     | 204       | false   |         |
| zongjxy            | varchar   | -1     | 204       | false   |         |
| shenflb            | varchar   | -1     | 204       | false   |         |
| fuwcs              | varchar   | -1     | 204       | false   |         |
| wanglzh            | varchar   | -1     | 204       | false   |         |
| yujdj              | varchar   | -1     | 204       | false   |         |
| zhuysq             | varchar   | -1     | 204       | false   |         |
| hujzzs             | varchar   | -1     | 204       | false   |         |
| hujzzshi           | varchar   | -1     | 204       | false   |         |
| hujzzq             | varchar   | -1     | 204       | false   |         |
| xianzzs            | varchar   | -1     | 204       | false   |         |
| xianzzshi          | varchar   | -1     | 204       | false   |         |
| xianzzq            | varchar   | -1     | 204       | false   |         |
| hujzzs_id          | text      | -1     | -1        | false   |         |
| hujzzshi_id        | text      | -1     | -1        | false   |         |
| hujzzq_id          | text      | -1     | -1        | false   |         |
| xianzzs_id         | text      | -1     | -1        | false   |         |
| xianzzshi_id       | text      | -1     | -1        | false   |         |
| xianzzq_id         | text      | -1     | -1        | false   |         |
| renydj             | varchar   | -1     | 204       | false   |         |
| suossq             | varchar   | -1     | 204       | false   |         |
| sheqgkfzr          | varchar   | -1     | 204       | false   |         |
| sheqgkzrrdh        | varchar   | -1     | 204       | false   |         |
| xiugsj             | varchar   | -1     | 259       | false   |         |
| daorupici          | varchar   | -1     | 259       | false   |         |

### 目标表：

focus_person_info（领导驾驶舱）
| field                  | type      | length | lengthvar | notnull | comment              |
| ---------------------- | --------- | ------ | --------- | ------- | -------------------- |
| id                     | varchar   | -1     | 259       | false   | 主键ID               |
| data_time              | date      | 4      | -1        | false   | 统计时间             |
| year_month             | varchar   | -1     | 104       | false   | 年月                 |
| type                   | varchar   | -1     | 54        | false   | 业务类型（1.重点人） |
| name                   | varchar   | -1     | 54        | false   | 姓名                 |
| id_number              | varchar   | -1     | 54        | false   | 身份证               |
| register_province_code | varchar   | -1     | 259       | false   | 户籍省编码           |
| register_city_code     | varchar   | -1     | 259       | false   | 户籍市编码           |
| register_district_code | varchar   | -1     | 259       | false   | 户籍区编码           |
| register_police_code   | varchar   | -1     | 259       | false   | 户籍责任派出所编码   |
| resident_province_code | varchar   | -1     | 259       | false   | 常住省编码           |
| resident_city_code     | varchar   | -1     | 259       | false   | 常住市编码           |
| resident_district_code | varchar   | -1     | 259       | false   | 常住区编码           |
| person_type_code       | varchar   | -1     | 54        | false   | 人员类型编码         |
| person_type            | varchar   | -1     | 104       | false   | 人员类型释义         |
| duty_police            | varchar   | -1     | 54        | false   | 责任民警             |
| control_status         | varchar   | -1     | 54        | false   | 稳控状态             |
| create_time            | timestamp | 8      | -1        | false   | 创建时间             |
| remark                 | varchar   | -1     | 259       | false   | 备注                 |
| register_province_name | varchar   | -1     | 259       | false   | 户籍省名             |
| register_city_name     | varchar   | -1     | 259       | false   | 户籍市名             |
| register_district_name | varchar   | -1     | 259       | false   | 户籍区名             |
| register_police_name   | varchar   | -1     | 259       | false   | 户籍责任派出所名     |
| resident_province_name | varchar   | -1     | 259       | false   | 常住省名             |
| resident_city_name     | varchar   | -1     | 259       | false   | 常住市名             |
| resident_district_name | varchar   | -1     | 259       | false   | 常住区名             |



```
select
       md5(random()::text || clock_timestamp()::text) id,
       to_date(to_char(dsz.createdtime, 'yyyy-MM-DD'), 'yyyy-MM-DD') as "data_time",
       split_part(to_char(dsz.createdtime, 'yyyy-MM-DD'), '-', 1) || '-' ||
       split_part(to_char(dsz.createdtime, 'yyyy-MM-DD'), '-', 2)    as year_month,
       '1'                                                           as "type",
       xingm                                                         as "name",
       zhengjhm                                                      as "id_number",
       hujzzs_id                                                     as "register_province_code",
       hujzzshi_id                                                   as "register_city_code",
       hujzzq_id                                                     as "register_district_code",
       hujzrpcsbm                                                    as "register_police_code",
       xianzzs_id                                                    as "resident_province_code",
       xianzzshi_id                                                  as "resident_city_code",
       xianzzq_id                                                    as "resident_district_code",
       renylb1j                                                      as "person_type",
       zermjxm                                                       as "duty_police",
       createdtime                                                   as "create_time",
       '备注'                                                          as "remark",
       hujzzs                                                        as register_province_name,
       hujzzshi                                                      as register_city_name,
       hujzzq                                                        as register_district_name,
       hujzrpcs                                                      as register_police_name,
       xianzzs                                                       as resident_province_name,
       xianzzshi                                                     as resident_city_name,
       xianzzq                                                       as resident_district_name
from d_ssqbyth_zdryhgzdxysk dsz;
```







## d_qbyth_qbzl_2_focus_group_event



### 转换图：



![ed604aa5cf3048b98471009fecb5b2a1.jpg](http://localhost/lyt-lytdoc/file/preview/ed604aa5cf3048b98471009fecb5b2a1.jpg)

### 源表：

d_qbyth_qbzl （爱科一体化）

| field              | type      | length | lengthvar | notnull | comment              |
| ------------------ | --------- | ------ | --------- | ------- | -------------------- |
| objectid           | bpchar    | -1     | 40        | true    |                      |
| parentindex        | int4      | 4      | -1        | false   |                      |
| parentobjectid     | varchar   | -1     | 204       | false   |                      |
| parentpropertyname | varchar   | -1     | 68        | false   |                      |
| name               | varchar   | -1     | 204       | false   | Name                 |
| state              | int4      | 4      | -1        | false   |                      |
| sequenceno         | varchar   | -1     | 204       | false   | SequenceNo           |
| treelistparentid   | varchar   | -1     | 204       | false   | TreeListParentID     |
| createdname        | varchar   | -1     | 204       | false   | CreatedName          |
| idfullpath         | varchar   | -1     | 204       | false   | IDFullPath           |
| namefullpath       | varchar   | -1     | 204       | false   | NameFullPath         |
| createdparentname  | varchar   | -1     | 204       | false   | CreatedParentName    |
| sheetcode          | varchar   | -1     | 204       | false   | SheetCode            |
| workflowversion    | int4      | 4      | -1        | false   |                      |
| createdby          | varchar   | -1     | 40        | false   | CreatedBy            |
| createdbyparentid  | varchar   | -1     | 40        | false   | CreatedByParentId    |
| ownerid            | varchar   | -1     | 40        | false   | OwnerId              |
| ownerparentid      | varchar   | -1     | 40        | false   | OwnerParentId        |
| createdtime        | timestamp | 8      | 6         | false   |                      |
| modifiedby         | varchar   | -1     | 204       | false   | ModifiedBy           |
| modifiedtime       | timestamp | 8      | 6         | false   |                      |
| runninginstanceid  | varchar   | -1     | 40        | false   | RunningInstanceId    |
| bizsheetversion    | varchar   | -1     | 204       | false   | BizSheetVersion      |
| flowstatus         | int4      | 4      | -1        | false   |                      |
| flowitemid         | varchar   | -1     | 204       | false   | FlowItemId           |
| applytime          | timestamp | 8      | 6         | false   |                      |
| zhuanb             | varchar   | -1     | 204       | false   | 专班                 |
| caijbm             | varchar   | -1     | 204       | false   | 采集部门             |
| danw               | varchar   | -1     | 204       | false   | 单位                 |
| caijgzz            | varchar   | -1     | 204       | false   | 采集工作组           |
| caijbm_id          | text      | -1     | -1        | false   |                      |
| zhuanb_id          | text      | -1     | -1        | false   |                      |
| caijdw             | varchar   | -1     | 204       | false   | 采集单位             |
| biaot              | varchar   | -1     | 204       | false   | 标题                 |
| zhuynr             | text      | -1     | -1        | false   |                      |
| tiqgjc             | text      | -1     | -1        | false   |                      |
| fuj                | varchar   | -1     | 204       | false   | 附件                 |
| fuj_file           | text      | -1     | -1        | false   |                      |
| qiantzrz           | varchar   | -1     | 204       | false   | 牵头责任组           |
| qiantzrz_id        | text      | -1     | -1        | false   |                      |
| xiezgzz            | varchar   | -1     | 204       | false   | 协作工作组           |
| xiezgzz_id         | text      | -1     | -1        | false   |                      |
| xiezjz_id          | text      | -1     | -1        | false   |                      |
| sheslb             | varchar   | -1     | 204       | false   | 涉事类别             |
| zhilyq_id          | text      | -1     | -1        | false   |                      |
| sheslb_id          | text      | -1     | -1        | false   |                      |
| fanksx_id          | text      | -1     | -1        | false   |                      |
| zhiljb_id          | text      | -1     | -1        | false   |                      |
| jiesdw_id          | text      | -1     | -1        | false   |                      |
| zonghypry          | varchar   | -1     | 204       | false   | 综合研判人员         |
| zerqtry            | varchar   | -1     | 204       | false   | 责任牵头人员         |
| gongzzcy           | varchar   | -1     | 204       | false   | 工作组成员           |
| weixqid            | varchar   | -1     | 204       | false   | 微信群ID             |
| dangqhj            | varchar   | -1     | 204       | false   | 当前环节             |
| qingbzlid          | varchar   | -1     | 204       | false   | 情报指令ID           |
| qitcyr             | text      | -1     | -1        | false   |                      |
| canyr              | text      | -1     | -1        | false   |                      |
| guanjz             | varchar   | -1     | 204       | false   | 关键字               |
| shifzd             | varchar   | -1     | 204       | false   | 是否置顶             |
| shifzd_id          | text      | -1     | -1        | false   |                      |
| qianzqbzlid        | varchar   | -1     | 204       | false   | 前置情报指令ID       |
| qianzqbzldw        | varchar   | -1     | 204       | false   | 前置情报指令单位     |
| qianzqbzldw_id     | text      | -1     | -1        | false   |                      |
| zhaop_file         | text      | -1     | -1        | false   |                      |
| readrange          | varchar   | -1     | 204       | false   | 阅读范围             |
| linsbk             | varchar   | -1     | 204       | false   | 临时布控             |
| shengsbm           | varchar   | -1     | 204       | false   | 省市编码             |
| caijr              | varchar   | -1     | 204       | false   | 采集人               |
| caijr_id           | text      | -1     | -1        | false   |                      |
| shifzsj            | varchar   | -1     | 204       | false   | 是否转事件           |
| shifzsj_id         | text      | -1     | -1        | false   |                      |
| shijjb             | varchar   | -1     | 204       | false   | 事件级别             |
| shijjb_id          | text      | -1     | -1        | false   |                      |
| shenhyj            | varchar   | -1     | 204       | false   | 审核意见             |
| hecyj              | varchar   | -1     | 204       | false   | 核查意见             |
| yanpyj             | varchar   | -1     | 204       | false   | 研判意见             |
| chuangjr           | varchar   | -1     | 204       | false   | 创建人               |
| chuangjrgzzflmc    | varchar   | -1     | 204       | false   | 创建人工作组分类名称 |
| chuangjr_id        | text      | -1     | -1        | false   |                      |
| shifxyyp           | varchar   | -1     | 204       | false   | 是否需要研判         |
| shifxyyp_id        | text      | -1     | -1        | false   |                      |
| shifbj             | varchar   | -1     | 204       | false   | 是否办结             |
| banjsj             | varchar   | -1     | 204       | false   | 办结时间             |
| shifbj_id          | text      | -1     | -1        | false   |                      |
| shifsb             | varchar   | -1     | 204       | false   | 是否上报             |
| zhuansj            | varchar   | -1     | 204       | false   | 转事件               |
| ocrtp              | varchar   | -1     | 204       | false   | OCR图片              |
| ocrtp_file         | text      | -1     | -1        | false   |                      |
| buczly             | text      | -1     | -1        | false   |                      |
| shengsbm2          | varchar   | -1     | 204       | false   | 省市编码2            |
| zhixdd             | varchar   | -1     | 204       | false   | 指向地点             |
| zhixkssj           | timestamp | 8      | 6         | false   |                      |
| zhixjzsj           | timestamp | 8      | 6         | false   |                      |
| zhixkssj1          | timestamp | 8      | 6         | false   |                      |
| zhixjssj1          | timestamp | 8      | 6         | false   |                      |
| zhixdd1            | varchar   | -1     | 204       | false   | 指向地点             |
| guanlqt1           | varchar   | -1     | 204       | false   | 关联群体             |
| zhixdd1_id         | text      | -1     | -1        | false   |                      |
| zhixdd1ms          | varchar   | -1     | 204       | false   | 指向地点描述         |
| caijgzzid          | varchar   | -1     | 204       | false   |                      |
| caijrjz            | varchar   | -1     | 204       | false   |                      |
| guanlqt1_id        | text      | -1     | -1        | false   |                      |
| shejrs             | float8    | 8      | -1        | false   |                      |
| shangbzt           | varchar   | -1     | 204       | false   |                      |
| laiy               | varchar   | -1     | 204       | false   |                      |
| shifhc             | varchar   | -1     | 204       | false   |                      |
| shifxc             | varchar   | -1     | 204       | false   |                      |
| shifxc_id          | text      | -1     | -1        | false   |                      |
| shifhc_id          | text      | -1     | -1        | false   |                      |
| laiy_id            | text      | -1     | -1        | false   |                      |
| guanlqt2           | text      | -1     | -1        | false   |                      |
| weipprs            | float8    | 8      | -1        | false   |                      |
| shifocrtptq        | varchar   | -1     | 204       | false   |                      |
| shifocrtptq_id     | text      | -1     | -1        | false   |                      |
| laiyxt             | varchar   | -1     | 204       | false   |                      |
| laiyxtid           | varchar   | -1     | 204       | false   |                      |
| yuyfxsfwc          | varchar   | -1     | 204       | false   |                      |
| yuyfxsfwc_id       | text      | -1     | -1        | false   |                      |
| wenjlsh            | varchar   | -1     | 204       | false   |                      |
| kanwmc             | varchar   | -1     | 204       | false   |                      |
| kanwrq             | varchar   | -1     | 204       | false   |                      |
| kanh               | varchar   | -1     | 204       | false   |                      |
| faxdw              | varchar   | -1     | 204       | false   |                      |
| chuzqk             | text      | -1     | -1        | false   |                      |
| wendfl             | varchar   | -1     | 204       | false   |                      |
| zhuysq             | text      | -1     | -1        | false   |                      |
| zhongdqy           | text      | -1     | -1        | false   |                      |
| zersd              | varchar   | -1     | 204       | false   |                      |
| quntbq             | text      | -1     | -1        | false   |                      |
| xingwfs            | text      | -1     | -1        | false   |                      |
| jingd              | varchar   | -1     | 204       | false   |                      |
| weid               | varchar   | -1     | 204       | false   |                      |
| weizbt             | varchar   | -1     | 204       | false   |                      |
| weizxq             | varchar   | -1     | 204       | false   |                      |
| shujlb             | varchar   | -1     | 204       | false   |                      |
| shangbrxmj         | varchar   | -1     | 204       | false   |                      |
| shangbrdhj         | varchar   | -1     | 204       | false   |                      |
| shangbrsfzhj       | varchar   | -1     | 204       | false   |                      |
| shangbrjhj         | varchar   | -1     | 204       | false   |                      |
| shangbrbmj         | varchar   | -1     | 204       | false   |                      |
| shangbrbmbmj       | varchar   | -1     | 204       | false   |                      |
| banjrxmj           | varchar   | -1     | 204       | false   |                      |
| banjrdhj           | varchar   | -1     | 204       | false   |                      |
| banjrsfzhj         | varchar   | -1     | 204       | false   |                      |
| banjrjhj           | varchar   | -1     | 204       | false   |                      |
| banjrbmj           | varchar   | -1     | 204       | false   |                      |
| banjrbmbmj         | varchar   | -1     | 204       | false   |                      |
| banjyjj            | varchar   | -1     | 204       | false   |                      |
| banjsjj            | varchar   | -1     | 204       | false   |                      |
| xiansbh            | varchar   | -1     | 204       | false   |                      |
| zhongddb           | varchar   | -1     | 204       | false   |                      |
| gongzyq            | text      | -1     | -1        | false   |                      |
| jinjcd             | varchar   | -1     | 204       | false   |                      |
| banlkssj           | timestamp | 8      | 6         | false   |                      |
| banljssj           | timestamp | 8      | 6         | false   |                      |
| weiqfs             | varchar   | -1     | 204       | false   |                      |
| zhuangt            | varchar   | -1     | 204       | false   |                      |
| shancbs            | varchar   | -1     | 204       | false   |                      |
| shangbsj           | timestamp | 8      | 6         | false   |                      |
| beiz               | varchar   | -1     | 204       | false   |                      |
| xitxsjclx          | varchar   | -1     | 204       | false   |                      |
| renwid             | varchar   | -1     | 204       | false   |                      |
| shangbrid          | varchar   | -1     | 204       | false   |                      |
| shifyy             | varchar   | -1     | 204       | false   |                      |
| shifyy_id          | text      | -1     | -1        | false   |                      |
| yiyry              | varchar   | -1     | 204       | false   |                      |
| yiyry_id           | text      | -1     | -1        | false   |                      |
| xianszl            | varchar   | -1     | 204       | false   |                      |
| xianszl_id         | text      | -1     | -1        | false   |                      |
| weiqfs_id          | text      | -1     | -1        | false   |                      |
| weixqm             | varchar   | -1     | 204       | false   |                      |
| quntmc             | varchar   | -1     | 204       | false   |                      |
| shifmqzxsj         | varchar   | -1     | 204       | false   |                      |
| shifmqzxsj_id      | text      | -1     | -1        | false   |                      |

### 目标表：

focus_group_event（领导驾驶舱）

| field            | type      | length | lengthvar | notnull | comment  |
| ---------------- | --------- | ------ | --------- | ------- | -------- |
| id               | varchar   | -1     | 54        | true    | 主键ID   |
| event_code       | varchar   | -1     | 104       | false   | 事件编码 |
| event_desc       | varchar   | -1     | 104       | false   | 事件名称 |
| count            | int4      | 4      | -1        | false   | 事件总数 |
| unfinished_count | int4      | 4      | -1        | false   | 未完成数 |
| create_time      | timestamp | 8      | -1        | false   | 创建时间 |
| remark           | varchar   | -1     | 504       | false   | 备注     |
| data_time        | date      | 4      | -1        | false   | 统计时间 |
| year_month       | varchar   | -1     | 104       | false   | 年月     |

```
select
       md5(random()::text || clock_timestamp()::text) id,
       sum(1)  count,
       now()   create_time,
       '备注' as remark,
       to_date(to_char(dqq.createdtime, 'yyyy-MM-DD'),'yyyy-MM-DD')                        data_time,
       split_part(to_char(dqq.createdtime, 'yyyy-MM-DD'), '-', 1) || '-' ||  split_part(to_char(dqq.createdtime, 'yyyy-MM-DD'), '-', 2) as year_month
from d_qbyth_qbzl dqq
group by dqq.guanlqt1, to_char(dqq.createdtime, 'yyyy-MM-DD')   ;
```





## 3_tb_uc_duty_cmd_record_2_n_command_finished_send

### 转换图：

![b899bb2a18ff4ea8933f1349ec26a299.jpg](http://localhost/lyt-lytdoc/file/preview/b899bb2a18ff4ea8933f1349ec26a299.jpg)

### 源表：

 tb_uc_duty_cmd_record（领导驾驶舱）

表结构：参考上述tb_uc_duty_cmd_record说明

### 目标表：

n_command_finished_send（领导驾驶舱）
| field              | type      | length | lengthvar | notnull | comment          |
| ------------------ | --------- | ------ | --------- | ------- | ---------------- |
| cmd_finished       | varchar   | -1     | 259       | false   | 指令归档状态     |
| cmd_finished_sum   | int8      | 8      | -1        | false   | 指令归档状态统计 |
| administrator_code | varchar   | -1     | 259       | false   | 行政区划号       |
| administrator_name | varchar   | -1     | 259       | false   | 行政区划名       |
| date_time          | date      | 4      | -1        | false   | 日期             |
| create_time        | timestamp | 8      | -1        | false   | 创建时间         |
| remark             | varchar   | -1     | 259       | false   | 备注             |

```
select t1.finished                                                  cmd_finished,
       count(distinct t1.rid)                                       cmd_finished_sum,
       t1.sender_area_code                                administrator_code,
       (
           select t_administration.name
           from t_administration
           where t_administration.adcode = t1.sender_area_code
       )                                                            administrator_name,
       to_date(to_char(t1.create_time, 'yyyy-mm-dd'), 'yyyy-mm-dd') date_time,
       now()                                                        create_time,
       '备注'                                                         remark
from (
         select
             tudcr.*,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tudcr.create_role_id limit 1) sender_area_code,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tudcr.to_role_id limit 1) receiver_area_code
         from tb_uc_duty_cmd_record tudcr
     ) t1
where t1.sender_area_code is not null and t1.create_role_id is not null and t1.to_role_id is not null and t1.status = 'CSZT1-001'
group by t1.sender_area_code, to_char(t1.create_time, 'yyyy-mm-dd'), t1.finished;
```







## 2_tb_uc_duty_cmd_record_2_n_command_finished_receive



### 转换图：

![fd9ce5b1e5aa4704a37951193567b651.jpg](http://localhost/lyt-lytdoc/file/preview/fd9ce5b1e5aa4704a37951193567b651.jpg)



### 源表：

tb_uc_duty_cmd_record（领导驾驶舱）

表结构：参考上述tb_uc_duty_cmd_record说明

### 目标表：

n_command_finished_receive（领导驾驶舱）
| field              | type      | length | lengthvar | notnull | comment          |
| ------------------ | --------- | ------ | --------- | ------- | ---------------- |
| cmd_finished       | varchar   | -1     | 259       | false   | 指令归档状态     |
| cmd_finished_sum   | int8      | 8      | -1        | false   | 指令归档状态统计 |
| administrator_code | varchar   | -1     | 259       | false   | 行政区划号       |
| administrator_name | varchar   | -1     | 259       | false   | 行政区划名       |
| date_time          | date      | 4      | -1        | false   | 日期             |
| create_time        | timestamp | 8      | -1        | false   | 创建时间         |
| remark             | varchar   | -1     | 259       | false   | 备注             |

```
select t1.finished                                                  cmd_finished,
       count(1)                                                     cmd_finished_sum,
       t1.receiver_area_code                                       administrator_code,
       (
           select t_administration.name
           from t_administration
           where t_administration.adcode = t1.receiver_area_code
       )                                                            administrator_name,
       to_date(to_char(t1.create_time, 'yyyy-mm-dd'), 'yyyy-mm-dd') date_time,
       now()                                                        create_time,
       '备注'                                                         remark
from (
         select
             tudcr.*,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tudcr.create_role_id limit 1) sender_area_code,
             (select ssr.xzxqbm from sf_sec_role ssr where cast(ssr."ROLE_ID" as varchar)=tudcr.to_role_id limit 1) receiver_area_code
         from tb_uc_duty_cmd_record tudcr
     ) t1
where t1.receiver_area_code is not null and t1.create_role_id is not null and t1.to_role_id is not null and t1.status = 'CSZT1-001'
group by t1.receiver_area_code, to_char(t1.create_time, 'yyyy-mm-dd'), t1.finished;
```





## 0_tb_uc_duty_link_person_2_t_command_link_person



### 转换图：

![8b53a2ec507d4c64b68ad483df2fe78b.jpg](http://localhost/lyt-lytdoc/file/preview/8b53a2ec507d4c64b68ad483df2fe78b.jpg)



### 源表：

tb_uc_duty_link_person（指令中台）

| field                | type      | length | lengthvar | notnull | comment                                                      |
| -------------------- | --------- | ------ | --------- | ------- | ------------------------------------------------------------ |
| id                   | varchar   | -1     | 259       | true    | 主键                                                         |
| source_type          | varchar   | -1     | 20        | false   | 关联源类型(1:线索;2:警情;3:指令)                             |
| source_id            | varchar   | -1     | 259       | false   | 关联源ID                                                     |
| id_number            | varchar   | -1     | 259       | false   | 身份证                                                       |
| name                 | varchar   | -1     | 259       | false   | 姓名                                                         |
| phone                | varchar   | -1     | 259       | false   | 联系方式                                                     |
| imei                 | varchar   | -1     | 259       | false   | IMEI                    
<!--stackedit_data:
eyJoaXN0b3J5IjpbMTQ1NzgwNzk0NCwtMTc4NzI0Mjc3OF19
-->